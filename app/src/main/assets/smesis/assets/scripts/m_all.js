!function(){"use strict";function run(stateHandler,ionicHandler,authHandler){stateHandler.initialize(),ionicHandler.initialize(),authHandler.initialize()}function onFinishRender($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){attr.onFinishRender?scope.$emit(attr.onFinishRender):scope.$emit("ngRepeatFinished")})}}}angular.module("myApp",["ionic","staticModule","ngCordova"]).run(run).directive("onFinishRender",onFinishRender),run.$inject=["stateHandler","ionicHandler","authHandler"],onFinishRender.$inject=["$timeout"]}(),$(document).ready(function(){$("body").on("click",".dropdown-menu .hold-on-click",function(e){e.stopPropagation()})}),function(){"use strict";function stateConfig($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/business_journal"),$stateProvider.state("401",{url:"/401",template:'<ion-view><ion-content class="padding" scroll="false"><div class="card"><div class="item item-divider">身份认证失败</div><div class="item item-text-wrap">请尝试重新登录后再试</div></div></ion-content></ion-view>'}),$stateProvider.state("404",{url:"/404",template:'<ion-view><ion-content class="padding" scroll="false"><div class="card"><div class="item item-divider">应用未找到</div><div class="item item-text-wrap">请尝升级客户端后再试</div></div></ion-content></ion-view>'})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function stateHandler($rootScope){function initialize(){$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.homePage=!1,toState.homePage&&($rootScope.homePage=!0),$rootScope.backButtonActions&&$rootScope.backButtonActions.length&&angular.forEach($rootScope.backButtonActions,function(v,k){$rootScope.backButtonActions[k]()})})}return{initialize:initialize}}angular.module("myApp").factory("stateHandler",stateHandler),stateHandler.$inject=["$rootScope"]}(),function(){"use strict";function authHandler($rootScope,$location,$state){function initialize(){var searchParams=$location.search();if(searchParams.originUrl&&searchParams.platformSysUserId&&searchParams.access_token){basePath=searchParams.originUrl;var authentication={originUrl:searchParams.originUrl,platformSysUserId:searchParams.platformSysUserId,access_token:searchParams.access_token};$rootScope.authentication=authentication,window.localStorage.setItem("authentication",JSON.stringify(authentication))}else{var authentication=JSON.parse(window.localStorage.getItem("authentication"))||"";authentication.originUrl&&authentication.platformSysUserId&&authentication.access_token?basePath=authentication.originUrl:$state.go("401")}}return{initialize:initialize}}angular.module("myApp").factory("authHandler",authHandler),authHandler.$inject=["$rootScope","$location","$state"]}(),function(){"use strict";function ionicHandler($ionicPlatform,$rootScope){function initialize(){function keyboardShowHandler(e){if(document.body.classList.add("keyboard-open"),angular.element(".popup-container").length&&angular.element(".popup-container").height()==angular.element(document).height()){var popupContainerHeight=angular.element(".popup-container").outerHeight()-e.keyboardHeight;angular.element(".popup-container").css({height:popupContainerHeight})}}function keyboardHideHandler(){document.body.classList.remove("keyboard-open"),angular.element(".popup-container").length&&angular.element(".popup-container").css({height:"auto"})}function backButtonAction(){$rootScope.homePage?yn.plugin.yncordova.close():window.history.back()}$ionicPlatform.ready(function(){ionic.Platform.fullScreen(!0,!0),ionic.Platform.isFullScreen=!0,window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleLightContent()}),window.addEventListener("native.keyboardshow",keyboardShowHandler),window.addEventListener("native.keyboardhide",keyboardHideHandler),$ionicPlatform.registerBackButtonAction(backButtonAction,100,"views"),$rootScope.backButtonActions={},$rootScope.registerBackButtonAction=function(action,actionId){return actionId?void($rootScope.backButtonActions[actionId]=$ionicPlatform.registerBackButtonAction(action,201,actionId)):void console.error("actionId can be required!")},$rootScope.deregisterBackButtonAction=function(actionId){$rootScope.backButtonActions[actionId]()}}return{initialize:initialize}}angular.module("myApp").factory("ionicHandler",ionicHandler),ionicHandler.$inject=["$ionicPlatform","$rootScope"]}(),function(){"use strict";angular.module("myApp").constant("stringsConstant",{gps:{progress:"定位中...",error:"定位失败(未开启GPS或网络异常)"},http:{progress:"正在加载...",timeout:"请求超时，请重试",error:"加载失败，请重试",timeoutNum:6e4},file:{infoServer:function(){return basePath+"/third/outuploader/queryFileMetaDataByFdfsIds?fastdfsIds="},uploadServer:function(){return basePath+"/third/outuploader/upload"},mergeServer:function(){return basePath+"/third/outuploader/mergeFile"},downloadServer:function(){return basePath+"/outuploader/downloadStream?fastDFSId="},deleteServer:function(){return basePath+"/third/outuploader/delete?fastDFSId="},downLoadPath:function(){return ionic.Platform.isAndroid()?cordova.file.externalDataDirectory+"Downloads/":cordova.file.documentsDirectory+"Data/Downloads/"}},utils:{uuid:function(){for(var s=[],hexDigits="0123456789abcdef",i=0;36>i;i++)s[i]=hexDigits.substr(Math.floor(16*Math.random()),1);return s[14]="4",s[19]=hexDigits.substr(3&s[19]|8,1),s[8]=s[13]=s[18]=s[23]="-",s.join("")}}})}(),function(){"use strict";function httpConfig($httpProvider){$httpProvider.interceptors.push("authInterceptor")}angular.module("myApp").config(httpConfig),httpConfig.$inject=["$httpProvider"]}(),function(){"use strict";function ionicConfig($ionicConfigProvider){$ionicConfigProvider.platform.android.tabs.position("bottom"),$ionicConfigProvider.tabs.style("standard"),$ionicConfigProvider.navBar.alignTitle("center"),$ionicConfigProvider.backButton.icon("ion-chevron-left"),$ionicConfigProvider.backButton.text(""),$ionicConfigProvider.templates.maxPrefetch(0),$ionicConfigProvider.views.maxCache(0)}angular.module("myApp").config(ionicConfig),ionicConfig.$inject=["$ionicConfigProvider"]}(),function(){"use strict";function authInterceptor($injector,$q){function request(config){if(window.localStorage.getItem("authentication")&&-1==config.url.indexOf(".html")){var authentication=JSON.parse(window.localStorage.getItem("authentication")),separate=/\?/.test(config.url)?"&":"?";config.headers.authorization=authentication.access_token,config.url+=separate+"platformSysUserId="+authentication.platformSysUserId+"&access_token="+authentication.access_token}return config}function responseError(response){return 401==response.status?($injector.get("$state").go("401"),$q.reject(response)):$q.reject(response)}var service={request:request,responseError:responseError};return service}angular.module("myApp").factory("authInterceptor",authInterceptor),authInterceptor.$inject=["$injector","$q"]}(),angular.module("staticModule",[]),angular.module("staticModule").directive("alertTop",[function(){return{restrict:"C",link:function(scope,elem,attrs){var $close=elem.find(".ion-close-round");$close.on("click",function(){elem.remove()})}}}]),angular.module("myApp").controller("demoCtrl",["$scope","$ionicModal","$http",function($scope,$ionicModal,$http){$scope.areaObj={provinceId:51e4,cityId:510100,areaId:510124},$scope.hotelSelect=function(item){console.log($scope.date),console.log(item)},$http.get(basePath+"/platformcommondictionaryresource/findVehicleCodeTable").then(function(res){$scope.initData=res.data},function(res){$scope.initData=[],console.log("抽屉式单选 数据获取失败")}),$scope.diySelect=function(item){console.log(item)},$scope.area={provinceId:13e4,cityId:130400,areaId:130404},$scope.areaSelect=function(item){console.log(item)},$scope.ymdhiSelect=function(item){console.log(item)},$scope.ymdSelect=function(item){console.log(item)},$scope.hiSelect=function(item){console.log(item)},$scope.callBackDate="",$scope.callYmdSelect=function(item){console.log(item),$scope.callBackDate=item},$scope.selectDate=function(){angular.element("#date").click()}}]),angular.module("myApp").controller("tabDemoCtrl",["$scope","$ionicLoading",function($scope,$ionicLoading){$scope.doRefresh=function(){$ionicLoading.show({template:"加载中..."})},$scope.doBack=function(){history.back(-1)}}]),angular.module("staticModule").directive("datetimepicker",[function(){return{scope:{datetimeSettings:"=",onSelect:"&onSelect",datetimeInstance:"=",datetimeType:"@"},link:function(scope,element,attrs){function getSettings(){return scope.settings=angular.extend({},scope.defaultOpts,scope.datetimeSettings)}function init(){switch(scope.datetimeType){case"datetime":element.mobiscroll().datetime(getSettings());break;case"time":element.mobiscroll().time(getSettings());break;default:element.mobiscroll().date(getSettings())}attrs.datetimeInstance&&(scope.datetimeInstance={show:function(){element.mobiscroll("show")},close:function(){element.mobiscroll("close")}})}scope.ngModel?(scope.date=new Date(scope.ngModel),console.log(scope.date)):scope.date=null,scope.defaultOpts={lang:"zh",stepMinute:1,minWidth:50,showLabel:!0,minDate:new Date((new Date).getFullYear()-10,0,1,0,0),maxDate:new Date((new Date).getFullYear()+10,11,31,23,59),dateOrder:"yymmdd",dateFormat:"yy-mm-dd",timeFormat:"HH:ii"},scope.defaultOpts.onSelect=function(valueText,inst){scope.onSelect({item:valueText})},scope.$parent.$watch(attrs.datetimeSettings,function(){init()})}}}]),function(){"use strict";angular.module("myApp").factory("Attachment",function($rootScope,$ionicModal,$cordovaFileTransfer,$cordovaFile,$ionicPopup,$timeout,$http){function formatSize(bytes){if(0===bytes)return"0 B";var k=1024,sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(bytes)/Math.log(k));return(bytes/Math.pow(k,i)).toPrecision(3)+" "+sizes[i]}function show(files){var fileInfoServer=basePath+"/third/outuploader/queryFileMetaDataByFdfsIds?fastdfsIds=",downloadServer=basePath+"/outuploader/downloadStream?fastDFSId=",downLoadPath=cordova.file.documentsDirectory+"Data/Downloads/";ionic.Platform.isAndroid()&&(downLoadPath=cordova.file.externalDataDirectory+"Downloads/"),files=files.split(","),$scope.files=[],$http({method:"GET",url:fileInfoServer+files}).success(function(resFilesInfo){resFilesInfo&&resFilesInfo.result&&resFilesInfo.result.length?(angular.forEach(resFilesInfo.result,function(file){var fileExt=file.fileName.substring(file.fileName.lastIndexOf(".")),defaultIcon="other";/\.(doc|docx)$/i.test(fileExt)?defaultIcon="word":/\.(ppt|pptx)$/i.test(fileExt)?defaultIcon="ppt":/\.(xls|xlsx)$/i.test(fileExt)?defaultIcon="excel":/\.(rar|zip|gzip)$/i.test(fileExt)?defaultIcon="rar":/\.(pdf)$/i.test(fileExt)&&(defaultIcon="pdf");var previewIcon="assets/images/ext/"+defaultIcon+".png";/\.(gif|jpg|jpeg|png|bmp)$/i.test(fileExt)&&(previewIcon=downloadServer+file.fileURLMappingId);var formatFile={fsId:file.fileURLMappingId,uri:downloadServer+file.fileURLMappingId,previewIcon:previewIcon,name:file.fileName,size:formatSize(file.size),download:"下载"};$cordovaFile.checkFile(downLoadPath,file.fileName).then(function(success){console.log(file.fileName+" is downloaded!"),formatFile.download="打开"},function(error){console.log(JSON.stringify(error))}),$scope.files.push(formatFile)}),$scope.openModal()):$ionicPopup.alert({title:"提示",template:"文件丢失了"})}).error(function(){$ionicPopup.alert({title:"提示",template:"服务器错误"})}),document.addEventListener("deviceready",function(){var options={};$scope.openFile=function(e,file){function cordovaFileOpenSuccess(){console.log("Open success! "+downLoadPath+file.name)}function cordovaFileOpenError(code){1===code?$ionicPopup.alert({title:"文件预览提示",template:"未能在手机已安装APP中找到可预览此文件的程序"}):$ionicPopup.alert({title:"文件预览提示",template:"预览时发生了未知错误 #0"})}e.preventDefault(),e.stopPropagation();var cordovaFileOpen=cordova.plugins.disusered.open;cordovaFileOpen(downLoadPath+file.name,cordovaFileOpenSuccess,cordovaFileOpenError)},$scope.download=function(e,file){e.preventDefault(),e.stopPropagation(),$cordovaFile.checkFile(downLoadPath,file.name).then(function(success){console.log(JSON.stringify(success)),$scope.openFile(e,file)},function(error){console.log(JSON.stringify(error)),file.download="下载中",$cordovaFileTransfer.download(file.uri,encodeURI(downLoadPath+file.name),options,!0).then(function(result){console.log(JSON.stringify(result)),$scope.openFile(e,file),file.download="打开"},function(err){console.error(JSON.stringify(err))},function(progress){$timeout(function(){$scope.downloadProgress=progress.loaded/progress.total*100})})})}},!1),$scope.modal=$ionicModal.fromTemplate('<ion-modal-view class="bottom-half attachmentViewList"><ion-header-bar class="bar-positive"><h1 class="title" ng-bind="\'附件(\'+files.length+\')\'"></h1><button class="button button-clear" ng-click="closeModal()">取消</button></ion-header-bar><ion-content><div class="list"><a ng-repeat="file in files" ng-click="download($event,file)" class="item item-thumbnail-left" href="javascript:;"><img ng-src="{{file.previewIcon}}"><h2 ng-bind="file.name"></h2><p><span ng-bind="file.size" ng-if="file.size" class="padding-right"></span></p><button class="download button button-clear button-dark" ng-bind="file.download">下载</button></a></div></ion-content></ion-modal-view>',{scope:$scope,animation:"slide-in-up"}),$scope.openModal=function(){$scope.modal.show()},$scope.closeModal=function(){$scope.modal.hide()},$scope.$on("$destroy",function(){$scope.modal.remove()}),$scope.$on("modal.hidden",function(){$scope.modal.remove()}),$scope.$on("modal.removed",function(){})}var service={show:show},$scope=$rootScope.$new(!0);return service}).directive("fileUploader",function($cordovaFile,$cordovaFileTransfer,$cordovaImagePicker,$http,$timeout,$ionicPopup,$ionicScrollDelegate){return{restrict:"A",scope:{initFiles:"="},template:'<div class="list fileUploadList"><div class="item item-button-right">附件(图片)<button ng-click="getPictures()" class="button filePicker"><i class="icon ion-plus-round"></i></button></div><a ng-repeat="file in files" class="item item-thumbnail-left" ng-click="preview(file)"><img ng-src="{{file.previewIcon}}"><h2 ng-bind="file.name"></h2><p><span ng-bind="file.size" ng-if="file.size" class="padding-right"></span><span ng-bind="(file.progress)"></span></p><button ng-if="file.state==-1" ng-click="retry($event,file)" class="retry button button-icon icon ion-arrow-up-a"></button><button ng-if="file.state==-1||file.state==1" ng-click="deleteFile($event,file)" class="delete button button-icon icon ion-close-circled"></button></a></div>',link:function(scope,element,attrs){function formatSize(bytes){if(0===bytes)return"0 B";var k=1024,sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(bytes)/Math.log(k));return(bytes/Math.pow(k,i)).toPrecision(3)+" "+sizes[i]}function uuid(){for(var s=[],hexDigits="0123456789abcdef",i=0;36>i;i++)s[i]=hexDigits.substr(Math.floor(16*Math.random()),1);s[14]="4",s[19]=hexDigits.substr(3&s[19]|8,1),s[8]=s[13]=s[18]=s[23]="-";var domId=s.join("");return domId}var uuid=uuid();scope.queue={index:0,done:!0},scope.files=[];var transferServer=basePath+"/third/outuploader/upload?platformSysUserId=15&mac="+uuid,mergeServer=basePath+"/third/outuploader/mergeFile",deleteServer=basePath+"/third/outuploader/delete?fastDFSId=",fileInfoServer=basePath+"/third/outuploader/queryFileMetaDataByFdfsIds?fastdfsIds=",downloadServer=basePath+"/outuploader/downloadStream?fastDFSId=",downLoadPath=cordova.file.documentsDirectory+"Data/Downloads/";ionic.Platform.isAndroid()&&(downLoadPath=cordova.file.externalDataDirectory+"Downloads/"),scope.$on(attrs.initBroadcast,function(){scope.files=[],$timeout(function(){$http({method:"GET",url:fileInfoServer+scope.initFiles}).success(function(resFilesInfo){resFilesInfo&&resFilesInfo.result&&(angular.forEach(resFilesInfo.result,function(file){var fileExt=file.fileName.substring(file.fileName.lastIndexOf(".")),defaultIcon="other";/\.(doc|docx)$/i.test(fileExt)?defaultIcon="word":/\.(ppt|pptx)$/i.test(fileExt)?defaultIcon="ppt":/\.(xls|xlsx)$/i.test(fileExt)?defaultIcon="excel":/\.(rar|zip|gzip)$/i.test(fileExt)?defaultIcon="rar":/\.(pdf)$/i.test(fileExt)&&(defaultIcon="pdf");var previewIcon="assets/images/ext/"+defaultIcon+".png";/\.(gif|jpg|jpeg|png|bmp)$/i.test(fileExt)&&(previewIcon=downloadServer+file.fileURLMappingId),scope.files.push({fsId:file.fileURLMappingId,uri:downloadServer+file.fileURLMappingId,previewIcon:previewIcon,name:file.fileName,size:formatSize(file.size),progress:"已上传",state:1})}),scope.queue.index=scope.files.length)})})}),document.addEventListener("deviceready",function(){scope.getPictures=function(){function getPicturesSuc(results){console.log(JSON.stringify(results));for(var i=0;i<results.length;i++){var fileName=results[i].substr(results[i].lastIndexOf("/")+1),fileExt=fileName.substring(fileName.lastIndexOf(".")),defaultIcon="other";/\.(doc|docx)$/i.test(fileExt)?defaultIcon="word":/\.(ppt|pptx)$/i.test(fileExt)?defaultIcon="ppt":/\.(xls|xlsx)$/i.test(fileExt)?defaultIcon="excel":/\.(rar|zip|gzip)$/i.test(fileExt)?defaultIcon="rar":/\.(pdf)$/i.test(fileExt)&&(defaultIcon="pdf");var previewIcon="assets/images/ext/"+defaultIcon+".png";/\.(gif|jpg|jpeg|png|bmp)$/i.test(fileExt)&&(previewIcon=results[i]),scope.files.push({uri:results[i],previewIcon:previewIcon,name:fileName,progress:"等待上传...",state:0})}scope.queue.done&&(scope.queue.done=!1,scope.start())}function getPicturesErr(imagePickerErr){console.error(JSON.stringify(imagePickerErr))}var options={maximumImagesCount:10,width:800,height:800,quality:80};$cordovaImagePicker.getPictures(options).then(getPicturesSuc,getPicturesErr)},scope.start=function(){scope.queue.done||(scope.queue.index<=scope.files.length-1?(scope.fileTransfer(scope.files[scope.queue.index]),scope.queue.index++):scope.queue.done=!0)},scope.retry=function(e,file){e.preventDefault(),e.stopPropagation(),scope.fileTransfer(file)},scope.fileTransfer=function(file){var options=new FileUploadOptions;options.params={name:file.name},options.headers={authorization:JSON.parse(window.localStorage.getItem("authentication")).access_token},$cordovaFileTransfer.upload(encodeURI(transferServer),file.uri,options).then(function(transferRes){console.log(JSON.stringify(transferRes)),file.size=formatSize(transferRes.bytesSent);var data={name:file.name,uploadToFDFS:"uploadToFDFS",platformSysUserId:15,mac:uuid};$http({method:"POST",url:mergeServer,data:data}).success(function(mergeRes){console.log(JSON.stringify(mergeRes)),scope.start(),file.progress="已上传",file.state=1,file.fsId=mergeRes.result,scope.getFsIds()}).error(function(mergeErr){console.error(JSON.stringify(mergeErr)),scope.start(),file.progress="上传失败",file.state=-1})},function(transferErr){console.error(JSON.stringify(transferErr)),scope.start()},function(progress){setTimeout(function(){file.progress=(progress.loaded/progress.total*100).toFixed(0)-15+"%",file.state=0})})},scope.deleteFile=function(e,file){e.preventDefault(),e.stopPropagation(),file.fsId?$http({method:"GET",url:deleteServer+file.fsId}).success(function(res){res.result&&"success"==res.result?scope.removeFile(file):console.error("delete error")}).error(function(err){console.error(JSON.stringify(err))}):(console.log("remove local file"),scope.removeFile(file))},scope.removeFile=function(picture){angular.forEach(scope.files,function(file,key){angular.equals(file,picture)&&(scope.files.splice(key,1),scope.queue.index<=0?scope.queue.index=0:scope.queue.index-=1,scope.getFsIds())})},scope.getFsIds=function(){var fsIds=[];console.log(JSON.stringify(scope.files)),angular.forEach(scope.files,function(file){file.fsId&&fsIds.push(file.fsId)}),scope.initFiles=fsIds.join(",")},scope.preview=function(file){var options={};console.log(JSON.stringify(file)),$cordovaFile.checkFile(downLoadPath,file.name).then(function(success){console.log(JSON.stringify(success)),scope.openFile(file)},function(error){console.log(JSON.stringify(error)),$cordovaFileTransfer.download(file.uri,encodeURI(downLoadPath+file.name),options,!0).then(function(result){console.log(JSON.stringify(result)),scope.openFile(file)},function(err){console.error(JSON.stringify(err))},function(progress){})}),$ionicScrollDelegate.resize()},scope.openFile=function(file){function cordovaFileOpenSuccess(){console.log("Open success! "+downLoadPath+file.name)}function cordovaFileOpenError(code){1===code?$ionicPopup.alert({title:"文件预览提示",template:"未能在手机已安装APP中找到可预览此文件的程序"}):$ionicPopup.alert({title:"文件预览提示",template:"预览时发生了未知错误 #0"})}var cordovaFileOpen=cordova.plugins.disusered.open;cordovaFileOpen(downLoadPath+file.name,cordovaFileOpenSuccess,cordovaFileOpenError)}},!1)}}})}(),angular.module("myApp").directive("hotelSelector",["$http",function($http){var template='<ion-modal-view class="right half min-modal-height"><ion-header-bar class="item-inset bar-stable"><h1 class="title">选择酒店</h1><button hotel-add on-successed="addSuccessed()" area-obj="areaObj" class="button button-hollow button-item-local"><i class="ion-plus"></i> 添加酒店</button><button class="button button-clear button-custom" ng-click="closeModal()">取消</button></ion-header-bar><ion-content><div class="item item-input-inset"><label class="item-input-wrapper"><i class="icon ion-search placeholder-icon"></i><input ng-model="query" type="text" placeholder="搜索酒店"></label></div><div class="list"><ion-radio class="item-radio radio-left" ng-class="{active:selectedObj==hotel}" ng-click="selectHotel(hotel)" ng-repeat="hotel in hotelData | filter:{name:query}"><i class="radio-icon disable-pointer-events icon ion-checkmark"></i><h2>{{hotel.name}}</h2><p>{{hotel.address}}</p></ion-radio></div></ion-content></ion-modal-view>';return{scope:{ngModel:"=",selectedObj:"=",areaObj:"=",select:"&onSelect"},template:template,controller:["$scope","$ionicModal","$ionicLoading",function($scope,$ionicModal,$ionicLoading){$scope.hotelModal=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-right"}),$scope.openModal=function(index){return 1==index?($ionicLoading.show({template:"请先选择酒店所在地区!"}),setTimeout(function(){$ionicLoading.hide()},800),!1):void $scope.hotelModal.show()},$scope.closeModal=function(){$scope.hotelModal.hide()},$scope.$on("$destroy",function(){$scope.hotelModal.remove()}),$scope.$on("modal.hidden",function(){}),$scope.$on("modal.removed",function(){}),$scope.selectHotel=function(hotel){$scope.selectedObj=hotel,$scope.select({item:hotel}),$scope.closeModal()}}],link:function(scope,element,attrs){scope.hotelData=[],element.on("click",function(){return scope.areaObj.provinceId&&scope.areaObj.cityId?(scope.openModal(),void scope.getHotelData()):void scope.openModal(!0)}),scope.getHotelData=function(){scope.data?scope.hotelData=scope.data:(scope.searchObj={},scope.searchObj.provinceId=scope.areaObj.provinceId,scope.searchObj.cityId=scope.areaObj.cityId,scope.searchObj.areaId=scope.areaObj.areaId,$http.post(basePath+"/third/businessjournal/findXZGLHotelTraByConditions?pageNumber=0&pageSize=1000",scope.searchObj).success(function(data){data.result&&(scope.hotelData=data.result.content)}))},scope.addSuccessed=function(){scope.getHotelData()}}}}]),angular.module("myApp").directive("hotelAdd",["$http",function($http){var template='<ion-modal-view class="right half min-modal-height"><ion-header-bar class="item-inset bar-stable"><h1 class="title">添加酒店</h1><button class="button button-clear button-custom" ng-click="closeModal()">取消</button></ion-header-bar><ion-content><form name="hotelForm"><div class="list"><label class="item item-input"><span class="input-label">酒店名称</span><input type="text" placeholder="请输入" ng-model="hotel.name"></label><label class="item item-input"><span class="input-label">酒店类型</span><input slide-select init-data="initData" name-field="dictName" ng-model="hotel.hotelTypeName" ng-value="hotelTypeCode.dictCode" selected-obj="hotelTypeCode" on-select="hotelTypeCodeSelect(item)" readonly="readonly" type="text" placeholder="请选择"></label><label class="item item-input"><span class="input-label">酒店地址</span><input area-selector  province-id="areaObj.provinceId" city-id="areaObj.cityId" area-id="areaObj.areaId" ng-model="area.name" on-select="areaSelect(item)" type="text" placeholder="请选择所在地区" readonly="readonly"></label><label class="item item-input"><span class="input-label">&nbsp;</span><input type="text" placeholder="请输入详细地址" ng-model="hotel.address"></label></div><div class="padding"><input type="submit" class="button button-block button-theme button-local" ng-click="submit()" value="保存"></div></form></ion-content></ion-modal-view>';return{scope:{modal:"=",success:"&onSuccessed"},controller:["$scope","$ionicModal","$ionicLoading","$ionicPopup",function($scope,$ionicModal,$ionicLoading,$ionicPopup){$scope.addHotelModal=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-right"}),$scope.openModal=function(){$scope.initData=[],$scope.areaObj={provinceId:"",cityId:"",areaId:""},$scope.area={name:""},$scope.hotel={name:"",hotelTypeCode:"",hotelTypeName:"",provinceId:"",cityId:"",areaId:"",address:"",isPhone:"1",isAgreementStr:"0"},$scope.initHotelData(),$scope.addHotelModal.show()},$scope.closeModal=function(){$scope.addHotelModal.hide()},$scope.$on("$destroy",function(){$scope.addHotelModal.remove()}),$scope.$on("modal.hidden",function(){}),$scope.$on("modal.removed",function(){}),$scope.areaObj={provinceId:"",cityId:"",areaId:""},$scope.area={name:""},$scope.hotel={name:"",hotelTypeCode:"",provinceId:"",cityId:"",areaId:"",address:"",isPhone:"1",isAgreementStr:"0"},$scope.initHotelData=function(){$http.get(basePath+"/third/businessjournal/findTravelHotelTypeCodeTable").then(function(res){$scope.initData=res.data})},$scope.initHotelData(),$scope.areaSelect=function(item){$scope.hotel.provinceId=item[0].id,$scope.areaObj.provinceId=item[0].id;var name=item[0].name+",";$scope.hotel.cityId=item[1].id,$scope.areaObj.cityId=item[1].id,name+=item[1].name,item.length>2?($scope.hotel.areaId=item[2].id,$scope.areaObj.areaId=item[2].id,name+=","+item[2].name):$scope.hotel.areaId="",$scope.area.name=name},$scope.hotelTypeCodeSelect=function(item){item&&($scope.hotel.hotelTypeName=item.dictName,$scope.hotel.hotelTypeCode=item.dictCode)},$scope.dataBusin=function(data){$ionicPopup.alert({title:"提示",template:'<h5 class="margin-bottom-0">'+data+"不能为空!</h5>",buttons:[{text:"确定",type:" button-theme button-local"}]})},$scope.submit=function(){return $scope.hotel.name?$scope.hotel.hotelTypeCode?$scope.hotel.provinceId&&$scope.hotel.cityId?$scope.hotel.address?void $http.post(basePath+"/third/businessjournal/saveOrUpdateEntity",$scope.hotel).success(function(data){if("0"==data.status)$scope.initHotelData(),$scope.hotelTypeCode={dictName:""},$ionicLoading.show({template:"保存成功"}),setTimeout(function(){$ionicLoading.hide()},500),$scope.closeModal(),$scope.success();else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确定",type:" button-theme button-local"}]})}}):void $scope.dataBusin("酒店地址"):void $scope.dataBusin("酒店所在地"):void $scope.dataBusin("酒店类型"):void $scope.dataBusin("酒店名称")}}],link:function(scope,element,attrs){element.on("click",function(){scope.openModal()})}}}]),angular.module("myApp").directive("slideSelect",["$http",function($http){var template='<ion-modal-view class="auto min-modal-height"><ion-header-bar class="bar-stable"><h1 class="title">{{slideTitle}}</h1><button class="button button-clear button-custom" ng-click="closeModal()">取消</button></ion-header-bar><div class="padding has-header button-list"><div class="slide-select-buttons"><div class="slide-select-button" ng-repeat="item in initData"><button class="button button-local button-block button-theme button-outline" ng-class="{active:selectedObj==item}" ng-click="onSelect(item)">{{item[nameField]}}</button></div></div></div></ion-modal-view>';return{scope:{modal:"=",initData:"=",nameField:"@",slideTitle:"@",selectedObj:"=",select:"&onSelect"},template:template,controller:["$scope","$ionicModal",function($scope,$ionicModal){$scope.slideSelect=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-up"}),$scope.openModal=function(){$scope.slideSelect.show()},$scope.closeModal=function(){$scope.slideSelect.hide()},$scope.$on("$destroy",function(){$scope.slideSelect.remove()}),$scope.$on("modal.hidden",function(){}),$scope.$on("modal.removed",function(){}),$scope.onSelect=function(item){$scope.selectedObj=item,$scope.select({item:item}),$scope.closeModal()}}],link:function(scope,element,attrs){element.on("click",function(){scope.slideTitle=scope.slideTitle||"请选择",scope.openModal()})}}}]),angular.module("myApp").directive("areaSelector",["$http","$ionicModal","$q",function($http,$ionicModal,$q){var template='<ion-modal-view class="bottom-half area-selector min-modal-height"><ion-header-bar class="bar-stable"><h1 class="title">选择地区</h1><button class="button button-clear button-custom" ng-click="modal.hide()">取消</button></ion-header-bar><div class="area-breadcrumb"><i class="ion-location"></i><a ng-show="showProvince" ng-click="view(0)" ng-class="{active:showProvinceList}">{{selectedObj[0].name || "请选择省"}} <i class="arrow">></i></a><a ng-show="showCity" ng-click="view(1)" ng-class="{active:showCityList}">{{selectedObj[1].name || "请选择市"}} <i class="arrow">></i></a><a ng-show="showArea" ng-click="view(2)" ng-class="{active:showAreaList}">{{selectedObj[2].name || "请选择区"}}</a></div><ion-content delegate-handle="mainScroll"><div class="select-history" ng-if="history.length"><button class="button button-theme button-local button-outline" ng-repeat="item in history" ng-click="historyChoose(item.platformCommonAreaDTOList)">{{item.platCommonAreaName?item.platCommonAreaName:item.platCommonCityName}}</button></div><div class="text-center" ng-if="loading"><ion-spinner icon="ios-small"></ion-spinner></div><div class="list area-list" ng-show="showProvinceList"><div class="item" ng-repeat="item in viewObj[0] track by $index" ng-click="choose(0, item)" ng-class="{active:selectedObj[0].name==item.name}"><i class="ion-checkmark-round"></i>{{item.name}}</div></div><div class="list area-list" ng-show="showCityList"><div class="item" ng-repeat="item in viewObj[1] track by $index" ng-click="choose(1, item)" ng-class="{active:selectedObj[1].name==item.name}"><i class="ion-checkmark-round"></i>{{item.name}}</div></div><div class="list area-list" ng-show="showAreaList"><div class="item" ng-repeat="item in viewObj[2] track by $index" ng-click="choose(2, item)" ng-class="{active:selectedObj[2].name==item.name}"><i class="ion-checkmark-round"></i>{{item.name}}</div></div></ion-content></ion-modal-view>';return{scope:{ngModel:"=",diyNgModel:"=",provinceId:"=",cityId:"=",areaId:"=",select:"&onSelect"},template:template,controller:["$scope","$ionicScrollDelegate","$ionicLoading",function($scope,$ionicScrollDelegate,$ionicLoading){$scope.viewObj=[],$scope.selectedObj=[],$scope.history=[],$scope.isEnd=!1,$scope.loading=!0,$scope.clearData=function(){$scope.ngModel="",$scope.selectedObj=[],$scope.provinceId=null,$scope.cityId=null,$scope.areaId=null},$scope.getDataById=function(id){var defer=$q.defer();return id?$http.get(basePath+"/third/commresource/findProvince?id="+id).then(function(res){defer.resolve(res)},function(res){defer.reject(res)}):$http.get(basePath+"/third/commresource/findAreaMessage").then(function(res){defer.resolve(res)},function(res){defer.reject(res)}),defer.promise},$scope.getData=function(type,id){var defer=$q.defer();return $scope.isEnd=!1,$scope.loading=!0,$scope.getDataById(id).then(function(res){res.data.result.length?($scope.viewObj[type]=res.data.result,$scope.view(type)):$scope.isEnd=!0,defer.resolve(res),$scope.loading=!1}),defer.promise},$scope.choose=function(type,area){0==type&&$scope.clearData(),$scope.selectedObj[type]=area,
$scope.getData(type+1,area.id).then(function(){if($scope.isEnd){if($scope.ngModel="",null!=$scope.selectedObj&&1==$scope.selectedObj.length)return $scope.notifyMsg("该省下面没有任何区县,请重新选择!"),!1;var split=function(k){return $scope.selectedObj.length-1==k?"":","};angular.forEach($scope.selectedObj,function(v,k){$scope.diyNgModel||($scope.ngModel+=v.name+split(k))}),$scope.provinceId=$scope.selectedObj[0].id,$scope.cityId=$scope.selectedObj[1].id,$scope.areaId=$scope.selectedObj[2]?$scope.selectedObj[2].id:null,$scope.select({item:$scope.selectedObj}),$scope.closeModal()}}),$ionicScrollDelegate.scrollTop(!0)},$scope.historyChoose=function(area){$scope.clearData(),$scope.selectedObj=area,$scope.provinceId=$scope.selectedObj[0].id,$scope.cityId=$scope.selectedObj[1].id,$scope.areaId=$scope.selectedObj[2]?$scope.selectedObj[2].id:null,$scope.init(),$scope.select({item:$scope.selectedObj}),$scope.closeModal()},$scope.view=function(type){switch($scope.showProvince=!1,$scope.showCity=!1,$scope.showArea=!1,$scope.showProvinceList=!1,$scope.showCityList=!1,$scope.showAreaList=!1,type){case 0:$scope.showProvince=!0,$scope.showProvinceList=!0;break;case 1:$scope.showProvince=!0,$scope.showCity=!0,$scope.showCityList=!0;break;case 2:$scope.showProvince=!0,$scope.showCity=!0,$scope.showArea=!0,$scope.showAreaList=!0}},$scope.init=function(){$scope.getData(0,null).then(function(){$scope.ngModel="",angular.forEach($scope.viewObj[0],function(v){v.id==$scope.provinceId&&($scope.diyNgModel||($scope.ngModel+=v.name),$scope.selectedObj[0]=v)}),$scope.cityId&&$scope.getData(1,$scope.provinceId).then(function(){angular.forEach($scope.viewObj[1],function(v){v.id==$scope.cityId&&($scope.diyNgModel||($scope.ngModel+=","+v.name),$scope.selectedObj[1]=v)}),$scope.areaId&&$scope.getData(2,$scope.cityId).then(function(){angular.forEach($scope.viewObj[2],function(v){v.id==$scope.areaId&&($scope.diyNgModel||($scope.ngModel+=","+v.name),$scope.selectedObj[2]=v)})})})}),$http.get(basePath+"/third/commresource/findAddrSelHistoryByMaxTimeInIndex?index=4&ownedBusiness=mobile").then(function(res){$scope.history=res.data.result},function(res){$scope.history=[]})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},800)},$scope.modal=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-up"}),$scope.openModal=function(){$scope.modal.show()},$scope.closeModal=function(){$scope.modal.hide()},$scope.$on("$destroy",function(){$scope.modal.remove()}),$scope.$on("modal.hidden",function(){}),$scope.$on("modal.removed",function(){})}],link:function(scope,elem,attrs){scope.init(),elem.on("click",function(){scope.openModal()})}}}]),angular.module("myApp").directive("userSelector",["$http","$ionicModal","$q","$filter","$ionicPopup","$timeout",function($http,$ionicModal,$q,$filter,$ionicPopup,$timeout){var template='<ion-modal-view class="user-selector fixed-header has-input-inset min-modal-height " ng-class="{\'search-only\': searchIsShow}" <div class="fixed-header-wrapper"><div class="item-input-inset"><div class="margin-right-10" ng-if="title">选择{{title}}</div><div class="item-input-wrapper"><i ng-class="{\' ion-ios-loop-strong\': isSearchIsShow, \'ion-ios-search-strong\': !isSearchIsShow}" ></i><input type="text" ng-model="query.queryText" ng-change="setSearchShowFun(query.queryText,inservicestates)" placeholder="搜索"><i class="ion-close-round" ng-click="delSearchText(query.queryText)"></i></div></div><div class="selector-name-list" ng-if="recentlyUserList"><span>最近：</span><button class="button button-theme button-outline" ng-click="selectItem(info.userDTO)" ng-repeat=" info in recentlyUserList">{{info.userDTO.name}}</button></div><div ng-show="searchIsShow" class="tips clearfix"><!--正在搜索...-->共找到{{queryListData.length || 0}}个结果</div></div><ion-content ng-class="{\'top-90\':recentlyUserList}" ng-show="!searchIsShow "><ion-list class="list"><div ng-repeat="item in listItem track by $index"> <div class="item item-title-divider clearfix" ng-click="orgIsShowUserList(item)"> <span class="pull-left">{{item.name }}</span> <span class="text-gray pull-left margin-left-5" >{{item.number}}人</span><span class="pull-right text-gray">   <i ng-class="{\'ion-arrow-down-b\': item.isShowUser,\'ion-arrow-up-b\': !item.isShowUser}"></i></span></div><div class="item-seven-space" ng-show="item.number===0 || !item.isShowUser"></div><ion-radio  ng-if="!isMore && item.isShowUser" ng-repeat="info in item.userList | filter:filterFun track by $index" ng-disabled="getDisabled(info)"  class="item-avatar avatar-default radio-left" ng-click="selectItem(info)" ng-model="info.selected"><img  src="assets/images/userface_0.png"><h2>{{info.name }}</h2><p><span>{{info.jobNumber}}</span><span class="margin-left-5">{{info.postName}}</span></p></ion-radio><ion-checkbox ng-if="isMore && item.isShowUser" ng-repeat="info in item.userList | filter:filterFun track by $index" ng-disabled="getDisabled(info)" class="item-avatar avatar-default" ng-change="selectItem(info)" ng-model="info.selected"><img src="assets/images/userface_0.png"><h2>{{info.name }}</h2><p><span>{{info.jobNumber}}</span><span>{{info.postName}}</span></p></ion-checkbox></div></ion-list></ion-content><ion-content ng-show="searchIsShow"><ion-checkbox ng-show="isMore" ng-repeat="info in queryListData | filter:filterFun track by $index" ng-change="selectItem(info)" ng-model="info.selected"><h2>{{info.name +\'(\' + info.jobNumber + \')\' }} <span class="margin-left-5 text-gray">{{info.postName}}</span></h2> </ion-checkbox><ion-radio ng-show="!isMore" ng-repeat="info in queryListData | filter:filterFun track by $index" class="radio-left" ng-click="selectItem(info)" ng-model="info.selected"><h2>{{info.name +\'(\' + info.jobNumber + \')\' }} <span class="margin-left-5 text-gray">{{info.postName}}</span></h2> </ion-radio></ion-content><ion-footer-bar class="bar-up-shadow preview-pos" ><div class="preview-wrap arrow"><ul class="preview-list"><li class="preview-item" ng-if="userList.length > 0" ng-repeat="info in userList"><span class="text-box">{{info.name + \'(\' + info.jobNumber + \')\'}}</span> <i class="ion-style ion-close" ng-click="selectItem(info, true)"></i></li><li class="no-personnel" ng-if="userList.length == 0">没有选择人员</li></ul></div><div class="row" ng-if="!isMore"><div class="col text-center btn-group-wrap" ><button class="button button-theme button-local button-outline" ng-click="closeModal()">返回</button></div></div><div class="row" ng-if="isMore"><div class="col text-center btn-group-wrap"><button class="button button-theme button-local button-outline pull-left" ng-click="closeModal()">返回</button><button ng-show="isMore" class="button button-theme button-local" ng-click="closeModal(true)"> 确定 ({{userList.length}})</button><button class="button button-theme button-local button-outline pull-right" ng-click="previewListClick(isPreview)"> <span ng-show="!isPreview">预览</span><i  ng-show="isPreview" class="ion-style ion-close"></i></button></div></div></ion-footer-bar><div class="fullscreen-box" ng-show="isError || isSelectError"><div class="screen-center"><h4 ng-show="isError">加载失败</h4><h4 ng-show="isSelectError">没有可选人员</h4><p  ng-show="isError">刷新试试</p></div></div></ion-modal-view>';return{scope:{ngModel:"=",select:"&onSelect",selectList:"=",notShowUser:"="},template:template,controller:["$scope","$ionicScrollDelegate","$timeout",function($scope,$ionicScrollDelegate,$timeout){function getCookie(name){var time=window.localStorage.getItem(name+"_time");return time?Date.parse(new Date)<=time?window.localStorage.getItem(name):void 0:null}function setCookie(name,value){window.localStorage.setItem(name,value),window.localStorage.setItem(name+"_time",Date.parse(new Date)+6e5)}var filter=$filter("filter");$scope.isMore=!1,$scope.queryData={},$scope.userList=[];var selectIds={},notShowIds={},cookieName="userListByOrgId_";$scope.query={queryText:""},$scope.selectItem=function(item,isDel){$scope.isMore?item.selected&&!isDel?($scope.userList.push(item),selectIds[item.id]=!0):(selectIds[item.id]=!1,$scope.userList=filter($scope.userList,function(val){return val.id!=item.id})):($scope.recentlySelected(item),$scope.select({item:item}),$scope.closeModal())},$scope.setSearchShowFun=function(item,inservicestates){$scope.searchIsShow=item&&item.length>0,$scope.isSearchIsShow=$scope.searchIsShow,query.queryFun(item,inservicestates)};var query={timeOut:{},queryFun:function(item,inservicestates){this.timeOut&&$timeout.cancel(this.timeOut),item&&(this.timeOut=$timeout(function(){$http.post(basePath+"/third/userselector/findUserDTOByName?name="+item+"&inservicestates="+inservicestates).success(function(data){$scope.queryListData=data,$scope.isSearchIsShow=!1})},1e3))}};$scope.getDisabled=function(val){return notShowIds[val.id]},$scope.orgIsShowUserList=function(item){var flag=angular.copy(item.isShowUser);if(flag)item.isShowUser=!1;else if(item.userList&&item.userList.length>0)$timeout(function(){item.isShowUser=!0});else{var userList=getCookie(cookieName+item.id);userList?(item.userList=JSON.parse(userList),setCookie(cookieName+item.id,userList),$timeout(function(){item.isShowUser=!0})):$http.post(basePath+"/third/userselector/getUserDTOByOrgId?orgId="+item.id+"&inservicestates="+$scope.inservicestates).success(function(data){item.userList=data,setCookie(cookieName+item.id,JSON.stringify(data)),$timeout(function(){item.isShowUser=!0})})}},$scope.filterFun=function(item){return item.selected=selectIds[item.id],!0},$scope.modal=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-up"}),$scope.singleUserSelectData={},$scope.openModal=function(ismore,inservicestates,title,routingStatusType,userTypeApp){$scope.singleUserSelectData={},$scope.recentlyUserList=null,title&&($scope.title=title),0==ismore&&($scope.singleUserSelectData={routingStatusType:routingStatusType,userTypeApp:userTypeApp},$http.post(basePath+"/third/leaveapply/findJSTXRecentlyUser",$scope.singleUserSelectData).success(function(data){$scope.recentlyUserList=data.result}).error(function(){$scope.isError=!0})),$scope.inservicestates=inservicestates?inservicestates:"1,2,3",$scope.delSearchText(inservicestates),$scope.listItem&&$scope.listItem.length>0?setUserList():getUserAllList($scope.inservicestates,setUserList),$scope.isMore=ismore,$scope.modal.show()};var setUserList=function(){$scope.previewListClick(!0),$scope.selectList?(angular.forEach($scope.selectList,function(val){selectIds[val.id]=!0}),$scope.userList=angular.copy($scope.selectList)):(selectIds={},$scope.userList=[]),$scope.notShowUser&&angular.forEach($scope.notShowUser,function(val){notShowIds[val.id]=!0})};$scope.closeModal=function(item){$scope.isMore&&item&&$scope.select({item:$scope.userList}),$scope.modal.hide()},$scope.delSearchText=function(inservicestates){$scope.query.queryText="",$scope.setSearchShowFun($scope.query.queryText,inservicestates)},$scope.$on("$destroy",function(){$scope.modal.remove()}),$scope.$on("modal.hidden",function(){}),$scope.$on("modal.removed",function(){}),$scope.personnel=!0,$scope.previewListClick=function(isPreview){$scope.isPreview=!isPreview;var elm=angular.element;1==elm(".preview-wrap").hasClass("animate")?elm(".preview-wrap").removeClass("animate"):elm(".preview-wrap").addClass("animate")};var getUserAllList=function(inservicestates,fun){$http.post(basePath+"/third/userselector/getAlluser?inservicestates="+inservicestates).success(function(data){$scope.isloading=!0,$scope.isError=!1,$scope.isSelectError=!1,$scope.listItem=angular.copy(data),fun&&fun(data)}).error(function(){$scope.isError=!0})};$scope.recentlySelected=function(item){$scope.singleUserSelectData.selectUserId=item.id,$http.post(basePath+"/third/leaveapply/saveJSTXRecentlyUser",$scope.singleUserSelectData).success(function(data){}).error(function(){$scope.isError=!0})}}],link:function(scope,elem,attrs){elem.on("click",function(){scope.openModal("true"==attrs.ismore,attrs.inservicestates,attrs.title,attrs.routingstatustype,attrs.usertypeapp)}),attrs.onclick&&scope.$on(attrs.onclick,function(event,val){scope.openModal("true"==attrs.ismore,attrs.inservicestates,attrs.title,attrs.routingstatustype,attrs.usertypeapp)})}}}]).directive("setFocus",function(){return function(scope,element){element[0].focus(),scope.$on("setFocus",function(e,data){element[0].focus()})}}),angular.module("myApp").directive("activityApprove",["$http","$timeout",function($http,$timeout){var template='<ion-footer-bar class="bar-up-shadow"><div class="row"> <div class="col text-center btn-group-wrap"> <button class="button button-theme button-local button-outline" type="button" ng-click="options.button.cancel()">返回</button><button class="button button-theme button-local" type="button" subbutt ng-click="approve(options.params)" ng-if="auth.agree" >通过</button><button class="button button-theme button-local" type="button" subbutt ng-click="assignData(options.params)" ng-if="auth.assign" >交办</button> <button class="button button-theme button-local button-outline button-more" ng-click="showMoreButton()"><i class="ion-more"></i><ul class="more" ng-if="moreButton"><li ng-click="rejectData(options.params)" ng-if="auth.reject">驳回发起人</li><li ng-click="rejectPreNodeData(options.params)" ng-if="auth.rejectPreNode">驳回上一步</li></ul></button></div></div></ion-footer-bar>';return{scope:{options:"="},template:template,controller:["$scope","$ionicModal","$ionicLoading","$ionicPopup",function($scope,$ionicModal,$ionicLoading,$ionicPopup){$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status&&($scope.currentTaskId=data.result)}),$scope.moreButton=!1,$scope.showMoreButton=function(){$scope.moreButton=!$scope.moreButton};var backProcess=function(isToStart,processState,callback){var params=$.extend({},$scope.options.params,{businessId:$scope.options.businessId,instanceId:$scope.options.instanceId,isToStart:isToStart,processState:processState},$scope.options.globalParams);callback&&callback(params)};$scope.pageData={nextTaskUserId:"",nextUserTaskActId:"",message:""};var approveTemplate=' <ion-modal-view class="auto bar-up-shadow"><div class="bottom-50"><div class="padding"><div class="approve-flow-wrap flow-title" ng-show="nodeNameList && nodeNameList.length > 0 "><div class="title">下一审批节点</div><label class="radio-inline" ng-repeat="node in nodeNameList"><input type="radio" name="1" ng-click="selectNextNode(node)"/>{{node.userTaskName}}</label> </div><div class="approve-flow-wrap flow-title" ng-show="auth.nextUser"><div class="title more">下一节点审批人</div> <input type="text" placeholder="请选择"  user-selector inServiceStates = "1" title="下一节点审批人" routingStatusType="{{routingStatusType}}" userTypeApp="{{nextNodeApprover}}"  on-select="selectUser(item)"  readonly ng-model="pageData.nextUserName"/></div></div><div class="padding button-modal"><input class="form-control" type="input" readonly placeholder="输入处理意见，最多50个字" ng-model="pageData.message" ng-click="showHandleIdea()"/></div></div><ion-footer-bar><div class="row"><div class="col text-center btn-group-wrap"><button class="button button-theme button-local button-outline" ng-click="closePassApproveModal()">取消</button><button class="button button-theme button-local" ng-click="checkData()">确定</button></div></div></ion-footer-bar></ion-modal-view>';$scope.modal=$ionicModal.fromTemplate(approveTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.openModal=function(){$scope.modal.show()},$scope.closePassApproveModal=function(){$scope.modal.hide()};var assignedTemplate=' <ion-modal-view class="auto bar-up-shadow"><div class="bottom-50"><div class="padding"><div class="approve-flow-wrap flow-title"> <div class="title more">请选择交办人</div> <input type="text" placeholder="请选择"  user-selector inServiceStates = "1" title="交办人" routingStatusType="{{routingStatusType}}" userTypeApp="{{assignedPerson}}"  on-select="selectUser(item)"  readonly ng-model="pageData.nextUserName"/></div></div><div class="padding button-modal"><input class="form-control" type="input" readonly placeholder="输入处理意见，最多50个字" ng-model="pageData.message" ng-click="showHandleIdea()"/></div></div><ion-footer-bar><div class="row"><div class="col text-center btn-group-wrap"><button class="button button-theme button-local button-outline" ng-click="closeAssignedModal()">取消</button><button class="button button-theme button-local" ng-click="checkAssignedData()">确定</button></div></div></ion-footer-bar></ion-modal-view>';$scope.assignedModal=$ionicModal.fromTemplate(assignedTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.openAssignedModal=function(){$scope.assignedModal.show()},$scope.closeAssignedModal=function(){$scope.assignedModal.hide()};var rejectTemplate=' <ion-modal-view class="auto bar-up-shadow"><div class="bottom-50"><div class="padding button-modal"><input class="form-control" type="input" readonly placeholder="输入处理意见，最多50个字" ng-model="pageData.message" ng-click="showHandleIdea()"/></div></div><ion-footer-bar><div class="row"><div class="col text-center btn-group-wrap"><button class="button button-theme button-local button-outline" ng-click="closeRejectModal()">取消</button><button class="button button-theme button-local" ng-click="sure(opreaTionType)">确定</button></div></div></ion-footer-bar></ion-modal-view>';$scope.rejectModal=$ionicModal.fromTemplate(rejectTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.opreaTionType="",$scope.openRejectModal=function(type){$scope.opreaTionType=type,$scope.rejectModal.show()},$scope.closeRejectModal=function(){$scope.rejectModal.hide()},$scope.showHandleIdea=function(){$scope.show={};$ionicPopup.show({template:'<textarea type="input" rows="5" class="form-control"  placeholder="输入处理意见，最多50个字"  maxlength="50" ng-model="pageData.message"></textarea>',title:"处理意见(非必填)",scope:$scope,buttons:[{text:"取消",type:"button-local button-theme button-outline",onTap:function(e){$scope.pageData.message=""}},{text:"确定",type:"button-local button-theme",onTap:function(e){$scope.pageData.message=$scope.pageData.message}}]})},$scope.checkData=function(){return $scope.nodeNameList&&$scope.nodeNameList.length>0&&!$scope.pageData.nextUserTaskActId?void $scope.notifyErrorMsg("请选择下一审批节点!"):($scope.closePassApproveModal(),void $scope.agree($scope.pageData))},$scope.checkAssignedData=function(){return $scope.pageData.nextTaskUserId?($scope.closeAssignedModal(),void $scope.assign($scope.pageData)):void $scope.notifyErrorMsg("请选择下一审批人!")},$scope.sure=function(type){$scope.closeRejectModal(),1==type?$scope.reject($scope.pageData):$scope.rejectPreNode($scope.pageData)};var defaultBackProcess=function(params){},assign=function(){ynuiSelectorService.userSelector(function(item){$.extend({businessId:$scope.options.businessId,instanceId:$scope.options.instanceId,nextAssignee:item.id},$scope.options.buttonParams.assign)},{gridOptions:{useSingleChoice:!0}})};$scope.notifyErrorMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.urge=function(){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.notifyErrorMsg(data.message)})};var saveDraft=function(){},repeal=function(){backProcess(!0,7,$scope.options.button.repeal)},deleteDraft=function(){},deleteProcess=function(){},defaultOptions={instanceId:null,applyId:null,processStatus:null,businessId:null,definitionKey:null,getUserAuth:getUserAuth,currentTaskId:null,button:{reject:defaultBackProcess,rejectPreNode:defaultBackProcess,saveDraft:saveDraft,repeal:defaultBackProcess,deleteDraft:deleteDraft,deleteProcess:deleteProcess,assign:assign,cancel:function(){$scope.options.buttonAction?$scope.options.buttonAction():yn.plugin.yncordova.close()}},buttonParams:{},params:{},buttonAction:null,getUserAuth:getUserAuth};$scope.options=$.extend(!0,defaultOptions,$scope.options),$scope.routingStatusType=$scope.options.routingStatusType,$scope.nextNodeApprover=$scope.options.nextNodeApprover,$scope.assignedPerson=$scope.options.assignedPerson;var initAuthButton=function(coordinate){if($scope.auth.chart=!0,$scope.auth.approveHistory=!0,$scope.auth.comment=!0,coordinate){4!=coordinate.length;var identity=coordinate[0],status=coordinate[1],specialty=coordinate[2];$scope.auth.nextUser=coordinate[3],$scope.auth.nextNode=coordinate[4],0==identity&&0==status&&($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!0,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),1==identity&&0==status&&($scope.auth.chart=!1,$scope.auth.approveHistory=!1),2==identity&&0==status&&($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!0,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),0==identity&&2==status&&($scope.auth.startProcess=!0,$scope.auth.deleteProcess=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),2==identity&&2==status&&($scope.auth.startProcess=!0,$scope.auth.deleteProcess=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),0==identity&&3==status&&($scope.auth.repeal=!0,$scope.auth.urge=!0),1==identity&&3==status&&($scope.auth.agree=!0,$scope.auth.assign=!0,$scope.auth.reject=!0,$scope.auth.rejectPreNode=!0,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status?($scope.currentTaskId=data.result,null!=$scope.currentTaskId&&$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByTaskId?",null,{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.nodeNameList=data.result})):$scope.notifyErrorMsg("获取数据失败！")})),2==identity&&3==status&&($scope.auth.repeal=!0,$scope.auth.urge=!0,$scope.auth.agree=!0,$scope.auth.assign=!0,$scope.auth.reject=!0,$scope.auth.rejectPreNode=!0,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status?($scope.currentTaskId=data.result,null!=$scope.currentTaskId&&$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByTaskId?",null,{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.nodeNameList=data.result})):$scope.notifyErrorMsg("获取数据失败！")})),$scope.startProcess=function(params){return $scope.nodeNameList&&$scope.nodeNameList.length>0&&!params.nextNode?void $scope.notifyErrorMsg("请选择下一节点!"):void(2==status&&$scope.options.instanceId?$scope.options.button.agree(params):$scope.options.button.startProcess(params))},-1==specialty?($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!1,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0):-2==specialty?$scope.auth.approveHistory=!1:-3==specialty?$scope.auth.approveHistory=!1:1==specialty?$scope.auth.comment=!1:2==specialty?$scope.auth.nextUser=!1:3==specialty&&($scope.auth.startProcess=!1,$scope.auth.deleteProcess=!1);var hideAll=coordinate.every(function(item){return null==item});hideAll&&($scope.auth.agree=!1,$scope.auth.assign=!1,$scope.auth.urge=!1,$scope.auth.reject=!1,$scope.auth.rejectPreNode=!1,$scope.auth.startProcess=!1,$scope.auth.saveDraft=!1,$scope.auth.repeal=!1,$scope.auth.deleteDraft=!1,$scope.auth.chart=!1,$scope.auth.approveHistory=!1,$scope.auth.cancel=!1,$scope.auth.nextUser=!1)}},getUserAuth=function(callback){$http.get(basePath+"/third/xtbgactivity/getXTBGActivityCoordinate",{params:{processDefinitionId:$scope.options.definitionKey,processInstanceId:$scope.options.instanceId,applyId:$scope.options.applyId,processStatus:$scope.options.processStatus}}).success(function(data){0==data.status&&callback(data.result)})};$scope.auth={agree:!1,assign:!1,urge:!1,reject:!1,rejectPreNode:!1,startProcess:!1,saveDraft:!1,repeal:!1,deleteDraft:!1,deleteProcess:!1,chart:!1,approveHistory:!1,cancel:!1};var initData=function(){$scope.options.getUserAuth?$scope.options.getUserAuth(initAuthButton):getUserAuth(initAuthButton)};initData(),$scope.selectUser=function(item){$scope.pageData.nextUserName=item.name,$scope.pageData.nextTaskUserId=item.id},$scope.selectNextNode=function(item){$scope.pageData.nextUserTaskActId=item.usertTaskId},$scope.approve=function(){$scope.pageData.message="",$scope.pageData.nextTaskUserId=null,$scope.pageData.nextUserName=null,$scope.openModal()},$scope.assignData=function(){$scope.pageData.message="",$scope.pageData.nextTaskUserId=null,$scope.pageData.nextUserName=null,$scope.openAssignedModal()},$scope.rejectData=function(){$scope.pageData.message="",$scope.openRejectModal(1)},$scope.rejectPreNodeData=function(){$scope.pageData.message="",$scope.openRejectModal(2)},$scope.agree=function(params){$scope.options.button.agree(params)},$scope.assign=function(params){$scope.options.button.assign(params)},$scope.reject=function(params){$scope.options.button.reject($scope.pageData)},$scope.rejectPreNode=function(params){$scope.options.button.rejectPreNode($scope.pageData)},$scope.repeal=function(){repeal()}}]}}]),angular.module("myApp").directive("activityApply",["$http",function($http){var template='<ion-footer-bar class="bar-up-shadow"><div class="row"> <div class="col text-center btn-group-wrap"> <button class="button button-theme button-local button-outline" type="button" ng-click="options.button.cancel()">返回</button><button class="button button-theme button-local" type="button" subbutt ng-click="urge()" ng-if="auth.urge">催办</button><button class="button button-theme button-local" type="button" subbutt ng-click="startProcess(options.params)" ng-if="auth.startProcess" >提交审批</button><button class="button button-theme button-local" type="button" ng-click="repeal()" ng-if="auth.repeal" ng-if="auth.repeal">撤销</button><button class="button button-theme button-local" type="button" ng-click="options.button.deleteProcess()" ng-if="auth.deleteProcess" >删除</button></div></div></ion-footer-bar>';return{scope:{options:"="},template:template,controller:["$scope","$ionicModal","$ionicLoading","$ionicPopup",function($scope,$ionicModal,$ionicLoading,$ionicPopup){$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status&&($scope.currentTaskId=data.result)});var backProcess=function(isToStart,processState,callback){var params=$.extend({},$scope.options.params,{businessId:$scope.options.businessId,instanceId:$scope.options.instanceId,isToStart:isToStart,processState:processState},$scope.options.globalParams);callback&&callback(params)},defaultBackProcess=function(params){},assign=function(){ynuiSelectorService.userSelector(function(item){$.extend({businessId:$scope.options.businessId,instanceId:$scope.options.instanceId,nextAssignee:item.id},$scope.options.buttonParams.assign)},{gridOptions:{useSingleChoice:!0}})};$scope.notifyErrorMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.urge=function(){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.notifyErrorMsg(data.message)})};var reject=function(){backProcess(!0,4,$scope.options.button.reject)},rejectPreNode=function(){backProcess(!1,6,$scope.options.button.rejectPreNode)},saveDraft=function(){},repeal=function(){backProcess(!0,7,$scope.options.button.repeal)},deleteDraft=function(){},deleteProcess=function(){},defaultOptions={instanceId:null,applyId:null,processStatus:null,businessId:null,definitionKey:null,getUserAuth:getUserAuth,currentTaskId:null,button:{reject:defaultBackProcess,rejectPreNode:defaultBackProcess,saveDraft:saveDraft,repeal:defaultBackProcess,deleteDraft:deleteDraft,deleteProcess:deleteProcess,assign:assign,cancel:function(){$scope.options.buttonAction?$scope.options.buttonAction():yn.plugin.yncordova.close()}},buttonParams:{},params:{},buttonAction:null};$scope.options=$.extend(!0,defaultOptions,$scope.options);var initAuthButton=function(coordinate){if($scope.auth.chart=!0,$scope.auth.approveHistory=!0,$scope.auth.comment=!0,coordinate){4!=coordinate.length;var identity=coordinate[0],status=coordinate[1],specialty=coordinate[2];$scope.auth.nextUser=coordinate[3],$scope.auth.nextNode=coordinate[4],0==identity&&0==status&&($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!0,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),1==identity&&0==status&&($scope.auth.chart=!1,$scope.auth.approveHistory=!1),2==identity&&0==status&&($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!0,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),0==identity&&2==status&&($scope.auth.startProcess=!0,$scope.auth.deleteProcess=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),2==identity&&2==status&&($scope.auth.startProcess=!0,$scope.auth.deleteProcess=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result})),0==identity&&3==status&&($scope.auth.repeal=!0,$scope.auth.urge=!0),1==identity&&3==status&&($scope.auth.agree=!0,$scope.auth.assign=!0,$scope.auth.reject=!0,$scope.auth.rejectPreNode=!0,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status?($scope.currentTaskId=data.result,null!=$scope.currentTaskId&&$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByTaskId?",null,{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.nodeNameList=data.result})):$scope.notifyErrorMsg("获取数据失败！")})),2==identity&&3==status&&($scope.auth.repeal=!0,$scope.auth.urge=!0,$scope.auth.agree=!0,$scope.auth.assign=!0,$scope.auth.reject=!0,$scope.auth.rejectPreNode=!0,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status?($scope.currentTaskId=data.result,null!=$scope.currentTaskId&&$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByTaskId?",null,{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.nodeNameList=data.result})):$scope.notifyErrorMsg("获取数据失败！")})),$scope.startProcess=function(params){2==status&&$scope.options.instanceId?$scope.options.button.agree(params):$scope.options.button.startProcess(params)},-1==specialty?($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!1,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0):-2==specialty?$scope.auth.approveHistory=!1:-3==specialty?$scope.auth.approveHistory=!1:1==specialty?$scope.auth.comment=!1:2==specialty?$scope.auth.nextUser=!1:3==specialty&&($scope.auth.startProcess=!1,
$scope.auth.deleteProcess=!1);var hideAll=coordinate.every(function(item){return null==item});hideAll&&($scope.auth.agree=!1,$scope.auth.assign=!1,$scope.auth.urge=!1,$scope.auth.reject=!1,$scope.auth.rejectPreNode=!1,$scope.auth.startProcess=!1,$scope.auth.saveDraft=!1,$scope.auth.repeal=!1,$scope.auth.deleteDraft=!1,$scope.auth.chart=!1,$scope.auth.approveHistory=!1,$scope.auth.cancel=!1,$scope.auth.nextUser=!1)}},getUserAuth=function(callback){$http.get(basePath+"/third/xtbgactivity/getXTBGActivityCoordinate",{params:{processDefinitionId:$scope.options.definitionKey,processInstanceId:$scope.options.instanceId,applyId:$scope.options.applyId,processStatus:$scope.options.processStatus}}).success(function(data){0==data.status&&callback(data.result)})};$scope.auth={agree:!1,assign:!1,urge:!1,reject:!1,rejectPreNode:!1,startProcess:!1,saveDraft:!1,repeal:!1,deleteDraft:!1,deleteProcess:!1,chart:!1,approveHistory:!1,cancel:!1};var initData=function(){$scope.options.getUserAuth?$scope.options.getUserAuth(initAuthButton):getUserAuth(initAuthButton)};initData(),$scope.selectUser=function(){ynuiSelectorService.userSelector(function(item){$scope.options.params.nextTaskUserStr=item.name,$scope.options.params.nextTaskUserId=item.id,$scope.$apply()},{gridOptions:{useSingleChoice:!0}})},$scope.selectNextNode=function(item){$scope.options.params.nextNode=item.usertTaskId},$scope.agree=function(params){$scope.options.button.agree(params)},$scope.assign=function(params){$scope.options.button.assign(params)},$scope.reject=function(params){reject()},$scope.rejectPreNode=function(params){rejectPreNode()},$scope.repeal=function(){repeal()}}]}}]),angular.module("myApp").directive("activityView",["$http",function($http){var template='<div class="approving-title signal-wrap"><h5>{{approveData.activityTitle}}</h5><p class="text-gray font-12">当前处理人&nbsp;:&nbsp;{{approveData.nowApproveName ?approveData.nowApproveName:"无"}}</p><div class="signal approving" ng-show="options.processScheduleStates ==3"></div><div class="signal back-edit" ng-show="options.processScheduleStates ==2"></div><div class="signal approved" ng-show="options.processScheduleStates ==1"></div></div><div class="approving-flow font-12 padding" ng-if="approveData.lastApproveName"><p class="text-gray no-margin">上一审批人&nbsp;:&nbsp;<span>{{approveData.lastApproveName?approveData.lastApproveName:"无"}}</span></p><p class="no-margin"><span class="text-danger">审批意见&nbsp;:&nbsp;</span><span>{{approveData.message?approveData.message:"无"}}</span></p></div>';return{scope:{options:"="},template:template,controller:["$scope","$ionicModal","$ionicLoading","$ionicPopup",function($scope,$ionicModal,$ionicLoading,$ionicPopup){$scope.optionsData=angular.copy($scope.options),$http.post(basePath+"/third/xtbgactivity/findJSTXActHisTask?processInstanceId="+$scope.options.actExecutionProcinstId).success(function(data){0==data.status&&($scope.approveData=data.result)})}]}}]),angular.module("myApp").directive("nodeSelector",["$http",function($http){var template='<div class="item item-input"  ng-show="nodeNameList && nodeNameList.length > 0  && auth.nextNode" ><span class="input-label">下一审批节点</span><input slide-select init-data="nodeNameList" name-field="userTaskName" ng-model="node.nextNodeName"  selected-obj="usertTaskId" on-select="selectNextNode(item)" readonly="readonly" type="text" placeholder="请选择"></div><div class="item item-input" ng-show="auth.nextUser"><span class="input-label">审批人</span> <input type="text" placeholder="请选择"  user-selector inServiceStates = "1" title="审批人" routingStatusType="{{routingStatusType}}" userTypeApp="{{userTypeApp}}" on-select="selectUser(item)"  readonly ng-model="node.nextUserName"/></div>';return{scope:{options:"=",node:"="},template:template,controller:["$scope","$ionicModal","$ionicLoading","$ionicPopup",function($scope,$ionicModal,$ionicLoading,$ionicPopup){$scope.auth={};var initAuthButton=function(coordinate){if(coordinate){4!=coordinate.length;var identity=coordinate[0],status=coordinate[1];coordinate[2];$scope.auth.nextUser=coordinate[3],$scope.node.hasUser=coordinate[3],$scope.auth.nextNode=coordinate[4],0==identity&&0==status&&($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!0,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){"0"==data.status&&($scope.nodeNameList=data.result,$scope.nodeNameList&&$scope.nodeNameList.length>0&&($scope.node.hasNode=!0))})),1==identity&&0==status&&($scope.auth.chart=!1,$scope.auth.approveHistory=!1),2==identity&&0==status&&($scope.auth.startProcess=!0,$scope.auth.saveDraft=!0,$scope.auth.deleteDraft=!0,$scope.auth.approveHistory=!1,$scope.auth.cancel=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result,$scope.nodeNameList&&$scope.nodeNameList.length>0&&($scope.node.hasNode=!0)})),0==identity&&2==status&&($scope.auth.startProcess=!0,$scope.auth.deleteProcess=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result,$scope.nodeNameList&&$scope.nodeNameList.length>0&&($scope.node.hasNode=!0)})),2==identity&&2==status&&($scope.auth.startProcess=!0,$scope.auth.deleteProcess=!0,$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByActivityKey?",null,{params:{processDefinitionKey:$scope.options.definitionKey}}).success(function(data){$scope.nodeNameList=data.result,$scope.nodeNameList&&$scope.nodeNameList.length>0&&($scope.node.hasNode=!0)})),0==identity&&3==status&&($scope.auth.repeal=!0,$scope.auth.urge=!0),1==identity&&3==status&&($scope.auth.agree=!0,$scope.auth.assign=!0,$scope.auth.reject=!0,$scope.auth.rejectPreNode=!0,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status?($scope.currentTaskId=data.result,null!=$scope.currentTaskId&&$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByTaskId?",null,{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.nodeNameList=data.result,$scope.nodeNameList&&$scope.nodeNameList.length>0&&($scope.node.hasNode=!0)})):$scope.notifyErrorMsg("获取数据失败！")})),2==identity&&3==status&&($scope.auth.repeal=!0,$scope.auth.urge=!0,$scope.auth.agree=!0,$scope.auth.assign=!0,$scope.auth.reject=!0,$scope.auth.rejectPreNode=!0,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.options.instanceId).success(function(data){0==data.status?($scope.currentTaskId=data.result,null!=$scope.currentTaskId&&$http.post(basePath+"/third/xtbgactivity/getUserTaskIdsByTaskId?",null,{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.nodeNameList=data.result,$scope.nodeNameList&&$scope.nodeNameList.length>0&&($scope.node.hasNode=!0)})):$scope.notifyErrorMsg("获取数据失败！")}))}},getUserAuth=function(callback){$http.get(basePath+"/third/xtbgactivity/getXTBGActivityCoordinate",{params:{processDefinitionId:$scope.options.definitionKey,processInstanceId:$scope.options.instanceId,applyId:$scope.options.applyId,processStatus:$scope.options.processStatus}}).success(function(data){0==data.status&&callback(data.result)})},initData=function(){$scope.options.getUserAuth?$scope.options.getUserAuth(initAuthButton):getUserAuth(initAuthButton)};initData();var defaultOptions={instanceId:null,applyId:null,processStatus:null,businessId:null,definitionKey:null,getUserAuth:getUserAuth};$scope.options=angular.extend(defaultOptions,$scope.options),$scope.selectNextNode=function(item){$scope.node.nextNodeName=item.userTaskName,$scope.node.nextUserTaskActId=item.usertTaskId},$scope.selectUser=function(item){$scope.node.nextUserName=item.name,$scope.node.nextTaskUserId=item.id},$scope.routingStatusType=$scope.options.routingStatusType,$scope.userTypeApp=$scope.options.userTypeApp}]}}]),angular.module("myApp").directive("costSelect",["$http",function($http){var template='<ion-modal-view class="auto min-modal-height"><ion-header-bar class="bar-stable"><h1 class="title">{{slideTitle}}</h1><button class="button button-clear button-custom" ng-click="closeModal()">取消</button></ion-header-bar><div class="padding has-header button-list"><div class="slide-select-buttons"><button  ng-repeat="item in initData" class="button button-local button-theme button-outline margin-top-5 margin-left-5" ng-class="{active:selectedObj==item}" ng-click="onSelect(item)">{{item[nameField]}}</button></div></div></ion-modal-view>';return{scope:{modal:"=",initData:"=",nameField:"@",slideTitle:"@",selectedObj:"=",select:"&onSelect"},template:template,controller:["$scope","$ionicModal",function($scope,$ionicModal){$scope.costSelect=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-up"}),$scope.openModal=function(){$scope.costSelect.show()},$scope.closeModal=function(){$scope.costSelect.hide()},$scope.$on("$destroy",function(){$scope.costSelect.remove()}),$scope.$on("modal.hidden",function(){}),$scope.$on("modal.removed",function(){}),$scope.onSelect=function(item){$scope.selectedObj=item,$scope.select({item:item}),$scope.closeModal()}}],link:function(scope,element,attrs){element.on("click",function(){scope.slideTitle=scope.slideTitle||"请选择",scope.openModal()})}}}]),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("business_journal",{homePage:!0,url:"/business_journal",templateUrl:"views/business_trip_journal/business_journal.html",controller:"businessJournalController"}).state("view_fee",{url:"/view_fee",templateUrl:"views/business_trip_journal/view_fee.html",controller:"viewFeeController"}).state("add_trans",{url:"/add_trans",templateUrl:"views/business_trip_journal/add_trans_fee.html",controller:"addTransController"}).state("view_trans",{url:"/view_trans",templateUrl:"views/business_trip_journal/view_trans.html",controller:"viewTransController"}).state("add_hotel",{url:"/add_hotel",templateUrl:"views/business_trip_journal/add_hotel_fee.html",controller:"addHotelController"}).state("view_hotel",{url:"/view_hotel",templateUrl:"views/business_trip_journal/view_hotel.html",controller:"viewHotelController"}).state("add_other",{url:"/add_other",templateUrl:"views/business_trip_journal/add_other_fee.html",controller:"addOtherController"}).state("view_other",{url:"/view_other",templateUrl:"views/business_trip_journal/view_other.html",controller:"viewOtherController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function businessJournalController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.goTo=function(item,list){angular.forEach(list,function(val){item.selecter=!1,item.monthDay==val.monthDay&&(item.selecter=!0)}),$location.path("/view_fee").search({date:item.dataTime})},$scope.dataList=[],$scope.showInfo=!1;var i=3;$scope.loadData=function(item){item||(item=""),i+=3;var pageNumber=3,pageSize=i;if(i>15)return void($scope.showInfo=!0);var searchObj={pageNumber:pageNumber,pageSize:pageSize,showDate:item};$http.get(basePath+"/third/businessjournal/findLatelyTimeAndDate",{params:searchObj}).success(function(data){"0"==data.status&&($scope.dataList=$scope.dataList.concat(data.result),$scope.showDate=$scope.dataList[$scope.dataList.length-1],$scope.searchDate=$scope.showDate[$scope.showDate.length-1].dataTime,$scope.$broadcast("scroll.infiniteScrollComplete"))})},$scope.getClass=function(item){return"[今天]"==item.dateDay?"text-green":"[昨天]"==item.dateDay?"text-theme":"text-gray"}}angular.module("myApp").controller("businessJournalController",businessJournalController),businessJournalController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function addHotelController($scope,$ionicModal,$http,$filter,$ionicLoading,$ionicScrollDelegate,$ionicPopup,$location){$scope.indexCount=0,$scope.dateBusin=$location.search().backDate,$scope.backTime=$location.search().backDate,$scope.showTime=$location.search().showTime,$scope.id=$location.search().id,$scope.area={},$scope.hotel={},$scope.selectModel={},$scope.jstxAddHotelFeeDTO={traDate:"",xzglHotelTraId:"",xzglHotelTraName:"",xzglHotelTraCode:"",xzglHotelTraAddress:"",provinceId:"",provinceName:"",cityId:"",cityName:"",areaId:"",areaName:"",travelHotelType:"",travelHotelName:"",money:""};var compare={};$http.get(basePath+"/third/businessjournal/findTravelHotRoomTypeCodeTable?").success(function(value){$scope.travelHotelData=value}),$scope.dateTimeList=[],$scope.backDate=$scope.dateBusin,$scope.refreshGrid=function(func){$scope.dateBusin&&$scope.id?$http.get(basePath+"/third/businessjournal/findJSTXAddHotelFeeByTime?date1="+$scope.dateBusin+"&index=0").success(function(data){0!=data.result.length&&($scope.totalList=data.result,$scope.jstxAddHotelFeeDTO=data.result[data.result.length-1],compare=angular.copy($scope.jstxAddHotelFeeDTO),$scope.area={provinceId:$scope.jstxAddHotelFeeDTO.provinceId,cityId:$scope.jstxAddHotelFeeDTO.cityId,areaId:$scope.jstxAddHotelFeeDTO.areaId},$scope.area.name=$scope.jstxAddHotelFeeDTO.areaId?$scope.jstxAddHotelFeeDTO.areaName+"("+$scope.jstxAddHotelFeeDTO.cityName+")":$scope.jstxAddHotelFeeDTO.cityName+"("+$scope.jstxAddHotelFeeDTO.provinceName+")",$scope.hotel.name=$scope.jstxAddHotelFeeDTO.xzglHotelTraName,$scope.selectModel.dictName=$scope.jstxAddHotelFeeDTO.travelHotelName),func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"}):$http.get(basePath+"/third/businessjournal/getDateTime?").success(function(value){$scope.dateTime=value,$scope.dateTimeList=[];for(var i=0;i<value.length;i++){var dateTime={time:"",name:"",check:"",isDis:""};dateTime.time=value[i].date,dateTime.name=0==i?"前天":1==i?"昨天":"今天("+value[i].monthDay+")",i==value.length-1?dateTime.check=!0:dateTime.check=!1,$scope.dateTimeList.push(dateTime)}$http.get(basePath+"/third/businessjournal/findJSTXAddHotelFeeByIsTimeTure?date1="+$scope.dateTimeList[0].time+"&date2="+$scope.dateTimeList[1].time+"&date3="+$scope.dateTimeList[2].time).success(function(data){$scope.dateStrList=data,$scope.indexCount=0;for(var timeI=0;timeI<$scope.dateTimeList.length;timeI++){var dateTimeIsStr=$scope.dateTimeList[timeI],dateIsStr=$scope.dateStrList[timeI];"0"==dateIsStr?dateTimeIsStr.isDis=!1:($scope.indexCount+=1,dateTimeIsStr.isDis=!0)}for(var is=0,os=0,ds=0,i=0;i<$scope.dateTimeList.length;i++){var y=$scope.dateTimeList[i];1==y.isDis&&(y.check=!1,0==i&&is++,1==i&&os++,2==i&&(y.name="今天",ds++))}0==ds||(0==os?($scope.dateTimeList[1].check=!0,$scope.dateTimeList[1].name="昨天("+$scope.dateTime[1].monthDay+")"):0==is&&($scope.dateTimeList[0].check=!0,$scope.dateTimeList[0].name="前天("+$scope.dateTime[0].monthDay+")")),func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"}),$http.get(basePath+"/third/businessjournal/findJSTXAddHotelFeeByTime?date1="+$scope.dateTimeList[0].time+"&date2="+$scope.dateTimeList[1].time+"&date3="+$scope.dateTimeList[2].time+"&index=1").success(function(data){0!=data.result.length&&($scope.totalList=data.result,$scope.jstxAddHotelFeeDTO=data.result[data.result.length-1],compare=angular.copy($scope.jstxAddHotelFeeDTO),$scope.area={provinceId:$scope.jstxAddHotelFeeDTO.provinceId,cityId:$scope.jstxAddHotelFeeDTO.cityId,areaId:$scope.jstxAddHotelFeeDTO.areaId},$scope.area.name=$scope.jstxAddHotelFeeDTO.areaId?$scope.jstxAddHotelFeeDTO.areaName+"("+$scope.jstxAddHotelFeeDTO.cityName+")":$scope.jstxAddHotelFeeDTO.cityName+"("+$scope.jstxAddHotelFeeDTO.provinceName+")",$scope.hotel.name=$scope.jstxAddHotelFeeDTO.xzglHotelTraName,$scope.selectModel.dictName=$scope.jstxAddHotelFeeDTO.travelHotelName),func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"})})},$scope.refresh=function(item){if(1==item.isDis){$ionicPopup.alert({title:"提示",template:'<h5 class="margin-bottom-0">'+item.name+"已有酒店费用记录,不能再添加！</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})}else for(var i=0;i<$scope.dateTimeList.length;i++)angular.equals($scope.dateTimeList[i],item)?($scope.dateTimeList[i].check=!0,"前天"==$scope.dateTimeList[i].name||"前天("+$scope.dateTime[0].monthDay+")"==$scope.dateTimeList[i].name?($scope.dateTimeList[0].name="前天("+$scope.dateTime[0].monthDay+")",$scope.dateTimeList[1].name="昨天",$scope.dateTimeList[2].name="今天"):"昨天"==$scope.dateTimeList[i].name||"昨天("+$scope.dateTime[1].monthDay+")"==$scope.dateTimeList[i].name?($scope.dateTimeList[0].name="前天",$scope.dateTimeList[1].name="昨天("+$scope.dateTime[1].monthDay+")",$scope.dateTimeList[2].name="今天"):($scope.dateTimeList[0].name="前天",$scope.dateTimeList[1].name="昨天",$scope.dateTimeList[2].name="今天("+$scope.dateTime[2].monthDay+")")):$scope.dateTimeList[i].check=!1},$scope.refreshEdit=function(){$ionicLoading.show({template:"正在刷新..."}),$scope.refreshGrid(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})},$scope.refreshEdit(),$scope.areaSelect=function(item){$scope.jstxAddHotelFeeDTO.provinceId=item[0].id,$scope.jstxAddHotelFeeDTO.cityId=item[1].id,item.length>2?$scope.jstxAddHotelFeeDTO.areaId=item[2].id:$scope.jstxAddHotelFeeDTO.areaId="",$scope.area.name=item.length>2?item[2].name+"("+item[1].name+")":item[1].name+"("+item[0].name+")"},$scope.hotelSelect=function(item){$scope.jstxAddHotelFeeDTO.provinceId=item.provinceId,$scope.jstxAddHotelFeeDTO.cityId=item.cityId,$scope.jstxAddHotelFeeDTO.areaId=item.areaId,$scope.area.name=item.area,$scope.jstxAddHotelFeeDTO.xzglHotelTraId=item.id,$scope.jstxAddHotelFeeDTO.xzglHotelTraName=item.name,$scope.jstxAddHotelFeeDTO.xzglHotelTraAddress=item.address,$scope.jstxAddHotelFeeDTO.xzglHotelTraCode=item.hotelTypeCode},$scope.diySelect=function(item){$scope.jstxAddHotelFeeDTO.travelHotelType=item.dictCode},$scope.submitData=function(isBack,func){$http.post(basePath+"/third/businessjournal/saveJSTXAddHotelFee?",$scope.jstxAddHotelFeeDTO).success(function(data){if(func&&func(),"0"==data.status)$ionicLoading.show({template:"提交成功"}),setTimeout(function(){$ionicLoading.hide()},500),1==isBack?setTimeout(function(){$scope.jstxAddHotelFeeDTO.traDate?$location.path("/view_fee").search({date:$scope.jstxAddHotelFeeDTO.traDate}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})})},500):$scope.refreshEdit();else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})}}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"})},$scope.dateBusinFun=function(data){$ionicPopup.alert({title:"提示",template:'<h5 class="margin-bottom-0">'+data+"不能为空!</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})},$scope.submit=function(isBack){if($scope.id)$scope.jstxAddHotelFeeDTO.traDate=$scope.dateBusin;else for(var i=0;i<$scope.dateTimeList.length;i++){var date=$scope.dateTimeList[i];1==date.check&&($scope.jstxAddHotelFeeDTO.traDate=date.time)}return $scope.jstxAddHotelFeeDTO.money>999999999||!/^\d*\.?\d{0,2}$/.test($scope.jstxAddHotelFeeDTO.money)?($scope.notifyMsg("金额只能由小于9位的整数或1到2位小数组成!"),!1):$scope.jstxAddHotelFeeDTO.money?$scope.jstxAddHotelFeeDTO.traDate?$scope.jstxAddHotelFeeDTO.provinceId&&$scope.jstxAddHotelFeeDTO.cityId?$scope.jstxAddHotelFeeDTO.xzglHotelTraName?$scope.jstxAddHotelFeeDTO.travelHotelType?($ionicLoading.show({template:"正在提交..."}),void $scope.submitData(isBack,function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})):($scope.notifyMsg("房型不能为空!"),!1):($scope.notifyMsg("所住酒店不能为空!"),!1):($scope.notifyMsg("所在地区不能为空!"),!1):($scope.notifyMsg("费用日期不能为空!"),!1):($scope.notifyMsg("金额不能为空!"),!1)},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},800)},$scope.cancel=function(){$scope.jstxAddHotelFeeDTO.traDate?$location.path("/view_fee").search({date:$scope.jstxAddHotelFeeDTO.traDate}):$scope.backTime?$location.path("/view_fee").search({date:$scope.backTime}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})})},$scope.showConfirm=function(){$ionicPopup.confirm({title:"返回提示",template:'<h5 class="margin-bottom-0">返回后当前编辑数据将丢失,确定要返回吗？</h5>',buttons:[{text:"继续编辑",type:"button-outline button-theme button-local"},{text:"确定返回",type:"button-theme button-local",onTap:function(e){$scope.cancel()}}]})},$scope.doBack=function(){angular.equals($scope.jstxAddHotelFeeDTO,compare)?$scope.cancel():$scope.showConfirm()},$scope.selectArea=function(){angular.element("#area").click()},$scope.clickDateBusin=function(){$ionicLoading.show({template:"不允许修改日期！"}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("addHotelController",addHotelController),addHotelController.$inject=["$scope","$ionicModal","$http","$filter","$ionicLoading","$ionicScrollDelegate","$ionicPopup","$location"]}(),function(){"use strict";function viewHotelController($scope,$ionicModal,$http,$filter,$ionicLoading,$ionicScrollDelegate,$ionicPopup,$location){$scope.dateBusin=$location.search().backDate,$scope.id=$location.search().id,$scope.showEdit=!1,$scope.showDel=!1,$http.get(basePath+"/third/businessjournal/getOtherFeeDateTime?").success(function(data){if(0==data.status){$scope.queryDate=data.result[0];var editDay=parseInt($scope.compareDate($scope.dateBusin,$scope.queryDate));parseInt(editDay)<3&&($scope.showEdit=!0);var delDay=parseInt($scope.compareDate($scope.dateBusin,$scope.queryDate));parseInt(delDay)<1&&($scope.showDel=!0)}}),$scope.refresh=function(){$http.get(basePath+"/third/businessjournal/findJSTXAddHotelFeeByTime?date1="+$scope.dateBusin+"&index=0").success(function(data){0!=data.result.length&&($scope.showData=data.result[0],$scope.showData.provinceName&&$scope.showData.cityName&&($scope.areaName=$scope.showData.provinceName+$scope.showData.cityName))})},$scope.goBack=function(){$location.path("/view_fee").search({date:$scope.dateBusin})},$scope.del=function(item,index){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除此项费用吗?删除后将无法恢复?</h5>',buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){$http.post(basePath+"/third/commresource/deleteJSTXAddHotelFee?id="+item.id+"&index="+index).success(function(data){if("0"==data.status)$scope.dateBusin?$location.path("/view_fee").search({date:$scope.dateBusin}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})});else{$ionicPopup.alert({title:"删除失败",template:'<h5 class="margin-bottom-0">data.message</h5>',buttons:[{text:"确定",type:"button-theme button-local"}]})}})}}]})},$scope.edit=function(){$location.path("/add_hotel").search({backDate:$scope.dateBusin,id:$scope.id})},$scope.refresh(),$scope.compareDate=function(startDate,endDate){var day="",arr=startDate.split("-"),starttime=new Date(arr[0],arr[1]-1,arr[2]),starttimes=starttime.getTime(),arrs=endDate.split("-"),lktime=new Date(arrs[0],arrs[1]-1,arrs[2]),lktimes=lktime.getTime();return day=(lktimes-starttimes)/864e5}}angular.module("myApp").controller("viewHotelController",viewHotelController),viewHotelController.$inject=["$scope","$ionicModal","$http","$filter","$ionicLoading","$ionicScrollDelegate","$ionicPopup","$location"]}(),function(){"use strict";function addTransController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.dateBusin=$location.search().backDate,$scope.showTime=$location.search().showTime,$scope.id=$location.search().id,$scope.backDate=$location.search().backDate;var compare={};$scope.transFeeFun=function(){$scope.departArea={provinceId:-1,cityId:-1,areaId:-1},$scope.terminiArea={provinceId:-1,cityId:-1,areaId:-1},$scope.selectModel={},$scope.JSTXAddTransFeeDTO={transDate:"",departParentId:"",departParentName:"",departCityId:"",departCityName:"",departAreaId:"",departAreaName:"",depart:"",terminiParentId:"",terminiParentName:"",terminiCityId:"",terminiCityName:"",terminiAreaId:"",terminiAreaName:"",termini:"",areaName:"",vehicle:"",vehicleName:"",money:"",moneyStr:"",message:""},compare=angular.copy($scope.JSTXAddTransFeeDTO)},$scope.transFeeFun(),$http.get(basePath+"/third/businessjournal/findVehicleCodeTable?").success(function(value){$scope.vehicleCodeData=value}),$scope.refreshGrid=function(func){$scope.id?$http.get(basePath+"/third/businessjournal/findJSTXAddTransFeeById?id="+$scope.id).success(function(data){if(0!=data.length){$scope.JSTXAddTransFeeDTO=data[0],compare=angular.copy($scope.JSTXAddTransFeeDTO),$scope.departArea={provinceId:$scope.JSTXAddTransFeeDTO.departParentId,cityId:$scope.JSTXAddTransFeeDTO.departCityId,areaId:$scope.JSTXAddTransFeeDTO.departAreaId},$scope.terminiArea={provinceId:$scope.JSTXAddTransFeeDTO.terminiParentId,cityId:$scope.JSTXAddTransFeeDTO.terminiCityId,areaId:$scope.JSTXAddTransFeeDTO.terminiAreaId};var start=$scope.JSTXAddTransFeeDTO.departParentName+","+$scope.JSTXAddTransFeeDTO.departCityName;null!=$scope.JSTXAddTransFeeDTO.departAreaName&&start+","+$scope.JSTXAddTransFeeDTO.departAreaName,$scope.departArea.name=start;var endName=$scope.JSTXAddTransFeeDTO.terminiParentName+","+$scope.JSTXAddTransFeeDTO.terminiCityName;null!=$scope.JSTXAddTransFeeDTO.terminAreaName&&endName+","+$scope.JSTXAddTransFeeDTO.terminAreaName,$scope.terminiArea.name=endName,$scope.selectModel.dictName=$scope.JSTXAddTransFeeDTO.vehicleName}func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"}):$http.get(basePath+"/third/businessjournal/getDateTime?").success(function(value){$scope.dateTime=value,$scope.dateTimeList=[];for(var i=0;i<value.length;i++){var dateTime={time:"",name:"",check:""};dateTime.time=value[i].date,dateTime.name=0==i?"前天":1==i?"昨天":"今天("+value[i].monthDay+")",i==value.length-1?dateTime.check=!0:dateTime.check=!1,$scope.dateTimeList.push(dateTime)}$scope.showTime&&angular.forEach($scope.dateTimeList,function(val){val.time.indexOf($scope.showTime)>-1&&$scope.refresh(val)}),$scope.transFeeFun(),func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"})},$scope.refresh=function(item){for(var i=0;i<$scope.dateTimeList.length;i++)angular.equals($scope.dateTimeList[i],item)?($scope.dateTimeList[i].check=!0,"前天"==$scope.dateTimeList[i].name||"前天("+$scope.dateTime[0].monthDay+")"==$scope.dateTimeList[i].name?($scope.dateTimeList[0].name="前天("+$scope.dateTime[0].monthDay+")",$scope.dateTimeList[1].name="昨天",$scope.dateTimeList[2].name="今天"):"昨天"==$scope.dateTimeList[i].name||"昨天("+$scope.dateTime[1].monthDay+")"==$scope.dateTimeList[i].name?($scope.dateTimeList[0].name="前天",$scope.dateTimeList[1].name="昨天("+$scope.dateTime[1].monthDay+")",$scope.dateTimeList[2].name="今天"):($scope.dateTimeList[0].name="前天",$scope.dateTimeList[1].name="昨天",$scope.dateTimeList[2].name="今天("+$scope.dateTime[2].monthDay+")")):$scope.dateTimeList[i].check=!1},$scope.refreshEdit=function(){$ionicLoading.show({template:"正在刷新..."}),$scope.refreshGrid(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})},$scope.refreshEdit(),$scope.areaDepartSelect=function(item){3==item.length?($scope.JSTXAddTransFeeDTO.departAreaId=item[2].id,$scope.departName=item[2].name+"("+item[1].name+")"):($scope.JSTXAddTransFeeDTO.departAreaId="",$scope.departName=item[1].name+"("+item[0].name+")"),$scope.JSTXAddTransFeeDTO.departParentId=item[0].id,$scope.JSTXAddTransFeeDTO.departCityId=item[1].id},$scope.areaTerminiSelect=function(item){3==item.length?($scope.JSTXAddTransFeeDTO.terminiAreaId=item[2].id,$scope.terminiName=item[2].name+"("+item[1].name+")"):($scope.JSTXAddTransFeeDTO.terminiAreaId="",$scope.terminiName=item[1].name+"("+item[0].name+")"),$scope.JSTXAddTransFeeDTO.terminiParentId=item[0].id,$scope.JSTXAddTransFeeDTO.terminiCityId=item[1].id},$scope.chooseClick=function(){var temporaryList={name:$scope.terminiArea.name,parentId:$scope.JSTXAddTransFeeDTO.terminiParentId,cityId:$scope.JSTXAddTransFeeDTO.terminiCityId,areaId:$scope.JSTXAddTransFeeDTO.terminiAreaId};$scope.terminiArea.name=$scope.departArea.name,$scope.JSTXAddTransFeeDTO.terminiParentId=$scope.JSTXAddTransFeeDTO.departParentId,$scope.JSTXAddTransFeeDTO.terminiCityId=$scope.JSTXAddTransFeeDTO.departCityId,$scope.JSTXAddTransFeeDTO.terminiAreaId=$scope.JSTXAddTransFeeDTO.departAreaId,$scope.departArea.name=temporaryList.name,$scope.JSTXAddTransFeeDTO.departParentId=temporaryList.parentId,$scope.JSTXAddTransFeeDTO.departCityId=temporaryList.cityId,$scope.JSTXAddTransFeeDTO.departAreaId=temporaryList.areaId},$scope.vehicleSelect=function(item){$scope.JSTXAddTransFeeDTO.vehicle=item.dictCode},$scope.submitData=function(isBack,func){$http.post(basePath+"/third/businessjournal/saveJSTXAddTransFee?",$scope.JSTXAddTransFeeDTO).success(function(data){if(func&&func(),0==data.status)$ionicLoading.show({template:"提交成功"}),setTimeout(function(){$ionicLoading.hide()},500),1==isBack?setTimeout(function(){$scope.JSTXAddTransFeeDTO.transDate?$location.path("/view_fee").search({date:$scope.JSTXAddTransFeeDTO.transDate}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})})},500):($scope.JSTXAddTransFeeDTO.money=0,$scope.JSTXAddTransFeeDTO.message="");else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]})}}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"})},$scope.dateBusinFun=function(data){$ionicPopup.alert({title:"提示",template:'<h5 class="margin-bottom-0">'+data+"不能为空!</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]})},$scope.submit=function(isBack){if($scope.id)$scope.JSTXAddTransFeeDTO.transDate=$scope.dateBusin;else for(var i=0;i<$scope.dateTimeList.length;i++){var date=$scope.dateTimeList[i];1==date.check&&($scope.JSTXAddTransFeeDTO.transDate=date.time)}return $scope.JSTXAddTransFeeDTO.money>999999999||!/^\d*\.?\d{0,2}$/.test($scope.JSTXAddTransFeeDTO.money)?($scope.notifyMsg("金额只能由小于9位的整数或1到2位小数组成!"),!1):$scope.JSTXAddTransFeeDTO.money?$scope.JSTXAddTransFeeDTO.transDate?$scope.JSTXAddTransFeeDTO.vehicle?$scope.JSTXAddTransFeeDTO.departParentId&&$scope.JSTXAddTransFeeDTO.departCityId?$scope.JSTXAddTransFeeDTO.terminiParentId&&$scope.JSTXAddTransFeeDTO.terminiCityId?($ionicLoading.show({template:"正在提交..."}),void $scope.submitData(isBack,function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})):($scope.notifyMsg("目的地不能为空!"),!1):($scope.notifyMsg("出发地不能为空!"),!1):($scope.notifyMsg("出行方式不能为空!"),!1):($scope.notifyMsg("费用日期不能为空!"),!1):($scope.notifyMsg("费用金额不能为空!"),!1)},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},800)},$scope.cancel=function(){$scope.JSTXAddTransFeeDTO.transDate?$location.path("/view_fee").search({date:$scope.JSTXAddTransFeeDTO.transDate}):$scope.backDate?$location.path("/view_fee").search({date:$scope.backDate}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})})},$scope.showConfirm=function(){
$ionicPopup.confirm({title:"返回提示",template:'<h5 class="margin-bottom-0">返回后当前编辑数据将丢失,确定要返回吗?</h5>',buttons:[{text:"继续编辑",type:"button-theme button-local button-outline"},{text:"确定返回",type:"button-theme button-local",onTap:function(e){$scope.cancel()}}]})},$scope.doBack=function(){angular.equals($scope.JSTXAddTransFeeDTO,compare)?$scope.cancel():$scope.showConfirm()},$scope.selectArea=function(index){1==index?angular.element("#departArea").click():angular.element("#terminiArea").click()},$scope.clickDateBusin=function(){$ionicLoading.show({template:"<p>不允许修改日期！</p>"}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("addTransController",addTransController),addTransController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function viewTransController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.date=$location.search().backDate,$scope.id=$location.search().id,$scope.showEdit=!1,$scope.showDel=!1,$http.get(basePath+"/third/businessjournal/getOtherFeeDateTime?").success(function(data){if(0==data.status){$scope.queryDate=data.result[0];var editDay=parseInt($scope.compareDate($scope.date,$scope.queryDate));parseInt(editDay)<3&&($scope.showEdit=!0);var delDay=parseInt($scope.compareDate($scope.date,$scope.queryDate));parseInt(delDay)<1&&($scope.showDel=!0)}}),$scope.refreshGrid=function(func){$http.get(basePath+"/third/businessjournal/findJSTXAddTransFeeById?id="+$scope.id).success(function(data){0!=data.length&&($scope.trans=data[0])})},$scope.refreshGrid(),$scope.goBack=function(){$location.path("/view_fee").search({date:$scope.date})},$scope.del=function(){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除此项费用吗?删除后将无法恢复?</h5>',buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){$http.post(basePath+"/third/commresource/deleteJSTXAddHotelFee?id="+$scope.id+"&index=1").success(function(data){if("0"==data.status)$scope.dateBusin?$location.path("/view_fee").search({date:$scope.dateBusin}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})});else{$ionicPopup.alert({title:"删除失败",template:'<h5 class="margin-bottom-0">data.message</h5>',buttons:[{text:"确定",type:"button-theme button-local"}]})}})}}]})},$scope.edit=function(){$location.path("/add_trans").search({id:$scope.id,backDate:$scope.date})},$scope.refreshGrid(),$scope.compareDate=function(startDate,endDate){var day="",arr=startDate.split("-"),starttime=new Date(arr[0],arr[1]-1,arr[2]),starttimes=starttime.getTime(),arrs=endDate.split("-"),lktime=new Date(arrs[0],arrs[1]-1,arrs[2]),lktimes=lktime.getTime();return day=(lktimes-starttimes)/864e5}}angular.module("myApp").controller("viewTransController",viewTransController),viewTransController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function addOtherController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.initData=function(){$scope.otherFeeInfo={money:"",feeReason:"",feeSpendDate:""},$scope.today={},$scope.yesterday={},$scope.anteayer={},$scope.selectedDate="today"},$scope.backDate=$location.search().backDate,$scope.dateBusin=$location.search().backDate,$scope.showTime=$location.search().showTime,$scope.id=$location.search().id,$scope.id&&$http.post(basePath+"/third/businessjournal/findDataById?id="+$scope.id).success(function(data){"0"==data.status&&($scope.otherFeeInfo=data.result)}),$scope.initData(),$scope.changSelectedDate=function(str){$scope.selectedDate=str,$scope.today.showStr="今天",$scope.yesterday.showStr="昨天",$scope.anteayer.showStr="前天","today"==$scope.selectedDate&&($scope.today.showStr="今天("+$scope.today.showDateStr+")"),"yesterday"==$scope.selectedDate&&($scope.yesterday.showStr="昨天("+$scope.yesterday.showDateStr+")"),"anteayer"==$scope.selectedDate&&($scope.anteayer.showStr="前天("+$scope.anteayer.showDateStr+")"),setTimeout(function(){$scope.$apply()})},$scope.getShowDateStr=function(dateStr){var str=dateStr.split("-");return str[1]+"/"+str[2]},$scope.getDate=function(func){$http.get(basePath+"/third/businessjournal/getOtherFeeDateTime?").success(function(data){0==data.status&&($scope.today={dateStr:data.result[0],showDateStr:$scope.getShowDateStr(data.result[0]),showStr:"今天("+$scope.getShowDateStr(data.result[0])+")"},$scope.yesterday={dateStr:data.result[1],showDateStr:$scope.getShowDateStr(data.result[1]),showStr:"昨天"},$scope.anteayer={dateStr:data.result[2],showDateStr:$scope.getShowDateStr(data.result[2]),showStr:"前天"}),$scope.showTime&&($scope.today.dateStr.indexOf($scope.showTime)>-1&&$scope.changSelectedDate("today"),$scope.yesterday.dateStr.indexOf($scope.showTime)>-1&&$scope.changSelectedDate("yesterday"),$scope.anteayer.dateStr.indexOf($scope.showTime)>-1&&$scope.changSelectedDate("anteayer")),func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"})},$scope.doRefresh=function(){$ionicLoading.show({template:"正在刷新..."}),$scope.initData(),$scope.getDate(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})},$scope.doRefresh(),$scope.submitData=function(isBack,func){$http.post(basePath+"/third/businessjournal/saveJSTXOtherFee?",$scope.otherFeeInfo).success(function(data){if(func&&func(),0==data.status)$ionicLoading.show({template:"提交成功"}),setTimeout(function(){$ionicLoading.hide()},500),isBack?setTimeout(function(){$scope.otherFeeInfo.feeSpendDate?$location.path("/view_fee").search({date:$scope.otherFeeInfo.feeSpendDate}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})})},500):($scope.otherFeeInfo.money=0,$scope.otherFeeInfo.feeReason="");else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]})}}).error(function(){func&&func(),$ionicLoading.show({template:"提交失败，请重试！"}),setTimeout(function(){$ionicLoading.hide()},1500)})},$scope.submit=function(isBack){if($scope.otherFeeInfo.money>999999999||!/^\d*\.?\d{0,2}$/.test($scope.otherFeeInfo.money)){$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">金额只能由小于9位的整数或1到2位小数组成!</h5>',buttons:[{text:"确定",type:"button-theme button-local"}]});return!1}$scope.id?$scope.otherFeeInfo.feeSpendDate=$scope.dateBusin:"today"==$scope.selectedDate?$scope.otherFeeInfo.feeSpendDate=$scope.today.dateStr:"yesterday"==$scope.selectedDate?$scope.otherFeeInfo.feeSpendDate=$scope.yesterday.dateStr:"anteayer"==$scope.selectedDate&&($scope.otherFeeInfo.feeSpendDate=$scope.anteayer.dateStr),$ionicLoading.show({template:"正在提交..."}),$scope.submitData(isBack,function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})},$scope.cancel=function(){$scope.otherFeeInfo.feeSpendDate?$location.path("/view_fee").search({date:$scope.otherFeeInfo.feeSpendDate}):$scope.backDate?$location.path("/view_fee").search({date:$scope.backDate}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})})},$scope.showConfirm=function(){$ionicPopup.confirm({title:"返回提示",template:'<h5 class="margin-bottom-0">返回后当前编辑数据将丢失,确定要返回吗?</h5>',buttons:[{text:"继续编辑",type:"button-theme button-local button-outline"},{text:"确定返回",type:"button-theme button-local",onTap:function(e){$scope.cancel()}}]})},$scope.doBack=function(){0!=$scope.otherFeeInfo.money||"today"!=$scope.selectedDate||$scope.otherFeeInfo.feeReason?$scope.showConfirm():$scope.cancel()},$scope.clickDateBusin=function(){$ionicLoading.show({template:"<p>不允许修改日期！</p>"}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("addOtherController",addOtherController),addOtherController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function viewOtherController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.date=$location.search().backDate,$scope.id=$location.search().id,$scope.showEdit=!1,$scope.showDel=!1,$http.get(basePath+"/third/businessjournal/getOtherFeeDateTime?").success(function(data){if(0==data.status){$scope.queryDate=data.result[0];var editDay=parseInt($scope.compareDate($scope.date,$scope.queryDate));parseInt(editDay)<3&&($scope.showEdit=!0);var delDay=parseInt($scope.compareDate($scope.date,$scope.queryDate));parseInt(delDay)<1&&($scope.showDel=!0)}}),$scope.refresh=function(){$http.post(basePath+"/third/businessjournal/findDataById?id="+$scope.id).success(function(data){"0"==data.status&&($scope.other=data.result)})},$scope.goBack=function(){$location.path("/view_fee").search({date:$scope.date})},$scope.del=function(){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除此项费用吗?删除后将无法恢复?</h5>',buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){$http.post(basePath+"/third/commresource/deleteJSTXAddHotelFee?id="+$scope.id+"&index=2").success(function(data){if("0"==data.status)$scope.dateBusin?$location.path("/view_fee").search({date:$scope.dateBusin}):$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&$location.path("/view_fee").search({date:data.result})});else{$ionicPopup.alert({title:"删除失败",template:'<h5 class="margin-bottom-0">data.message</h5>',buttons:[{text:"确定",type:"button-theme button-local"}]})}})}}]})},$scope.edit=function(){$location.path("/add_other").search({id:$scope.id,backDate:$scope.date})},$scope.refresh(),$scope.compareDate=function(startDate,endDate){var day="",arr=startDate.split("-"),starttime=new Date(arr[0],arr[1]-1,arr[2]),starttimes=starttime.getTime(),arrs=endDate.split("-"),lktime=new Date(arrs[0],arrs[1]-1,arrs[2]),lktimes=lktime.getTime();return day=(lktimes-starttimes)/864e5}}angular.module("myApp").controller("viewOtherController",viewOtherController),viewOtherController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function viewFeeController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.time=$location.search().date,$scope.showFeiYong=!0,$http.get(basePath+"/third/businessjournal/getOtherFeeDateTime?").success(function(data){if(0==data.status){$scope.queryDate=data.result[0];var editDay=parseInt($scope.compareDate($scope.time,$scope.queryDate));editDay>=3&&($scope.showFeiYong=!1)}}),$scope.showData=!1,$scope.countMoney=0,$scope.showClickButton=!0;var timeList=[];timeList=$scope.time?$scope.time.split("-"):$scope.queryDate.split("-"),$scope.showTime=timeList[1]+"月"+timeList[2]+"日",$scope.loadData=function(){$http.post(basePath+"/third/businessjournal/findDataByDataIdAndUserId?time="+$scope.time).success(function(data){"0"==data.status&&null!=data.result&&($scope.data=data.result,$scope.showData=!0,$scope.countMoney=$scope.data.countMoney)})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},800)},$scope.clickButton=function(item){var editDay=parseInt($scope.compareDate($scope.time,$scope.queryDate));parseInt(editDay)<3&&(item.showEdit=!0,item.showClickButton=!1);var delDay=parseInt($scope.compareDate($scope.time,$scope.queryDate));parseInt(delDay)<1&&(item.showDel=!0,item.showClickButton=!1),item.showEdit||item.showDel||($scope.notifyMsg("该数据不能修改和删除!"),item.showButton=!0),$scope.test_1=item.showButton},$scope.clickEdit=function(item,type){0==type&&$location.path("/add_hotel").search({id:item.id,backDate:$scope.time}),1==type&&$location.path("/add_trans").search({id:item.id,backDate:$scope.time}),2==type&&$location.path("/add_other").search({id:item.id,backDate:$scope.time})},$scope.deleteFun=function(item,index){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除此项费用吗?删除后将无法恢复!',buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){$http.post(basePath+"/third/commresource/deleteJSTXAddHotelFee?id="+item.id+"&index="+index).success(function(data){if("0"==data.status)window.location.reload();else{$ionicPopup.alert({title:"删除失败",template:'<h5 class="margin-bottom-0">data.message</h5>',buttons:[{text:"确定",type:"button-theme button-local"}]})}})}}]})},$scope.showDetail=function(item,type){0==type&&$location.path("/view_hotel").search({id:item.id,backDate:$scope.time}),1==type&&$location.path("/view_trans").search({id:item.id,backDate:$scope.time}),2==type&&$location.path("/view_other").search({id:item.id,backDate:$scope.time})},$scope.nextDay=function(item){if(1==item){if($scope.queryDate==$scope.time)return $scope.notifyMsg("已经是最新一天!"),!1;$scope.time=$scope.dateChange($scope.time,1);var editDay=parseInt($scope.compareDate($scope.time,$scope.queryDate));editDay>=3?$scope.showFeiYong=!1:$scope.showFeiYong=!0;var timeList=[];timeList=$scope.time.split("-"),$scope.showTime=timeList[1]+"月"+timeList[2]+"日",$http.post(basePath+"/third/businessjournal/findDataByDataIdAndUserId?time="+$scope.time).success(function(data){"0"==data.status&&(null!=data.result?($scope.data=data.result,$scope.showData=!0,$scope.countMoney=$scope.data.countMoney):($scope.showData=!1,$scope.countMoney=0))})}else{$scope.time=$scope.dateChange($scope.time,2);var editDay=parseInt($scope.compareDate($scope.time,$scope.queryDate));editDay>=3?$scope.showFeiYong=!1:$scope.showFeiYong=!0;var timeList=[];timeList=$scope.time.split("-"),$scope.showTime=timeList[1]+"月"+timeList[2]+"日",$http.post(basePath+"/third/businessjournal/findDataByDataIdAndUserId?time="+$scope.time).success(function(data){"0"==data.status&&(null!=data.result?($scope.data=data.result,$scope.showData=!0,$scope.countMoney=$scope.data.countMoney):($scope.showData=!1,$scope.countMoney=0))})}$scope.loadData()},$scope.goTo={isGoTo:!0,gotoFun:function(data,item,type){this.isGoTo&&(1==data?(this.isGoTo=!this.isGoTo,$scope.showDetail(item,type)):2==data?(this.isGoTo=!this.isGoTo,$scope.clickButton(item)):3==data?(this.isGoTo=!this.isGoTo,$scope.clickEdit(item,type)):4==data&&(this.isGoTo=!this.isGoTo,$scope.deleteFun(item,type)),setTimeout(function(){$scope.goTo.isGoTo=!0},100))}},$scope.goBack=function(){$location.path("/business_journal").search({})},$scope.addTrans=function(){$location.path("/add_trans").search({id:null,backDate:$scope.time,date:null,showTime:$scope.showTime.replace("月","-").replace("日","")})},$scope.addHotel=function(){$http.post(basePath+"/third/commresource/findHotelDateAndUserId?date1="+$scope.time).success(function(data){"0"==data.status?$location.path("/add_hotel").search({id:null,backDate:$scope.time,date:null,showTime:$scope.showTime.replace("月","-").replace("日","")}):$scope.showMessage(data.message)})},$scope.addOther=function(){$location.path("/add_other").search({id:null,backDate:$scope.time,date:null,showTime:$scope.showTime.replace("月","-").replace("日","")})},$scope.compareDate=function(startDate,endDate){var day="",arr=startDate.split("-"),starttime=new Date(arr[0],arr[1]-1,arr[2]),starttimes=starttime.getTime(),arrs=endDate.split("-"),lktime=new Date(arrs[0],arrs[1]-1,arrs[2]),lktimes=lktime.getTime();return day=(lktimes-starttimes)/864e5},$scope.loadData(),$scope.dateChange=function(date,type){var translateDate=date.replace("-","/").replace("-","/"),newDate=new Date(translateDate),nextDate="";nextDate=1==type?new Date(newDate.getTime()+864e5):new Date(newDate.getTime()-864e5);var year=nextDate.getFullYear(),month=nextDate.getMonth()+1;parseInt(month)<10&&(month="0"+month);var date=nextDate.getDate();parseInt(date)<10&&(date="0"+date);var time=year+"-"+month+"-"+date;return time},$scope.showMessage=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("viewFeeController",viewFeeController),viewFeeController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("search_hotel_main",{homePage:!0,url:"/search_hotel_main",templateUrl:"views/search_hotel/search_hotel_main.html",controller:"searchHotelMainController"}).state("search_hotel",{url:"/search_hotel",templateUrl:"views/search_hotel/search_hotel.html",controller:"searchHotelController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function searchHotelMainController($ionicPlatform,$scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout,$ionicModal){$scope.searchId=$location.search().searchId,$scope.reLoad=function(){$scope.cityCode="",$scope.address="定位中...",navigator.geolocation.getCurrentPosition(function(position){position.timestamp?$http.jsonp("http://api.map.baidu.com/geocoder/v2/?ak=kdGPrRp7Ufrv5thTKbSCDEnkSiNFkRg8&callback=JSON_CALLBACK&output=json",{params:{location:position.coords.latitude+","+position.coords.longitude}}).success(function(data){$scope.cityCode=data.result.addressComponent.adcode,$scope.address=data.result.addressComponent.province+","+data.result.addressComponent.city+","+data.result.addressComponent.district}):($scope.cityCode="",setTimeout(function(){$scope.address="获取当前位置失败，请重试！",$scope.$digest()},500))})},$ionicPlatform.ready(function(){$scope.reLoad()}),$scope.provinceName="请选择省",$scope.cityName="请选择市",$scope.showCity=!1,$scope.areaName="请选择区",$scope.showArea=!1,$scope.serachHotel=function(item){item&&$location.path("/search_hotel").search({cityCode:item,searchId:item})},$scope.addrHistory=[],$scope.showAddress=!1,$http.get(basePath+"/third/searchhotel/findHistoryAddressByUserId?index=4&ownedBusiness=mobile").success(function(data){0!=data.result.length&&($scope.showAddress=!0,1==data.result.length?$scope.address1=!0:2==data.result.length?($scope.address1=!0,$scope.address2=!0):3==data.result.length?($scope.address1=!0,$scope.address2=!0,$scope.address3=!0):($scope.address1=!0,$scope.address2=!0,$scope.address3=!0,$scope.address4=!0),angular.forEach(data.result,function(newData){null!=newData.platCommonAreaId&&(newData.platCommonCityId=newData.platCommonAreaId,newData.platCommonCityName=newData.platCommonAreaName),$scope.addrHistory.push(newData)}))}),$scope.newName="";var getShowDateFun=function(){return{index:0,showName:[{name:"请选择省"}],setShowName:function(info,size,type){return $scope.newName=info.id,1==type?(this.showName=[],info.parent?(this.showName[0]=info.parent.name,this.showName[this.index]=info.parent,this.showName[this.index+1]=info.name,this.showName[this.index+1]=info,this.showName[this.index+2]={name:"请选择区"}):(this.showName[this.index]=info.name,this.showName[this.index]=info,this.showName[this.index+1]={name:"请选择市"},this.showName[this.index+2]={name:"请选择区"}),void(size>0?1==this.index?this.showName[this.index]={name:"请选择市"}:2==this.index&&(this.showName[this.index]={name:"请选择区"}):$location.path("/search_hotel").search({cityCode:info.code,searchId:info.parent.id}))):(this.showName[this.index]=info.name,this.showName[this.index]=info,this.index++,void(size>0?1==this.index?(this.showName[this.index]={name:"请选择市"},this.showName[this.index]=info):2==this.index&&(this.showName[this.index]={name:"请选择区"},this.showName[this.index]=info):$location.path("/search_hotel").search({cityCode:info.code,searchId:info.parent.id})))}}};$scope.allCity=function(){$scope.showData=getShowDateFun(),$http.post(basePath+"/third/searchhotel/findAreaDataAndParentIdIsNull?").success(function(data){"0"==data.status&&($scope.parentAddress=data.result)})},$scope.allCity(),$scope.showData=getShowDateFun(),$scope.newClass="",$scope.getAddress=function(item,type){$ionicScrollDelegate.resize(),$scope.newClass=item.id,$http.post(basePath+"/third/searchhotel/findAreaDataListByParentId?id="+item.id).success(function(data){"0"==data.status&&($scope.parentAddress=data.result,$http.post(basePath+"/third/searchhotel/findParentAddressById?id="+item.id).success(function(newData){"0"==newData.status&&($ionicScrollDelegate.resize(),$scope.showData.setShowName(newData.result,data.result.length,1))}))})},$scope.searchId&&$http.post(basePath+"/third/searchhotel/findPlatAreaByCityCode?cityCode="+$scope.searchId).success(function(data){"0"==data.status&&($scope.newClass=data.result.id,$scope.showData.showName=data.result.objectList,$scope.testShowName=data.result.name,$http.post(basePath+"/third/searchhotel/findAreaDataListByParentId?id="+data.result.parentId).success(function(data){"0"==data.status&&($scope.parentAddress=data.result)}))})}angular.module("myApp").controller("searchHotelMainController",searchHotelMainController),searchHotelMainController.$inject=["$ionicPlatform","$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout","$ionicModal"]}(),function(){"use strict";function searchHotelController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout,$ionicModal){var template='<ion-modal-view class="bottom-half hotel-detail min-modal-height"> <ion-header-bar class="bar-stable"> <h1 class="title">酒店信息</h1> <button class="button button-clear button-custom" ng-click="closeModal()">取消</button></ion-header-bar> <ion-content delegate-handle="mainScroll"> <div class="text-center"> <h4 ng-bind="hotelDetail.name"></h4><h3 ng-bind="hotelDetail.tel"></h3><a href="tel:{{hotelDetail.tel}}" class="telephone"><button class="button button-theme button-local icon-left ion-ios-telephone-outline">拨打电话</button></a><h6 class="text-gray" ng-click="introduceFun()">酒店介绍</h6><p ng-bind="hotelDetail.hotelDes" ng-if="isShowIntroduce"></p></div></ion-content> </ion-modal-view>';$scope.cityCode=$location.search().cityCode,$scope.searchId=$location.search().searchId,$scope.hotelFun=function(){$scope.travelHotelType="酒店类型",$scope.hotelStar="推荐星级",$scope.agreementStr="是否协议",$scope.indexArr={type:null,star:null,isAgr:null}},$scope.isReturnArea=!1,$scope.defaultFun=function(){$scope.isHomeShow=!0,$scope.isShowDetail=!1,$scope.isShowIntroduce=!1,$scope.hotelDetail={},$scope.addrHistory={},$scope.platCommonAraeName="",$scope.platCommonCityName="",$scope.dufCommonName="请选择酒店所在地区",$scope.conditions={name:"",isAgreement:"",hotelStarCode:"",provinceId:"",cityId:"",areaId:"",hotelTypeCode:"",isPhone:"1"},$scope.hotelTraListCopyDefulat=[],$scope.hotelTraListCopy=[],$scope.isShowSelect=!1,$scope.searchLoding=!1,$scope.isShowState=!0,$scope.area={provinceId:-1,cityId:-1,areaId:-1},$scope.hotelFun()},$scope.defaultFun(),$scope.dictTypeCode={dictCode:"",dictName:"不限",dictTypeKey:"",dictTypeName:"",id:-1,isDel:!1,maintainable:0,managerUserId:null,remark:"",sortFieldMap:null,status:1,statusName:null,userDictCode:"",isShowTravel:!0,isHotelStar:!0},$scope.agreementList=[{dictCode:"-1",dictName:"不限",isAgree:!0},{dictCode:!0,dictName:"协议酒店",isAgree:!1},{dictCode:!1,dictName:"非协议酒店",isAgree:!1}],$http.post(basePath+"/third/searchhotel/findAreaAddressByCityId?cityCode="+$scope.cityCode).success(function(data){"0"==data.status&&($scope.addrHistory=data.result,$scope.area={provinceId:$scope.addrHistory.platCommonParentId,cityId:$scope.addrHistory.platCommonCityId,areaId:$scope.addrHistory.platCommonAreaId},$scope.addrHistory.platCommonAreaName?($scope.dufCommonName=$scope.addrHistory.platCommonAreaName+"("+$scope.addrHistory.platCommonCityName+","+$scope.addrHistory.platCommonParentName+")",$scope.platCommonAraeName=$scope.addrHistory.platCommonAreaName,$scope.platCommonCityName=$scope.addrHistory.platCommonCityName,$scope.isReturnArea=!0):($scope.dufCommonName=$scope.addrHistory.platCommonCityName+"("+$scope.addrHistory.platCommonParentName+")",$scope.platCommonAraeName=$scope.addrHistory.platCommonCityName,$scope.platCommonCityName=$scope.addrHistory.platCommonParentName,$scope.isReturnArea=!1),$scope.conditions.provinceId=$scope.addrHistory.platCommonParentId,$scope.conditions.cityId=$scope.addrHistory.platCommonCityId,$scope.addrHistory.platCommonAreaId&&($scope.conditions.areaId=$scope.addrHistory.platCommonAreaId,$scope.areaIdCopy=angular.copy($scope.conditions.areaId)),$scope.refreshEdit())}),$http.post(basePath+"/third/searchhotel/findHotelTypeCode").success(function(data){$scope.travelHotelTypeList=data,$scope.travelHotelTypeList.push(angular.copy($scope.dictTypeCode))}),$http.post(basePath+"/third/searchhotel/findHotelStarCode").success(function(data){$scope.hotelStarList=data,$scope.hotelStarList.push(angular.copy($scope.dictTypeCode))}),$scope.refreshGrid=function(func){$http.post(basePath+"/third/searchhotel/findHotelByCondition?",$scope.conditions).success(function(data){0!=data.result.content.length?($scope.hotelTraList=data.result.content,$scope.hotelTraListCopyDefulat=angular.copy($scope.hotelTraList)):($scope.hotelTraList=[],$scope.hotelTraListCopyDefulat=[]),func&&func()}).error(function(){func&&func(),$scope.emptyInfo=!0,$scope.dataErrorMsg="加载失败，请重试！"})},$scope.refreshEdit=function(){$ionicLoading.show({template:"正在加载..."}),$scope.refreshGrid(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$ionicScrollDelegate.scrollTop(),$ionicLoading.hide()})},$scope.findHotel=function(){if(angular.equals($scope.dufCommonName,"请选择酒店所在地区")){$ionicPopup.alert({title:"提示",template:"请选择酒店所在地区！",okText:"确定"})}else $scope.isHomeShow=!$scope.isHomeShow},$scope.clickHotel=function(item,index){0==index&&(item.dictCode?($scope.conditions.hotelTypeCode=item.dictCode,$scope.travelHotelType=item.dictName,$scope.indexArr.type=item.dictCode):($scope.conditions.hotelTypeCode="",$scope.travelHotelType="酒店类型",$scope.indexArr.type=null),item.isShowTravel=!item.isShowTravel,angular.forEach($scope.travelHotelTypeList,function(travel){angular.equals(item,travel)||(travel.isShowTravel=!1)})),1==index&&(item.dictCode?($scope.conditions.hotelStarCode=item.dictCode,$scope.hotelStar=item.dictName,$scope.indexArr.star=item.dictCode):($scope.conditions.hotelStarCode="",$scope.hotelStar="推荐星级",$scope.indexArr.star=null),item.isHotelStar=!item.isHotelStar,angular.forEach($scope.hotelStarList,function(hotel){angular.equals(item,hotel)||(hotel.isHotelStar=!1)})),2==index&&("-1"!=item.dictCode?($scope.conditions.isAgreement=item.dictCode,$scope.agreementStr=item.dictName,$scope.indexArr.isAgr=item.dictCode):($scope.conditions.isAgreement="",$scope.agreementStr="是否协议",$scope.indexArr.isAgr=null),item.isAgree=!item.isAgree,angular.forEach($scope.agreementList,function(agree){angular.equals(item,agree)||(agree.isAgree=!1)})),$scope.hotelTraSelectFun($scope.indexArr)},$scope.ueset=function(){$scope.hotelFun(),$scope.conditions.hotelTypeCode="",$scope.conditions.hotelStarCode="",$scope.conditions.isAgreement="",angular.forEach($scope.travelHotelTypeList,function(travel){angular.equals("不限",travel.dictName)?travel.isShowTravel=!1:travel.isShowTravel=!1}),angular.forEach($scope.hotelStarList,function(hotel){angular.equals("不限",hotel.dictName)?hotel.isHotelStar=!1:hotel.isHotelStar=!1}),angular.forEach($scope.agreementList,function(agree){angular.equals("不限",agree.dictName)?agree.isAgree=!1:agree.isAgree=!1}),$scope.hotelTraList=[],$scope.hotelTraList=$scope.hotelTraListCopyDefulat},$scope.selectArea=function(){$location.path("/search_hotel_main").search({searchId:$scope.cityCode})},$scope.areaSelect=function(item){$scope.conditions.provinceId=item[0].id,$scope.conditions.cityId=item[1].id,item.length>2?($scope.dufCommonName=item[2].name+"("+item[1].name+","+item[0].name+")",$scope.platCommonAraeName=item[2].name,$scope.platCommonCityName=item[1].name,$scope.conditions.areaId=item[2].id,$scope.areaIdCopy=angular.copy($scope.conditions.areaId),$scope.isReturnArea=!0,$scope.conditions.areaId&&$scope.refreshEdit()):($scope.dufCommonName=item[1].name+"("+item[0].name+")",$scope.platCommonAraeName=item[1].name,$scope.platCommonCityName=item[0].name,$scope.conditions.areaId="",$scope.isReturnArea=!1,item[1].id&&$scope.refreshEdit())},$scope.hotelTraSelectFun=function(indexArr){$scope.hotelTraListCopy=angular.copy($scope.hotelTraListCopyDefulat),$scope.hotelTraList=[],angular.forEach($scope.hotelTraListCopy,function(hotelTra){(null!=indexArr.type?indexArr.type!=hotelTra.hotelTypeCode:0)||(null!=indexArr.star?indexArr.star!=hotelTra.hotelStarCode:0)||(null!=indexArr.isAgr?indexArr.isAgr!=hotelTra.isAgreement:0)||$scope.hotelTraList.push(hotelTra)})},$scope.introduceFun=function(){$scope.isShowIntroduce=!$scope.isShowIntroduce},$scope.clickInputSearch=function(index){0==index?($scope.getClass(1),$scope.isShowSelect=!0):($scope.getClass(3),$scope.conditions.name="",$scope.searchLoding=!1,$scope.isShowSelect=!$scope.isShowSelect,$scope.isReturnArea&&($scope.conditions.areaId=$scope.areaIdCopy),$scope.isShowState=!0,$scope.refreshEdit())},$scope.returnClass="fixed-header search-hotel ",$scope.getClass=function(item){1==item?$scope.returnClass="fixed-header search-hotel search-only ":2==item?$scope.returnClass="fixed-header search-hotel search-only more-tips":3==item&&($scope.returnClass="fixed-header search-hotel ")},$scope.cancleSearch=function(){$scope.conditions.name=""},$scope.search=function(){$scope.getClass(2),$scope.isShowSelect&&($scope.searchLoding=!0,$scope.refreshEdit())},$scope.clickStateSearch=function(index){$scope.isShowState=!$scope.isShowState,0==index?$scope.conditions.areaId="":$scope.conditions.areaId=$scope.areaIdCopy,$scope.refreshEdit()},$scope.refreshSearchFun=function(){$scope.defaultFun()},$scope.modal=$ionicModal.fromTemplate(template,{scope:$scope,animation:"slide-in-up"}),$scope.openModal=function(item){$scope.modal.show(),$scope.isShowIntroduce=!1,$scope.hotelDetail=item},$scope.closeModal=function(){$scope.modal.hide()},$scope.$on("$destroy",function(){$scope.modal.remove()}),$scope.goBack=function(){$location.path("/search_hotel_main").search({})}}angular.module("myApp").controller("searchHotelController",searchHotelController),searchHotelController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout","$ionicModal"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("job_record",{homePage:!0,url:"/job_record",templateUrl:"views/job_record/job_record.html",controller:"jobRecordController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function jobRecordController($scope,$ionicPopup,$http,$timeout,$ionicLoading,$ionicModal,$filter){function clickRow(rowData){$scope.delectedTask=[],$scope.currentRowData=angular.copy(rowData),$scope.currentRowData.formatShowDate=$scope.currentRowData.showDate.split("-")[1]+"月"+$scope.currentRowData.showDate.split("-")[2]+"日",0===rowData.teskQuantity&&rowData.showDay>1?$ionicPopup.show({title:"提示",template:"<h5>只允许昨天、今天、明天添加工作任务</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]}):rowData.showDay<=1&&rowData.teskQuantity>0?$scope.showViewTask(rowData):rowData.showDay<=1&&rowData.teskQuantity<=0?$scope.showAddTask(rowData):$scope.showViewTask(rowData)}function getDayStr(type){return"-1"===type?"[明天]":"0"===type?"[今天]":"1"===type?"[昨天]":""}function getMonthAndDay(date){if(date){var ol=date.split("-");if(ol.length>2)return ol[1]+"-"+ol[2]}return date}function getTaskCountStr(taskCount){return taskCount>0?"共"+taskCount+"项任务":"未计划"}function getAllTask(params){return $http.get(basePath+"/third/jobrecord/findJSTXJobRecordDTOByConditions",{params:params}).then(function(response){
return params.showDate?$scope.pageData.allDateList=$scope.pageData.allDateList.concat(response.data):$scope.pageData.allDateList=response.data,response})}function findTaskDetail(params){return $http.get(basePath+"/third/jobrecord/findJSTXJObRecordDetailDTOByShowDateAndAll",{params:params}).then(function(response){return response})}function findRule(){return $http.get(basePath+"/third/jobrecord/findWorkLogSet").then(function(response){return $scope.pageData.rule=response.data.result,response})}function saveData(params,postParams){return $http.post(basePath+"/third/jobrecord/saveOrUpdateJSTXJObRecordDetail",postParams,{params:params}).then(function(response){return response})}function getTask(params){return $http.get(basePath+"/third/jobrecord/findJSTXJObRecordDetailDTOByShowDateAndGet",{params:params}).then(function(response){return response})}function loadMore(){return $scope.isLoadData=!0,$scope.showMore?null:void $scope.getAllTask({showDate:$scope.conditions.lastDate}).then(function(){$scope.isLoadData=!1,$scope.pageData.allDateList&&0!==$scope.pageData.allDateList.length||($scope.showMore=!0),7*$scope.pageData.allDateList.length>=100&&($scope.showMore=!0),$scope.conditions.lastDate=$scope.pageData.allDateList.getAttr().getAttr("showDate"),$timeout(function(){$scope.$broadcast("scroll.infiniteScrollComplete")},1e3)})}function showAddTask(rowData){$scope.pageData.showTip=!0,$scope.pageData.beforeTask=[],$scope.pageData.afterTask=[],$scope.add_task.show().then(function(){$scope.findTaskDetail({showDate:rowData.showDate}).then(function(response){var planTime=new Date($scope.currentRowData.showDate.replace(/-/g,"/")+" "+$scope.pageData.rule.planTime),currentTime=new Date;planTime>currentTime?($scope.pageData.beforeTask=[],$scope.pageData.beforeTask=$scope.pageData.beforeTask.concat(response.data).goAir().goHeavy().suppFun()):($scope.pageData.afterTask=[],$scope.pageData.afterTask=$scope.pageData.afterTask.concat(response.data).goAir().goHeavy().suppFun())})})}function closeAddTask(){$ionicPopup.show({title:"提示",template:"<h5>确定要放弃当前填写的计划吗？</h5>",buttons:[{text:"继续编辑",type:"button-outline button-theme button-local"},{text:"确定返回",type:"button-theme button-local",onTap:function(){$scope.add_task.hide()}}]})}function getTaskByProject(){$ionicLoading.show({template:"<h4>正在获取...</h4>",scope:$scope}),$scope.getTask({showDate:$scope.currentRowData.showDate,isObtain:!0}).then(function(response){$ionicLoading.hide();var i,j,tasks=[];for(i=0;i<response.data.length;i++)if(!response.data[i].isAdd){var index=null;for(j=0;j<$scope.delectedTask.length;j++)if(response.data[i].taskType===$scope.delectedTask[j].taskType&&response.data[i].taskName===$scope.delectedTask[j].taskName){index=j;break}null!==index&&$scope.delectedTask.splice(index,1),tasks.push(response.data[i])}var beforeCount=0,afterCount=0;$scope.pageData.beforeTask.length>0?(beforeCount=$scope.pageData.beforeTask.goAir().length,$scope.pageData.beforeTask=$scope.pageData.beforeTask.concat(tasks),$scope.pageData.beforeTask=$scope.pageData.beforeTask.goAir().goHeavy().suppFun(),afterCount=$scope.pageData.beforeTask.goAir().length):(beforeCount=$scope.pageData.afterTask.goAir().length,$scope.pageData.afterTask=$scope.pageData.afterTask.concat(tasks),$scope.pageData.afterTask=$scope.pageData.afterTask.goAir().goHeavy().suppFun(),afterCount=$scope.pageData.afterTask.goAir().length),$ionicPopup.show({title:"提示",template:afterCount-beforeCount===0?"<h5>没有获取到任务</h5>":"<h5>成功获取"+(afterCount-beforeCount)+"条任务</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]})})}function deleteTask(){$ionicPopup.confirm({title:"提示",template:"<h5>删除工作计划将删除里面所有的任务，确定要删除吗？</h5>",buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定",type:"button-theme button-local",onTap:function(){$http.get(basePath+"/third/jobrecord/deleteWorkingLogByShowDate",{params:{showDate:$scope.currentRowData.showDate}}).then(function(){$ionicLoading.show({template:"<h4>删除成功</h4>",scope:$scope,duration:1e3}).then(function(){$scope.getAllTask({showData:""}).then(function(){$scope.conditions.lastDate=$scope.pageData.allDateList.getAttr().getAttr("showDate"),$scope.view_task_modal.hide()})})})}}]})}function deleteTaskDetail(attribute,index){var msg;msg=$scope.pageData.canModify?$scope.pageData.beforeTask.length+$scope.pageData.afterTask.length===1?"<h5>删除最后一条任务后，整个"+$scope.currentRowData.formatShowDate+"的计划都将被删除</h5>":"<h5>删除后，任务无法恢复</h5>":"<h5>删除后，当前添加的任务无法恢复</h5>",$ionicPopup.show({title:"提示",template:msg,buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:"button-theme button-local",onTap:function(){if($scope.pageData.canModify&&$http.get(basePath+"/third/jobrecord/deleteDetailsById",{params:{id:$scope.pageData[attribute][index].id}}).then(function(){$ionicLoading.show({template:"<h4>删除成功</h4>",duration:1e3}).then(function(){$scope.getAllTask({showData:""}).then(function(){$scope.conditions.lastDate=$scope.pageData.allDateList.getAttr().getAttr("showDate")}),$scope.pageData.beforeTask.length+$scope.pageData.afterTask.length===0&&$scope.view_task_modal.hide()})}),!$scope.pageData[attribute][index].modify){$scope.pageData[attribute][index].del=!0;for(var flag=!1,i=0;i<$scope.delectedTask.length;i++)if($scope.delectedTask[i].taskName===$scope.pageData[attribute][index].taskName&&$scope.delectedTask[i].taskType===$scope.pageData[attribute][index].taskType){flag=!0;break}flag||$scope.delectedTask.push($scope.pageData[attribute][index])}$scope.pageData[attribute].splice(index,1)}}]})}function showAddTaskDetail(rowData,attribute,index){if($scope.pageData.selectedTaskDetail=angular.copy(rowData),isNaN(parseFloat($scope.pageData.selectedTaskDetail.consumptionTime))&&($scope.pageData.selectedTaskDetail.consumptionTime=0),rowData.isAdd){$scope.pageData.selectedTaskDetail.taskName=null;for(var i=0;i<$scope.pageData[attribute].length;i++)if($scope.pageData[attribute][i].isAdd){index=i;break}}$scope.pageData.selectedAllTaskIndex=index,"afterTask"===attribute&&($scope.pageData.selectedAllTaskIndex+=$scope.pageData.beforeTask.length),$scope.pageData.selectedTaskIndex=index,$scope.pageData.selectedAttribute=attribute,null===$scope.pageData.selectedTaskDetail.remindTime&&($scope.pageData.selectedTaskDetail.remindTime="00:00"),$scope.add_task_modal.show()}function closeAddTaskDetail(){$scope.pageData.selectedTaskDetail.taskName?$ionicPopup.show({title:"提示",template:"<h5>取消后编辑的内容将丢失，确定取消吗？</h5>",buttons:[{text:"继续编辑",type:"button-outline button-theme button-local"},{text:"确定返回",type:"button-theme button-local",onTap:function(){$scope.add_task_modal.hide().then(function(){$scope.add_task_modal.remove().then(function(){$ionicModal.fromTemplateUrl("add-task-modal.html",{scope:$scope,animation:"slide-in-right",backdropClickToClose:!1}).then(function(modal){$scope.add_task_modal=modal})})}),$scope.pageData.selectedTaskDetail=null}}]}):($scope.add_task_modal.hide().then(function(){$scope.add_task_modal.remove().then(function(){$ionicModal.fromTemplateUrl("add-task-modal.html",{scope:$scope,animation:"slide-in-right",backdropClickToClose:!1}).then(function(modal){$scope.add_task_modal=modal})})}),$scope.pageData.selectedTaskDetail=null)}function addOneTaskDetail(){if($scope.pageData.beforeTask.length+$scope.pageData.afterTask.length>=10)return $ionicPopup.show({title:"提示",template:"<h5>最多只能添加10项任务</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]}),!1;var planTime=new Date($scope.currentRowData.showDate.replace(/-/g,"/")+" "+$scope.pageData.rule.planTime),currentTime=new Date;planTime>currentTime?$scope.pageData.beforeTask.push({taskName:"",isAdd:!0,taskType:1,remind:!1,modify:!0}):$scope.pageData.afterTask.push({taskName:"",isAdd:!0,taskType:1,remind:!1,modify:!0})}function addConsumptionTime(step,obj,type){type?angular.isNumber(obj.actualConsumptionTime)?(obj.actualConsumptionTime+=step,obj.actualConsumptionTime<0&&(obj.actualConsumptionTime=0)):obj.actualConsumptionTime=0:obj?(angular.isNumber(obj.consumptionTime)||(obj.consumptionTime=0),obj.consumptionTime+=step,obj.consumptionTime<0&&(obj.consumptionTime=0)):(angular.isNumber($scope.pageData.selectedTaskDetail.consumptionTime)||($scope.pageData.selectedTaskDetail.consumptionTime=0),$scope.pageData.selectedTaskDetail.consumptionTime+=step,$scope.pageData.selectedTaskDetail.consumptionTime<0&&($scope.pageData.selectedTaskDetail.consumptionTime=0))}function confirmDetail(){if($scope.pageData.selectedTaskDetail.taskName){var regex=new RegExp(/^(\d+\.\d|\d+)$/);if($scope.pageData.selectedTaskDetail.consumptionTime){if(!regex.test($scope.pageData.selectedTaskDetail.consumptionTime))return $ionicPopup.show({title:"提示",template:"<h5>工时格式不正确</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]}),!1;$scope.pageData.selectedTaskDetail.consumptionTime=parseFloat($scope.pageData.selectedTaskDetail.consumptionTime)+""}if($scope.pageData.selectedTaskDetail.actualConsumptionTime){if(!regex.test($scope.pageData.selectedTaskDetail.actualConsumptionTime))return $ionicPopup.show({title:"提示",template:"<h5>工时格式不正确</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]}),!1;$scope.pageData.selectedTaskDetail.actualConsumptionTime=parseFloat($scope.pageData.selectedTaskDetail.actualConsumptionTime)+""}if(void 0===$scope.pageData.selectedTaskDetail.completeState&&($scope.pageData.selectedTaskDetail.completeState=1),$scope.pageData.selectedTaskDetail.remind&&void 0===$scope.pageData.selectedTaskDetail.remindTime&&($scope.pageData.selectedTaskDetail.remindTime="00:00"),$scope.pageData.selectedTaskDetail.isAdd=!1,$scope.pageData[$scope.pageData.selectedAttribute][$scope.pageData.selectedTaskIndex]=$scope.pageData.selectedTaskDetail,$scope.currentRowData.teskQuantity>0){var type=angular.isUndefined($scope.pageData.selectedTaskDetail.id)?"add":"modify",arr=buildSaveTask();$scope.saveData({showDate:$scope.currentRowData.showDate},arr).then(function(){$ionicLoading.show({template:"add"===type?"<h4>添加成功</h4>":"<h4>修改成功</h4>",scope:$scope,duration:1e3}).then(function(){$scope.getAllTask({showData:""}).then(function(){$scope.conditions.lastDate=$scope.pageData.allDateList.getAttr().getAttr("showDate"),saveTaskAfter()})})})}$scope.add_task_modal.hide().then(function(){$scope.add_task_modal.remove().then(function(){$ionicModal.fromTemplateUrl("add-task-modal.html",{scope:$scope,animation:"slide-in-right",backdropClickToClose:!1}).then(function(modal){$scope.add_task_modal=modal})})})}else $ionicPopup.show({title:"提示",template:"<h5>请输入任务名称</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]})}function buildSaveTask(){var i,arr=[];for(i=0;i<$scope.pageData.beforeTask.length;i++)$scope.pageData.beforeTask[i].taskName&&!$scope.pageData.beforeTask[i].isAdd&&($scope.pageData.beforeTask[i].planning=1,arr.push($scope.pageData.beforeTask[i]));for(i=0;i<$scope.pageData.afterTask.length;i++)$scope.pageData.afterTask[i].taskName&&!$scope.pageData.afterTask[i].isAdd&&($scope.pageData.afterTask[i].planning=2,arr.push($scope.pageData.afterTask[i]));return arr.concat($scope.delectedTask)}function checkDataAndSave(type){var arr=buildSaveTask();$scope.saveData({showDate:$scope.currentRowData.showDate},arr).then(function(response){"1"===response.data.status&&$ionicLoading.show({template:"add"===type?"<h4>添加成功</h4>":"<h4>修改成功</h4>",scope:$scope,duration:1e3}).then(function(){$scope.getAllTask({showData:""}).then(function(){$scope.conditions.lastDate=$scope.pageData.allDateList.getAttr().getAttr("showDate"),"add"===type?$scope.add_task.hide():saveTaskAfter()})})})}function saveTaskAfter(){$scope.add_task_modal.hide().then(function(){$scope.add_task_modal.remove().then(function(){$ionicModal.fromTemplateUrl("add-task-modal.html",{scope:$scope,animation:"slide-in-right",backdropClickToClose:!1}).then(function(modal){$scope.add_task_modal=modal})})}),$scope.findTask({showDate:$scope.currentRowData.showDate}).then(function(response){if(response.data.length>0){$scope.currentRowData.summaryExplain=response.data[0].summaryExplain;for(var count=0,cancel=0,beforeTask=[],afterTask=[],i=0;i<response.data.length;i++)response.data[i].del?$scope.delectedTask.push(response.data[i]):(2===response.data[i].completeState&&(count+=1),3===response.data[i].completeState&&(cancel+=1),1===response.data[i].planning?beforeTask.push(response.data[i]):afterTask.push(response.data[i]));$scope.pageData.beforeTask=beforeTask,$scope.pageData.afterTask=afterTask;var length=beforeTask.length+afterTask.length;$scope.pageData.taskCountMsg="共"+length+"项任务、已完成"+count+"项、未完成"+(length-count-cancel)+"项、任务取消"+cancel+"项"}})}function submitPlan(){var i,count=0;for(i=0;i<$scope.pageData.beforeTask.length;i++)$scope.pageData.beforeTask[i].taskName&&(count+=1);for(i=0;i<$scope.pageData.afterTask.length;i++)$scope.pageData.afterTask[i].taskName&&(count+=1);0===count?$ionicPopup.show({title:"提示",template:"<h5>请至少填写一项工作任务</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]}):"1"===$scope.currentRowData.showDay?$ionicPopup.show({title:"提示",template:"<h5>您添加的是昨天的计划，提交后将无法修改</h5>",buttons:[{text:"继续编辑",type:"button-theme button-local button-outline"},{text:"确定提交",type:"button-theme button-local",onTap:function(){checkDataAndSave("add")}}]}):checkDataAndSave("add")}function findTask(params){return $http.get(basePath+"/third/jobrecord/findJSTXJObRecordDetailDTOByShowDate",{params:params}).then(function(response){return response})}function showViewTask(rowData){$scope.pageData.showTip=!0,$scope.pageData.beforeTask=[],$scope.pageData.afterTask=[],$scope.pageData.viewTips="",$scope.pageData.taskCountMsg="",$scope.view_task_modal.show().then(function(){$scope.currentRowData=angular.copy(rowData),$scope.currentRowData.formatShowDate=$scope.currentRowData.showDate.split("-")[1]+"月"+$scope.currentRowData.showDate.split("-")[2]+"日";var now=new Date,lastModifyTime=new Date($scope.currentRowData.showDate.replace(/-/g,"/")+" "+$scope.pageData.rule.planTimeEnd+" +0800");$scope.pageData.canModify=lastModifyTime>now;var lastSummaryTime=new Date(new Date($scope.currentRowData.showDate.replace(/-/g,"/")+" "+$scope.pageData.rule.sumaryTimeEnd+" +0800").setSeconds(86400));$scope.pageData.canSummary=lastSummaryTime>now,$scope.pageData.canModify&&$scope.pageData.canSummary?$scope.pageData.viewTips="请在"+$filter("date")(lastSummaryTime,"MM月dd号HH:mm")+"前完成总结，如需修改任务请在"+$scope.currentRowData.formatShowDate+$scope.pageData.rule.planTimeEnd+"前操作":!$scope.pageData.canModify&&$scope.pageData.canSummary?$scope.pageData.viewTips="已超时不能修改任务，请在"+$filter("date")(lastSummaryTime,"MM月dd号HH:mm")+"前完成总结":$scope.pageData.viewTips="超时不允许修改任务和总结计划",$scope.findTask({showDate:$scope.currentRowData.showDate}).then(function(response){if(response.data.length>0){$scope.currentRowData.summaryExplain=response.data[0].summaryExplain;for(var count=0,cancel=0,i=0;i<response.data.length;i++)response.data[i].del?$scope.delectedTask.push(response.data[i]):(2===response.data[i].completeState&&(count+=1),3===response.data[i].completeState&&(cancel+=1),1===response.data[i].planning?$scope.pageData.beforeTask.push(response.data[i]):$scope.pageData.afterTask.push(response.data[i]));var length=$scope.pageData.beforeTask.length+$scope.pageData.afterTask.length;$scope.pageData.taskCountMsg="共"+length+"项任务、已完成"+count+"项、未完成"+(length-count-cancel)+"项、任务取消"+cancel+"项"}})})}function closeViewTask(){$scope.view_task_modal.hide()}function modifyPageAddTask(){$scope.pageData.selectedTaskDetail={taskName:"",isAdd:!0,taskType:1,remind:!1,modify:!0};var planTime=new Date($scope.currentRowData.showDate+" "+$scope.pageData.rule.planTime),currentTime=new Date;currentTime>planTime?($scope.pageData.selectedAttribute="afterTask",$scope.pageData.selectedTaskDetail.planning=2):($scope.pageData.selectedAttribute="beforeTask",$scope.pageData.selectedTaskDetail.planning=1),$scope.pageData.selectedAllTaskIndex=$scope.pageData.beforeTask.length+$scope.pageData.afterTask.length,$scope.pageData.selectedTaskIndex=$scope.pageData[$scope.pageData.selectedAttribute].length,$scope.pageData.selectedTaskDetail.taskType=1,$scope.add_task_modal.show()}function showConclusionTask(){$scope.pageData.showTip=!0;var now=new Date,lastSummaryTime=new Date(new Date($scope.currentRowData.showDate.replace(/-/g,"/")+" "+$scope.pageData.rule.sumaryTimeEnd+" +0800").setSeconds(86400)),firstSummaryTime=new Date(new Date($scope.currentRowData.showDate.replace(/-/g,"/")+" "+$scope.pageData.rule.sumaryTime+" +0800").setSeconds(86400));$scope.pageData.summaryState=now>firstSummaryTime?3:2,$scope.pageData.conclusionTips="请在"+$filter("date")(lastSummaryTime,"MM月dd号HH:mm")+"前完成总结",$scope.conclusion_task_modal.show()}function closeConclusionTask(){$ionicPopup.show({title:"提示",template:"<h5>返回后，此次编辑的总结内容将丢失</h5>",buttons:[{text:"继续编辑",type:"button-theme button-local button-outline"},{text:"确定返回",type:"button-theme button-local",onTap:function(){$scope.currentRowData.summaryExplain="",$scope.conclusion_task_modal.hide().then(function(){$scope.conclusion_task_modal.remove().then(function(){$ionicModal.fromTemplateUrl("task-conclusion.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.conclusion_task_modal=modal}).then(function(){$scope.getAllTask({showDate:null}).then(function(){for(var i=0;i<$scope.pageData.allDateList.length;i++)for(var j=0;j<$scope.pageData.allDateList[i].length;j++)if($scope.pageData.allDateList[i][j].showDate===$scope.currentRowData.showDate){$scope.currentRowData=angular.copy($scope.pageData.allDateList[i][j]);break}$scope.showViewTask($scope.currentRowData)})})})})}}]})}function submitConclusion(){var i,msg,arr=[],complete=0,error=0,cancel=0,regex=new RegExp(/^(\d+\.\d|\d+)$/);for(i=0;i<$scope.pageData.beforeTask.length;i++)if($scope.pageData.beforeTask[i].taskName){if($scope.pageData.beforeTask[i].consumptionTime&&!regex.test($scope.pageData.beforeTask[i].consumptionTime)){error+=1;break}if($scope.pageData.beforeTask[i].actualConsumptionTime&&!regex.test($scope.pageData.beforeTask[i].actualConsumptionTime)){error+=1;break}$scope.pageData.beforeTask[i].planning=1,arr.push($scope.pageData.beforeTask[i]),2===$scope.pageData.beforeTask[i].completeState?complete+=1:3===$scope.pageData.beforeTask[i].completeState&&(cancel+=1)}for(i=0;i<$scope.pageData.afterTask.length;i++)if($scope.pageData.afterTask[i].taskName){if($scope.pageData.afterTask[i].consumptionTime&&!regex.test($scope.pageData.afterTask[i].consumptionTime)){error+=1;break}if($scope.pageData.afterTask[i].actualConsumptionTime&&!regex.test($scope.pageData.afterTask[i].actualConsumptionTime)){error+=1;break}$scope.pageData.afterTask[i].planning=2,arr.push($scope.pageData.afterTask[i]),2===$scope.pageData.afterTask[i].completeState?complete+=1:3===$scope.pageData.afterTask[i].completeState&&(cancel+=1)}return error?($ionicPopup.show({title:"提示",template:"<h5>工时格式不正确</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]}),!1):(msg="共"+arr.length+"项任务，已完成"+complete+"项，未完成"+(arr.length-complete-cancel)+"项，任务取消"+cancel+"项",arr=arr.concat($scope.delectedTask),void $ionicPopup.show({title:"提示",template:"<h5>"+msg+"</h5>",buttons:[{text:"继续编辑",type:"button-theme button-local button-outline"},{text:"确定提交",type:"button-theme button-local",onTap:function(){$scope.saveData({showDate:$scope.currentRowData.showDate,summaryExplain:$scope.currentRowData.summaryExplain,summaryState:$scope.pageData.summaryState},arr).then(function(){$ionicLoading.show({template:"<h4>提交成功</h4>",scope:$scope,duration:1e3}).then(function(){$scope.conclusion_task_modal.hide().then(function(){$scope.conclusion_task_modal.remove().then(function(){$ionicModal.fromTemplateUrl("task-conclusion.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.conclusion_task_modal=modal}).then(function(){$scope.getAllTask({showDate:null}).then(function(){for(var i=0;i<$scope.pageData.allDateList.length;i++)for(var j=0;j<$scope.pageData.allDateList[i].length;j++)if($scope.pageData.allDateList[i][j].showDate===$scope.currentRowData.showDate){$scope.currentRowData=angular.copy($scope.pageData.allDateList[i][j]);break}$scope.showViewTask($scope.currentRowData)})})})})})})}}]}))}function showRemindTime(detail){var msg=$scope.currentRowData.formatShowDate+detail.remindTime+"提醒我";$ionicLoading.show({template:"<h5>"+msg+"</h5>",scope:$scope}).then(function(){$timeout(function(){$ionicLoading.hide()},2e3)})}function formatNumber(obj){var newChar=obj.consumptionTime.substr(obj.consumptionTime.length-1),regex=new RegExp(/[^0-9|.]/);regex.test(newChar)&&(obj.consumptionTime=obj.consumptionTime.substr(0,obj.consumptionTime.indexOf(newChar)))}function checkId(info){return info.isAdd?!1:info.id?!0:info.xtgbAssId?!0:info.xtbgProjectId?!0:!1}$scope.$on("$destroy",function(){}),$scope.pageData={rule:null,allDateList:[],beforeTask:[],afterTask:[],selectedTaskDetail:null,selectedTaskIndex:null,selectedAttribute:null,selectedIsModify:!1},$scope.conditions={lastDate:""},$scope.clickRow=clickRow,$scope.getDayStr=getDayStr,$scope.getMonthAndDay=getMonthAndDay,$scope.getTaskCountStr=getTaskCountStr,$scope.getAllTask=getAllTask,$scope.loadMore=loadMore,$scope.findTaskDetail=findTaskDetail,$scope.findRule=findRule,$scope.saveData=saveData,$scope.getTask=getTask,$scope.showAddTask=showAddTask,$scope.closeAddTask=closeAddTask,$scope.deleteTask=deleteTask,$scope.deleteTaskDetail=deleteTaskDetail,$scope.showAddTaskDetail=showAddTaskDetail,$scope.closeAddTaskDetail=closeAddTaskDetail,$scope.addOneTaskDetail=addOneTaskDetail,$scope.addConsumptionTime=addConsumptionTime,$scope.confirmDetail=confirmDetail,$scope.submitPlan=submitPlan,$scope.findTask=findTask,$scope.showViewTask=showViewTask,$scope.closeViewTask=closeViewTask,$scope.modifyPageAddTask=modifyPageAddTask,$scope.showConclusionTask=showConclusionTask,$scope.closeConclusionTask=closeConclusionTask,$scope.submitConclusion=submitConclusion,$scope.formatNumber=formatNumber,$scope.findRule(),$ionicModal.fromTemplateUrl("add-task.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.add_task=modal}),$ionicModal.fromTemplateUrl("add-task-modal.html",{scope:$scope,animation:"slide-in-right",backdropClickToClose:!1}).then(function(modal){$scope.add_task_modal=modal}),$ionicModal.fromTemplateUrl("task-view.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.view_task_modal=modal}),$ionicModal.fromTemplateUrl("task-conclusion.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.conclusion_task_modal=modal}),$scope.getTaskByProject=getTaskByProject,$scope.showRemindTime=showRemindTime,Array.prototype.getAttr=function(code){return this&&this.length>0?code?this[this.length-1][code]:this[this.length-1]:{}},Array.prototype.suppFun=function(){if(this.length<6)for(var i=this.length;6>i;i++)this.push({taskName:"添加第"+i+"项新任务",isAdd:!0,taskType:1,remind:!1,modify:!0});return this},Array.prototype.goAir=function(){for(var res=[],i=0;i<this.length;i++){var obj=this[i];checkId(obj)&&res.push(this[i])}return res},Array.prototype.goHeavy=function(){for(var res=[],json={},i=0;i<this.length;i++){var obj=this[i];if(obj.taskType&&1===obj.taskType)obj.id?json[obj.id]||(res.push(obj),json[obj.id]=!0):res.push(obj);else{var xtId=obj.xtgbAssId||obj.xtbgProjectId;xtId?json[xtId+i]||(json[xtId+i]=!0,res.push(obj)):res.push(obj)}}return res}}angular.module("myApp").controller("jobRecordController",jobRecordController),jobRecordController.$inject=["$scope","$ionicPopup","$http","$timeout","$ionicLoading","$ionicModal","$filter"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("leave_apply",{homePage:!0,url:"/leave_apply",templateUrl:"views/leave_apply/leave_apply.html",controller:"leaveApplyController"}).state("add_apply",{url:"/add_apply",templateUrl:"views/leave_apply/add_leave.html",controller:"addApplyController"}).state("leave_apply_view",{url:"/leave_apply_view",templateUrl:"views/leave_apply/leave_apply_view.html",controller:"leaveApplyViewController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function addApplyController($scope,$http,$filter,$ionicLoading,$location,$ionicPopup,$timeout,$rootScope){$scope.update={},$scope.nodeData={},$scope.update.startDate=$filter("date")(new Date,"yyyy-MM-dd HH:mm"),$http.post(basePath+"/third/leaveapply/getLeaveTypeIsEnabled").success(function(data){0==data.status&&($scope.leaveList=data.result)}),$scope.id=$location.search().id,$scope.processScheduleStates=$location.search().processScheduleStates,$scope.actExecutionProcinstId=$location.search().actExecutionProcinstId,$scope.applyId=$location.search().applyId,$scope.actExecutionProcinstId&&$http.post(basePath+"/third/businessjournal/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.actExecutionProcinstId).success(function(data){0==data.status&&($scope.update.currentTaskId=data.result)}),$scope.checkNuber=function(day,info){return!isNaN(day)&&day?(info.days="",getMessageFun("错误","请填写正确的请假天数")):void 0};var isNaN=function(info){var re=/^[0-9]+.?[0-9]{0,1}$/;return re.test(info)},getMessageFun=function(title,message){$ionicPopup.show({title:title,template:"<h5> "+message+"</h5>",buttons:[{text:"确认",type:"button-local button-positive"}]})};$scope.diySelect=function(item){$scope.leaveTypeName=item.name,$scope.update.typeId=item.id},$scope.initActive=function(){$scope.flowKey={actKey:"YNLeave",Id:""},$http.post(basePath+"/third/leaveapply/getXTBGActivityByActKeyForProcessDefinition?actKey="+$scope.flowKey.actKey).success(function(data){0==data.status&&($scope.update.processDefinitionId=data.result.id)})};var AddDays=function(date,days){var nd=new Date(date);nd=nd.valueOf(),nd+=24*days*60*60*1e3,nd=new Date(nd);var y=nd.getFullYear(),m=nd.getMonth()+1,d=nd.getDate();9>=m&&(m="0"+m),9>=d&&(d="0"+d);var cdate=y+"-"+m+"-"+d;return cdate};$scope.addOndeDay=function(){var startDate=$scope.update.startDate,str=AddDays(startDate.replace("-","/").replace("-","/"),1);str=str+" "+$scope.update.startDate.split(" ")[1],$scope.update.endDate=str},$scope.cancelTips=function(){$ionicPopup.show({title:"取消提示",template:"<h5> 确定要取消当前编辑内容吗？</h5>",buttons:[{text:"继续编辑",type:"button-outline button-positive button-local"},{text:"确定",type:"button-positive button-local",onTap:function(){$scope.backHome()}}]})},$scope.id&&$http.post(basePath+"/third/leaveapply/findJSTXLeaveManageById?id="+$scope.id).success(function(data){"0"==data.status?($scope.update=data.result,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+$scope.actExecutionProcinstId).success(function(data){0==data.status&&($scope.update.currentTaskId=data.result)}),$scope.leaveTypeName=$scope.update.type,$scope.update.typeId=$scope.update.typeId):$scope.notifyMsg("获取数据失败!")}),$scope.assign=function(){if($scope.update.startDate>$scope.update.endDate)return void $scope.notifyMsg("请假开始时间不能大于结束时间！");if(!$scope.update.instruction)return void $scope.notifyMsg("请假原因不能为空！");if(!$scope.update.typeId)return void $scope.notifyMsg("请假类型不能为空！");if(!$scope.update.days)return void $scope.notifyMsg("请假天数不能为空！");if(!$scope.update.startDate)return void $scope.notifyMsg("开始时间不能为空！");if(!$scope.update.endDate)return void $scope.notifyMsg("结束时间不能为空！");if($scope.nodeData.hasNode){if(!$scope.nodeData.nextUserTaskActId)return void $scope.notifyMsg("请选择下一节点！");$scope.update.nextUserTaskActId=$scope.nodeData.nextUserTaskActId}$scope.nodeData.hasUser&&$scope.nodeData.nextTaskUserId&&($scope.update.nextTaskUserId=$scope.nodeData.nextTaskUserId),delete $scope.update.$$hashKey,delete $scope.update.platformSysUserId,delete $scope.update.access_token;var url=2!=$scope.update.processScheduleStates?"saveXTBGLeaveManageByDraftboxTurnProcessMobile":"agree";$http.post(basePath+"/third/leaveapply/"+url,$scope.update).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):($scope.notifyMsg(data.message),$timeout(function(){$scope.backHome()},500))})},$scope.selectUser=function(item){$scope.update.nextTaskUserId=item.id,$scope.update.approvalName=item.name},$scope["delete"]=function(item){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/workflowmanage/deleteJSTXLeaveManageById?id="+$scope.id+"&processInstanceId="+$scope.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$timeout(function(){$scope.addOndeDay()},300),$scope.initActive(),$scope.backHome=function(){yn.plugin.yncordova.close()},$scope.nodeOptions={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNLeave",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,routingStatusType:"YNLeave",userTypeApp:1},$scope.options={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNLeave",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.assign,assign:$scope.choiceUser,urge:!0,reject:$scope.returnApply,rejectPreNode:$scope.returnLastStep,startProcess:$scope.assign,saveDraft:$scope.save,repeal:$scope.revert,deleteDraft:$scope["delete"],deleteProcess:$scope["delete"],chart:$scope.chart,approveHistory:$scope.approve}}}angular.module("myApp").controller("addApplyController",addApplyController),addApplyController.$inject=["$scope","$http","$filter","$ionicLoading","$location","$ionicPopup","$timeout","$rootScope"]}(),function(){"use strict";function leaveApplyController($scope,$http,$location,$ionicModal){$scope.platformSysUserId=$location.search().platformSysUserId,$scope.access_token=$location.search().access_token,$scope.errorFlag=!1,$scope.addSecurityFlag=!1,$scope.showFlag=!1,$http.post(basePath+"/third/leaveapply/findXTBGMyLeaveManageByUserId").success(function(data){0==data.status?null!=data.result&&($scope.showFlag=!0,$scope.list=data.result,angular.forEach($scope.list,function(data){data.flag=!1})):$scope.errorFlag=!0}).error(function(){$scope.errorFlag=!0}),$http.get(basePath+"/third/leaveapply/checkAddSecurity?name=请假申请").success(function(data){$scope.addSecurityFlag=data}).error(function(){$scope.addSecurityFlag=!1}),$scope.changeFlag=function(item){item.flag=!item.flag},$scope.edit=function(item){$location.path("/add_apply").search(item)},$scope.add=function(item){$location.path("/add_apply")};var viewReasonTemplate='<ion-modal-view class="modal-opacity" ng-click="closeViewReasonModal()"> <div class="modal-screen-full"><div class="screen-center padding">{{instruction}}</div></div></ion-modal-view>';$scope.modal=$ionicModal.fromTemplate(viewReasonTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.viewReasonModal=function(data){$scope.instruction=data,$scope.modal.show()},$scope.goTo={isGoTo:!0,gotoFun:function(data,type){this.isGoTo&&(1==type?(this.isGoTo=!this.isGoTo,$scope.viewReasonModal(data)):2==type&&(this.isGoTo=!this.isGoTo,$scope.edit(data)),setTimeout(function(){$scope.goTo.isGoTo=!0},100))}},$scope.refreshModal=function(data){$http.post(basePath+"/third/leaveapply/findXTBGMyLeaveManageByUserId").success(function(data){0==data.status?null!=data.result&&($scope.showFlag=!0,$scope.list=data.result,angular.forEach($scope.list,function(data){data.flag=!1})):$scope.errorFlag=!0}).error(function(){$scope.errorFlag=!0})},$scope.closeViewReasonModal=function(){$scope.modal.hide()},$scope.$on("$destroy",function(){$scope.modal.remove()})}angular.module("myApp").controller("leaveApplyController",leaveApplyController),leaveApplyController.$inject=["$scope","$http","$location","$ionicModal"]}(),function(){"use strict";function leaveApplyViewController($scope,$http,$filter,$ionicLoading,$location,$ionicPopup,$timeout,$rootScope){
$scope.id=$location.search().id,$scope.type=$location.search().type,$scope.actExecutionProcinstId=$location.search().actExecutionProcinstId,$scope.processScheduleStates=$location.search().processScheduleStates,$scope.applyId=$location.search().applyId,$scope.leaveData={},$http.post(basePath+"/third/leaveapply/findJSTXLeaveManageById?id="+$scope.id).success(function(data){"0"==data.status?($scope.leaveData=data.result,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+$scope.actExecutionProcinstId).success(function(data){0==data.status&&($scope.leaveData.currentTaskId=data.result)})):$scope.notifyMsg("获取数据失败!")}),$scope.backHome=function(){yn.plugin.yncordova.close()},$scope.editData=function(){$location.path("/add_apply").search({id:$scope.id,actExecutionProcinstId:$scope.actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates,applyId:$scope.leaveData.userId})},$scope["delete"]=function(item){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/workflowmanage/deleteJSTXLeaveManageById?id="+$scope.id+"&processInstanceId="+$scope.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.revertData=function(item){$scope.saveData={id:$scope.id};$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要撤销吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定撤销",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/workflowmanage/backJSTXLeaveManageByRevert",$scope.saveData).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.urgeData=function(item){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:$scope.leaveData.currentTaskId}}).success(function(data){$scope.notifyMsg(data.message)})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.options={actExecutionProcinstId:$scope.actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates},$scope.agree=function(params){$scope.leaveData.message=params.message,$scope.leaveData.nextTaskUserId=params.nextTaskUserId,$scope.leaveData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/leaveapply/agree",$scope.leaveData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.assigned=function(params){$scope.leaveData.message=params.message,$scope.leaveData.assignedUserId=params.nextTaskUserId,$scope.leaveData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/leaveapply/updateJSTXLeaveManageByTransferAssignee",$scope.leaveData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.returnApply=function(params){$scope.leaveData.message=params.message,$scope.leaveData.nextTaskUserId=params.nextTaskUserId,$scope.leaveData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/leaveapply/backJSTXLeaveManageByStartUser",$scope.leaveData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.returnLastStep=function(params){$scope.leaveData.message=params.message,$scope.leaveData.nextTaskUserId=params.nextTaskUserId,$scope.leaveData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/leaveapply/backJSTXLeaveManageByPreNode",$scope.leaveData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.flowOptions={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNLeave",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.agree,assign:$scope.assigned,urge:!0,reject:$scope.returnApply,rejectPreNode:$scope.returnLastStep,startProcess:$scope.submit,saveDraft:$scope.save,repeal:$scope.revert,deleteDraft:$scope["delete"],deleteProcess:$scope.deleteflow},routingStatusType:"YNLeave",nextNodeApprover:5,assignedPerson:6}}angular.module("myApp").controller("leaveApplyViewController",leaveApplyViewController),leaveApplyViewController.$inject=["$scope","$http","$filter","$ionicLoading","$location","$ionicPopup","$timeout","$rootScope"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("staff_locus",{homePage:!0,url:"/staff_locus",templateUrl:"views/staff_locus/staff_locus.html",controller:"staffLocusController"}).state("staff_locus_detail",{url:"/staff_locus_detail",templateUrl:"views/staff_locus/staff_locus_detail.html",controller:"staffLocusDetailController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function staffLocusController($scope,$http,$location,$timeout){function getCookie(name){return window.localStorage.getItem(name)}function setCookie(name,value){window.localStorage.setItem(name,JSON.stringify(value))}$http.post(basePath+"/third/stafflocus/getCurrentUser").success(function(data){$scope.userCurrentId=data}),$scope.tadayFlag=!0,$scope.tadayFlagAll=!0,$scope.searghAllFlag=!1,$scope.searchFlag=!0,$scope.searchDataErrorFlag=!1,$scope.normalFlag=!0,$scope.abnormalFlag=!0,$scope.searchData={},$scope.normal=0,$scope.abnormal=0;var oldData=null;$scope.isHoldBack=!0;var getData=function(){setTimeout(function(){var dat=getCookie("data"+$scope.userCurrentId);if(dat){$scope.isHoldBack=!1,$scope.listItem=JSON.parse(dat),oldData=angular.copy($scope.listItem);var yes=0,noo=0;angular.forEach($scope.listItem,function(info){var normal=0,abnormal=0;info.jstxPositionBakDetailDTOList&&(normal=info.jstxPositionBakDetailDTOList.length),info.jstxPositionBakDetailDTOAbnormalList&&(abnormal=info.jstxPositionBakDetailDTOAbnormalList.length),info.total=normal+abnormal,info.normal=normal,info.abnormal=abnormal,yes+=normal,noo+=abnormal}),$scope.normal=yes,$scope.abnormal=noo,0==yes&&($scope.normalFlag=!1),0==noo&&($scope.abnormalFlag=!1),$http.post(basePath+"/third/stafflocus/getAlluserByuserIds").success(function(data){"0"==data.status&&setCookie("data"+$scope.userCurrentId,data.result)})}else $scope.loadDataShow()},100)};getData(),$scope.loadData=function(){},$scope.loadDataShow=function(){$http.post(basePath+"/third/stafflocus/getAlluserByuserIds").success(function(data){if($scope.$broadcast("scroll.infiniteScrollComplete"),"0"==data.status)if($scope.isHoldBack=!1,setCookie("data"+$scope.userCurrentId,data.result),$scope.listItem=data.result,oldData=angular.copy($scope.listItem),$scope.listItem){var yes=0,noo=0;angular.forEach($scope.listItem,function(info){var normal=0,abnormal=0;info.jstxPositionBakDetailDTOList&&(normal=info.jstxPositionBakDetailDTOList.length),info.jstxPositionBakDetailDTOAbnormalList&&(abnormal=info.jstxPositionBakDetailDTOAbnormalList.length),info.total=normal+abnormal,info.normal=normal,info.abnormal=abnormal,yes+=normal,noo+=abnormal}),$scope.normal=yes,$scope.abnormal=noo,0==yes&&($scope.normalFlag=!1),0==noo&&($scope.abnormalFlag=!1)}else $scope.normalFlag=!1,$scope.abnormalFlag=!1,$scope.searchDataErrorFlag=!0;else $scope.normalFlag=!1,$scope.abnormalFlag=!1,$scope.searchDataErrorFlag=!0}).error(function(){$scope.searchDataFlag=!1,$scope.searchDataErrorFlag=!0})},$scope.refreshModal=function(){getData()},$scope.toPersonDetail=function(item,type){item.address&&$location.path("/staff_locus_detail").search({id:item.userId,name:item.userName,orgName:item.orgName})},$scope.checkData=function(type){1==type?$scope.tadayFlag=!0:$scope.tadayFlag=!1},$scope.checkSearch=function(type){$scope.searchData={},$scope.searchFlag=!0,1==type?($scope.tadayFlagAll=!1,$scope.searghAllFlag=!0,$scope.search()):($scope.tadayFlagAll=!0,$scope.searghAllFlag=!1,getData())},$scope["delete"]=function(){$scope.searchData={},$scope.searchFlag=!0},$scope.search=function(data){if($scope.searchFlag=!1,null!=oldData&&(angular.forEach(oldData,function(item){var newList=[];angular.forEach($scope.listItem,function(vo){vo.orgOrPersonCount==item.orgOrPersonCount&&(item.jstxPositionBakDetailDTOList&&angular.forEach(item.jstxPositionBakDetailDTOList,function(val){void 0==data||"undefined"==data?newList.push(val):-1!=val.userName.indexOf(data)&&newList.push(val)}),item.jstxPositionBakDetailDTOAbnormalList&&angular.forEach(item.jstxPositionBakDetailDTOAbnormalList,function(va){void 0==data||"undefined"==data?newList.push(va):-1!=va.userName.indexOf(data)&&newList.push(va)}),vo.all=0,vo.allList=newList)})}),$scope.searchFlag=!0,$scope.listItem)){var f=!1;angular.forEach($scope.listItem,function(info){info.allList&&info.allList.length&&(info.allList=info.allList.goHeavy(),info.all=info.allList.length,info.all>0&&(f=!0))}),f?$scope.searchDataFlag=!0:$scope.searchDataFlag=!1}},$scope.$watch("searchData.name",function(newVal,oldVal){newVal&&newVal!=oldVal?($timeout(function(){$scope.search(newVal)},200),$scope.searchFlag=!1):newVal||($scope.searchFlag=!1,$timeout(function(){$scope.search(newVal),$scope.searchFlag=!0},200))}),Array.prototype.goHeavy=function(){for(var res=[],json={},i=0;i<this.length;i++)this[i].userId?json[this[i].userId]||(res.push(this[i]),json[this[i].userId]=!0):res.push(this[i]);return res}}angular.module("myApp").controller("staffLocusController",staffLocusController),staffLocusController.$inject=["$scope","$http","$location","$timeout"]}(),function(){"use strict";function staffLocusDetailController($scope,$http,$location){$scope.userName=$location.search().name,$scope.orgName=$location.search().orgName,$scope.showList=null,$http.post(basePath+"/third/stafflocus/getLocationDetailByuserId?id="+$location.search().id).success(function(data){var total=[];if($scope.messageList={name:"",messlist:[]},data.result){var toDay=[],zuotian=[],qiantian=[],ntian=[];if(angular.forEach(data.result,function(val){if(-1==val.howLongAgo.indexOf("天前"))toDay.push(val);else{var num=Number(val.howLongAgo.replace("天前",""));1==num?zuotian.push(val):2==num?qiantian.push(val):ntian.push(val)}}),toDay.length>0&&($scope.messageList={},$scope.messageList.name="今天",$scope.messageList.dateTime=toDay[0].positionTime.substring(0,10),$scope.messageList.messlist=toDay,total.push($scope.messageList)),zuotian.length>0&&($scope.messageList={},$scope.messageList.name="昨天",$scope.messageList.dateTime=zuotian[0].positionTime.substring(0,10),$scope.messageList.messlist=zuotian,total.push($scope.messageList)),qiantian.length>0&&($scope.messageList={},$scope.messageList.name="前天",$scope.messageList.dateTime=qiantian[0].positionTime.substring(0,10),$scope.messageList.messlist=qiantian,total.push($scope.messageList)),ntian.length>0){var one=0,two=0,three=0,onelist=[],twolist=[],threelist=[];angular.forEach(ntian,function(va){var num=Number(va.howLongAgo.replace("天前",""));num>2&&(0==one||one==num?(one=num,onelist.push(va)):0==two||two==num?(two=num,twolist.push(va)):(0==three||three==num)&&(three=num,threelist.push(va)))}),0!=one&&($scope.messageList={},$scope.messageList.name=one+"天前",$scope.messageList.dateTime=onelist[0].positionTime.substring(0,10),$scope.messageList.messlist=onelist,total.push($scope.messageList)),0!=two&&($scope.messageList={},$scope.messageList.name=two+"天前",$scope.messageList.dateTime=twolist[0].positionTime.substring(0,10),$scope.messageList.messlist=twolist,total.push($scope.messageList)),0!=three&&($scope.messageList={},$scope.messageList.name=three+"天前",$scope.messageList.dateTime=threelist[0].positionTime.substring(0,10),$scope.messageList.messlist=threelist,total.push($scope.messageList))}$scope.showList=total,angular.forEach($scope.showList,function(info){if(info.messlist.length>0){var detailList=[],showTime="",showFlag=!1;info.messlist.sort(function(a,b){var dataA=new Date(a.positionTime),dataB=new Date(b.positionTime);return dataB-dataA}),angular.forEach(info.messlist,function(item){item.showFlag=!1,item.standingTime>0&&(showTime=Math.floor(item.standingTime/60)?Math.floor(item.standingTime/60)+"小时"+Math.floor(item.standingTime%60)+"分钟":Math.floor(item.standingTime%60)+"分钟",showFlag=!0,detailList.push({showFlag:showFlag,showTime:showTime})),detailList.push(item)}),info.messlist=detailList}})}})}angular.module("myApp").controller("staffLocusDetailController",staffLocusDetailController),staffLocusDetailController.$inject=["$scope","$http","$location"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("job_report",{homePage:!0,url:"/job_report",templateUrl:"views/job_report/job_report.html",controller:"jobReportController"}).state("add_report",{url:"/add_report",templateUrl:"views/job_report/add_report.html",controller:"jobReportAddController"}).state("report_detail",{url:"/report_detail",templateUrl:"views/job_report/report_detail.html",controller:"jobReportDetailController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function jobReportController($scope,$ionicPopup,$ionicModal,$location,$http,$ionicLoading,$timeout){$scope.reportList=[],$scope.isTab=$location.search().isTab||2;var getPageDataFun=function(){return{number:0,size:20,totalPages:100}};$scope.pageData=getPageDataFun();var maxLen=0;$scope.setIsTabFun=function(item){if(item){if($scope.isTab==item)return!1;$scope.isTab=item,$scope.reportList=[],$scope.pageData=getPageDataFun(),$scope.ionicLoadingShow()}if(!$scope.pageData.totalPages||$scope.pageData.totalPages<=maxLen)$scope.isMoreData=!0,$scope.ionicLoadingHide(),$scope.$broadcast("scroll.infiniteScrollComplete");else{var suFun=function(data){item&&($scope.reportList=[]),$scope.reportList=$scope.reportList.concat(data.content),maxLen=$scope.reportList.length,$scope.pageData.number=data.number+1,$scope.pageData.size=data.size,$scope.pageData.totalPages=data.totalPages,$scope.ionicLoadingHide(),$scope.$broadcast("scroll.infiniteScrollComplete")};httpVisit("findJSTXWorkReportDTOByPage",{type:$scope.isTab,pageNumber:$scope.pageData.number,pageSize:$scope.pageData.size},{},suFun)}},$scope.loadMoreData=function(){$scope.setIsTabFun()},$scope.ionicLoadingShow=function(){$ionicLoading.show({template:'<ion-spinner class="spinner-theme"></ion-spinner><h4 class="text-theme">加载中</h4>'})},$scope.ionicLoadingHide=function(){$ionicLoading.hide()},$scope.jumpFun={add:function(){$location.path("/add_report").search({})},view:function(info){$location.path("/report_detail").search({id:info.id,isTab:$scope.isTab})}};var httpVisit=function(url,params,data,fun,errFun){params=params||angular.noop,data=data||angular.noop,fun=fun||angular.noop,errFun=errFun||angular.noop;var config={url:basePath+"/third/workreport/"+url,method:"post",params:params,data:data};$http(config).success(function(resultData){$scope.isError=!1,fun&&fun(resultData)}).error(function(resultData){$scope.isError=!0,errFun&&errFun(resultData)})};$scope.getReportTime=function(date){if(date){var dates=date.split("-");return dates[1]+"/"+dates[2]}}}angular.module("myApp").controller("jobReportController",jobReportController),jobReportController.$inject=["$scope","$ionicPopup","$ionicModal","$location","$http","$ionicLoading","$timeout"]}(),function(){"use strict";function jobReportAddController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.id=$location.search().id,$scope.type=$location.search().type,$scope.reportData={},$scope.importantList=[{dictName:"低",dictCode:"1"},{dictName:"中",dictCode:"2"},{dictName:"高",dictCode:"3"}],$scope.getDataFun=function(id){var suFun=function(data){$scope.reportData=angular.copy(data),$scope.userNames=$scope.getUserName($scope.reportData.userDTOList),$scope.reportData&&$scope.reportData.fsAnnexIDs&&$scope.$broadcast("filesDone")};httpVisit("findJSTXWorkReportDTOById",{reportId:id},{},suFun)},$scope.getContentLength=function(info){return info?info.length:0},$scope.getUserName=function(list){var names=[];return list&&0==list.length?"无":(angular.forEach(list,function(val){names.push(val.userName)}),names.toString())},$scope.opreation={canSubmit:!1},$scope.saveData=function(){var checkFun=function(item){if(!item.title)return getMessageFun("提示信息","请填写标题！"),!1;if(!item.reportContent)return getMessageFun("提示信息","请填写内容！"),!1;if(!item.reportTypeName)return getMessageFun("提示信息","请选择报告类型！"),!1;if(!item.importantName)return getMessageFun("提示信息","请选择重要级别！"),!1;if(!item.mainUserName)return getMessageFun("提示信息","请选择主送人！"),!1;if(item.userDTOList&&item.userDTOList.length>0){var flag=!1;if(angular.forEach(item.userDTOList,function(val){val.id==item.mainUserId&&(flag=!0)}),flag)return getMessageFun("提示信息","主送人和抄送人重复，请重新选择！"),!1}return!0},suFun=function(data){$scope.opreation.canSubmit=!1,"0"==data.status?$scope.jumpFun.back():getMessageFun("操作失败",data.message)};checkFun($scope.reportData)&&($scope.opreation.canSubmit=!0,httpVisit("saveOrUpdateJSTXWorkReport",null,$scope.reportData,suFun))},$scope.selectMainUser=function(item){$scope.reportData.mainUserName=item.name,$scope.reportData.mainUserId=item.id},$scope.selectUserList=function(userList){var names=[],userDTOList=[];angular.forEach(userList,function(val){names.push(val.name),userDTOList.push(val)}),$scope.userNames=angular.copy(names),$scope.reportData.userDTOList=angular.copy(userDTOList)};var getMessageFun=function(title,message){$ionicPopup.show({title:title,template:"<h5> "+message+"</h5>",buttons:[{text:"确认",type:" button-theme button-local"}]})},getMessage_new_fun=function(title,mess_1,mess_2,buttons){$ionicPopup.show({title:title,template:"<h5> "+mess_1+'</h5><p class="text-gray">'+mess_2+"</p>",buttons:buttons||[]})};$scope.backMethod=function(){var buttons=[{text:"继续编辑",type:" button-outline button-theme button-local"},{text:"确认返回",type:" button-theme button-local",onTap:function(){$scope.jumpFun.back()}}];getMessage_new_fun("返回提示","返回后，当前编辑内容将丢失","确定要返回吗？",buttons)},$scope.jumpFun={back:function(){$scope.id?$location.path("/report_detail").search({id:$scope.id,isTab:1}):$location.path("/job_report").search({isTab:1})},update:function(){$location.path("/add_report").search({id:$scope.id})}},$scope.reportTypeSelectData={},$scope.importantSelectData={},$scope.reportTypeSelect=function(item){$scope.reportData.reportTypeName=item.dictName,$scope.reportData.reportTypeCode=item.dictCode},$scope.importantSelect=function(item){$scope.reportData.importantName=item.dictName,$scope.reportData.importantStatus=item.dictCode};var httpVisit=function(url,params,data,fun,errFun){params=params||angular.noop,data=data||angular.noop,fun=fun||angular.noop,errFun=errFun||angular.noop;var config={url:basePath+"/third/workreport/"+url,method:"post",params:params,data:data};$http(config).success(function(resultData){fun&&fun(resultData)}).error(function(resultData){$scope.isError=!0,errFun&&errFun(resultData)})};$scope.getReportTypeList=function(){var suFun=function(data){$scope.reportTypeList=data};httpVisit("findReportType",null,null,suFun)},$scope.getReportTypeList(),$scope.id&&$scope.getDataFun($scope.id)}angular.module("myApp").controller("jobReportAddController",jobReportAddController),jobReportAddController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function jobReportDetailController($scope,$ionicPopup,$ionicModal,$location,$http,$ionicLoading,Attachment,$timeout,$ionicScrollDelegate){$scope.id=$location.search().id,$scope.type=$location.search().isTab,$scope.reportData={},$scope.getDataFun=function(id){$ionicScrollDelegate.resize(),$scope.isTab=1;var suFun=function(data){$scope.reportData=angular.copy(data),$scope.reportData&&$scope.reportData.reportContent&&($scope.reportData.instructionShow=$scope.getTitle($scope.reportData.reportContent)),$scope.reportData.fsAnnexIDs&&($scope.reportData.uploadVoList=$scope.reportData.fsAnnexIDs.split(","))};httpVisit("findJSTXWorkReportDTOById",{reportId:$scope.id},{},suFun)},$scope.getUserName=function(list){var names=[];return list&&0==list.length?"无":(angular.forEach(list,function(val){names.push(val.userName)}),names.toString())},$scope.del=function(id){var fun=function(){var suFun=function(data){$scope.jumpFun.back()};httpVisit("delJSTXWorkReport",{reportId:id},{},suFun)};getMessageFun("删除","确定要删除此工作报告吗？",fun,!0)},$scope.viewFileFun=function(fsIds){fsIds&&fsIds.length>0&&Attachment.show(fsIds.toString())},$scope.jumpFun={back:function(){$location.path("/job_report").search({isTab:$scope.type})},update:function(){$location.path("/add_report").search({id:$scope.id})}},$scope.feedBack=function(item){$scope.report={},$scope.show={},$scope.feedType="",null!=item&&"0"==item?($scope.feedType=0,$scope.show.showText="反馈",$scope.show.message="反馈成功!"):($scope.feedType=1,$scope.show.showText="批示",$scope.show.message="批示成功!");$ionicPopup.show({title:""+$scope.show.showText,template:'<textarea type="input" rows="5" class="form-control"  placeholder="输入'+$scope.show.showText+'内容" maxlength="1000" ng-model="report.content"></textarea>',scope:$scope,buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){if($scope.report.content){var dataInfo={type:$scope.feedType,workReportId:$scope.id,content:$scope.report.content};$http.post(basePath+"/third/workreport/saveFeedBackMessage?",dataInfo).success(function(data){"0"==data.status?$scope.getAppoval():(item&&0==item?$scope.show.message="反馈失败!":$scope.show.message="批示失败!",$scope.showFirm($scope.show.message))})}else $scope.showFirm(""+$scope.show.showText+"内容不能为空!"),e.preventDefault()}}]})},$scope.showFirm=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.getAppoval=function(type){$ionicScrollDelegate.resize(),type||($scope.isTab=2),$http.post(basePath+"/third/workreport/findAppovalDataById?reportId="+$scope.id).success(function(data){"0"==data.status&&($scope.appovalData=data.result,$scope.appovalData.length>0?($scope.isTab=2,angular.forEach($scope.appovalData,function(item){item.instructionShow=$scope.getTitle(item.content)})):type&&($scope.isTab=1))})},$scope.getAppoval(1),$scope.timedesc=!0,$scope.timeDesc=function(){$scope.timedesc=!$scope.timedesc},$scope.getTitle=function(data){var title="";return null!=data&&data.length>50?($scope.showTitle=!0,title=data.substring(0,50)+"..."):title=data,title},$scope.showMore=function(item,type){item.instructionShow.length>53?2==type?item.instructionShow=$scope.getTitle(item.content):item.instructionShow=$scope.getTitle(item.content):2==type?item.instructionShow=item.content:(item.instructionShow="",item.instructionShow=item.reportContent)};var httpVisit=function(url,params,data,fun,errFun){params=params||angular.noop,data=data||angular.noop,fun=fun||angular.noop,errFun=errFun||angular.noop;var config={url:basePath+"/third/workreport/"+url,method:"post",params:params,data:data};$http(config).success(function(resultData){fun&&fun(resultData)}).error(function(resultData){$scope.isError=!0,errFun&&errFun(resultData)})},getMessageFun=function(title,message,fun,isCancel){var config={title:title,template:"<h5> "+message+"</h5>",buttons:[{text:"确认",type:" button-theme button-local",onTap:function(){fun&&fun()}}]};isCancel&&config.buttons.push({text:"取消",type:" button-theme button-local"}),$ionicPopup.show(config)};$scope.getDataFun($scope.id)}angular.module("myApp").controller("jobReportDetailController",jobReportDetailController),jobReportDetailController.$inject=["$scope","$ionicPopup","$ionicModal","$location","$http","$ionicLoading","Attachment","$timeout","$ionicScrollDelegate"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("affair_assign",{homePage:!0,url:"/affair_assign",templateUrl:"views/affair_assign/affair_assign.html",controller:"affairAssignlController"}).state("add_assign",{url:"/add_assign",templateUrl:"views/affair_assign/add_assign.html",controller:"addAssignlController"}).state("affair_retroaction",{url:"/affair_retroaction",templateUrl:"views/affair_assign/affair_retroaction.html",controller:"affairRetroactionController"}).state("view_affair",{url:"/view_affair",templateUrl:"views/affair_assign/view_affair.html",controller:"viewAffairController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function addAssignlController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.dataId=$location.search().id,$scope.showIsTab=$location.search().showIsTab,$scope.flagObj={},$scope.assign={watchUserSize:0,helpUserSize:0,teamUserIds:[],attentionUserIds:[],helpUserName:"",watchUserName:""},$http.post(basePath+"/third/businessjournal/findNowDate").success(function(data){"0"==data.status&&($scope.assign.startDate=data.result)}),$scope.dataId&&$http.post(basePath+"/third/affairsassigned/findJSTXAssignedById?assignedId="+$scope.dataId).success(function(data){"0"==data.status&&($scope.assign=data.result,$scope.assign.priorityStatus&&1==$scope.assign.priorityStatus?$scope.flagObj.important=!0:$scope.flagObj.important=!1,$scope.assign.urgentStatus&&1==$scope.assign.urgentStatus?$scope.flagObj.urgent=!0:$scope.flagObj.urgent=!1,$scope.assign&&setFsAnnexIDsFun($scope.assign,$scope.assign.uploadVoList),$scope.checkText(data.result.instruction))});var setFsAnnexIDsFun=function(info,uploadVoList){if(uploadVoList&&uploadVoList.length){var fsAnnexIDs=uploadVoList.toString();info.fsAnnexIDs=fsAnnexIDs,$scope.$broadcast("filesDone")}};$scope.backToMain=function(){if($scope.dataId){$ionicPopup.confirm({title:"返回提示",template:'<h5 class="margin-bottom-0">返回后当前编辑内容将丢失,确定要返回吗？</h5>',buttons:[{text:"继续编辑",type:"button-outline button-theme button-local"},{text:"确定返回",type:" button-theme button-local",onTap:function(e){$location.path("/view_affair").search({id:$scope.dataId,showIsTab:$scope.showIsTab})}}]})}else $location.path("/affair_assign")},$scope.selectUser=function(item){$scope.assign.mainUserId=item.id,$scope.assign.mainUserName=item.name},$http.get(basePath+"/third/affairsassigned/findQJGLTaskAssignedAll").success(function(data){$scope.transactionType=data}),$http.get(basePath+"/third/affairsassigned/findTransactionSourcesCode").success(function(data){$scope.transactionSource=data}),$scope.typeSelect=function(item){$scope.assign.transactionTypeCode=item.id,$scope.assign.qjglTaskAssignedDTO=item,$scope.assign.typeName=item.name},$scope.sourceSelect=function(item){$scope.assign.transactionSourceCode=item.dictCode,$scope.assign.fromName=item.dictName},$scope.opreation={canSubmit:!1},$scope.save=function(){$scope.checkData()},$scope.error=function(data){$ionicLoading.show({template:data,cssClass:"text-color:red"}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.checkData=function(){if(!$scope.assign.name)return $scope.error("事务名称不能为空!"),!1;if(!$scope.assign.instruction)return $scope.error("描述不能为空!"),!1;if(!$scope.assign.startDate)return $scope.error("开始时间不能为空!"),!1;if(null!=$scope.assign.startDate&&null!=$scope.assign.endDate&&$scope.assign.startDate>$scope.assign.endDate)return $scope.error("开始日期不能大于结束日期!"),!1;if(!$scope.assign.mainUserName)return $scope.error("主办人不能为空!"),!1;if(!$scope.assign.typeName)return $scope.error("事务类型不能为空!"),!1;var userFlag=!0;if(null!=$scope.assign.attentionUserIds&&$scope.assign.attentionUserIds.length>0&&angular.forEach($scope.assign.attentionUserIds,function(item){return item==$scope.assign.mainUserId?void(userFlag=!1):void 0}),!userFlag)return $scope.error("关注人和主办人不能相同!"),!1;var teamFlag=!0;if(null!=$scope.assign.teamUserIds&&$scope.assign.teamUserIds.length>0&&angular.forEach($scope.assign.teamUserIds,function(item){return item==$scope.assign.mainUserId?void(teamFlag=!1):void 0}),!teamFlag)return $scope.error("协办人和主办人不能相同!"),!1;var choiseFlag=!0;if($scope.assign.teamUserIds.length>0&&$scope.assign.attentionUserIds.length>0&&angular.forEach($scope.assign.attentionUserIds,function(item){angular.forEach($scope.assign.teamUserIds,function(data){return item==data?void(choiseFlag=!1):void 0})}),!choiseFlag)return $scope.error("关注人和协办人中不能有相同的人!"),!1;if($scope.flagObj.important?$scope.assign.priorityStatus=1:$scope.assign.priorityStatus=2,$scope.flagObj.urgent?$scope.assign.urgentStatus=1:$scope.assign.urgentStatus=2,$scope.assign&&$scope.assign.fsAnnexIDs){$scope.assign.uploadVoList=[];var upList=$scope.assign.fsAnnexIDs.split(",");angular.forEach(upList,function(u){u&&$scope.assign.uploadVoList.push(u)})}$scope.opreation.canSubmit=!0,$http.post(basePath+"/third/affairsassigned/saveOrUpdateJSTXAffairsAssigned?",$scope.assign).success(function(data){if("0"==data.status)$scope.dataId?($location.path("/view_affair").search({id:$scope.dataId}),$scope.opreation.canSubmit=!1):($scope.backToMain(),$scope.opreation.canSubmit=!1);else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确认",type:" button-theme button-local"}]})}})},$scope.min=0,$scope.checkText=function(text){$scope.min=text.length},$scope.selectUserWatch=function(item){$scope.assign.attentionUserIds=[],$scope.assign.watchUserName="";var userList=[];angular.forEach(item,function(data){$scope.assign.attentionUserIds.push(data.id),$scope.assign.watchUserName+=data.name+" ",userList.push(data),$scope.assign.watchUserList=angular.copy(userList)}),$scope.assign.watchUserSize=$scope.assign.attentionUserIds.length},$scope.selectUserHelp=function(item){$scope.assign.teamUserIds=[],$scope.assign.helpUserName="";var userDataList=[];angular.forEach(item,function(data){$scope.assign.teamUserIds.push(data.id),$scope.assign.helpUserName+=data.name+" ",userDataList.push(data),$scope.assign.helpUserList=angular.copy(userDataList)}),$scope.assign.helpUserSize=$scope.assign.teamUserIds.length},$scope.showMore=!1,$scope.clickMore=function(){$ionicScrollDelegate.resize(),$scope.showMore=!$scope.showMore}}angular.module("myApp").controller("addAssignlController",addAssignlController),addAssignlController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function affairAssignlController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.showIsTab=$location.search().pageType,$scope.dataList=[],$scope.showData=!1;var i=0,type=1,flag=!0;$scope.showIsTab&&(type=$scope.showIsTab),$scope.changeStatus=function(item){$scope.showInfo=!1,$scope.isTab=item,$scope.loadData(item)},$scope.showInfo=!1,$scope.loadData=function(item){$scope.isTab=item,type!=item&&($scope.dataList=[],i=0),type=item;var pageNumber=i;i++;var pageSize=20,searchObj={pageNumber:pageNumber,pageSize:pageSize,status:item};$http.get(basePath+"/third/affairsassigned/findJSTXAssignedByConditions",{params:searchObj}).success(function(data){if("0"==data.status){data.result.length<20&&($scope.showInfo=!0),flag=!1;var dataFlag=!0,obj=[];if(angular.forEach(data.result,function(newData){angular.forEach($scope.dataList,function(oldData){newData.id!=oldData.id&&(dataFlag=!1)}),dataFlag&&obj.push(newData)}),$scope.dataList=$scope.dataList.concat(obj),obj.length<20)return void($scope.showInfo=!0);$scope.$broadcast("scroll.infiniteScrollComplete")}})},$scope.showIsTab?($scope.isTab=$scope.showIsTab,$scope.loadData($scope.showIsTab)):($scope.loadData(1),$scope.isTab=1),$scope.goToAdd=function(){$location.path("/add_assign").search({})},$scope.goToShow=function(item){$location.path("/view_affair").search({id:item.id,pageType:$scope.isTab})}}angular.module("myApp").controller("affairAssignlController",affairAssignlController),
affairAssignlController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function affairRetroactionController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout){$scope.dataId=$location.search().id,$scope.assign={},$scope.transactionScheduleFlag=!0,$http.post(basePath+"/third/affairsassigned/findBaseInfoByAssignedIdToApp?assignedId="+$scope.dataId+"&type=1").success(function(data){"0"==data.status&&($scope.assign=data.result,$scope.assign&&($scope.assign.isCoOrganizer&&($scope.transactionScheduleFlag=!1),setFsAnnexIDsFun($scope.assign,$scope.assign.uploadVoList)),$scope.transactionSchedule=$scope.assign.transactionSchedule)});var setFsAnnexIDsFun=function(info,uploadVoList){if(uploadVoList&&uploadVoList.length){var fsAnnexIDs=uploadVoList.toString();info.fsAnnexIDs=fsAnnexIDs,$scope.$broadcast("filesDone")}};$scope.back=function(){$ionicPopup.confirm({title:"返回提示",template:'<h5 class="margin-bottom-0">返回后当前编辑内容将丢失,确定要返回吗？</h5>',buttons:[{text:"继续编辑",type:"button-outline button-theme button-local"},{text:"确定返回",type:"button-theme button-local",onTap:function(e){$scope.cancle()}}]})},$scope.cancle=function(){$location.path("/view_affair").search({id:$scope.dataId})},$scope.error=function(data){$ionicPopup.alert({title:"提示",template:'<h5 class="margin-bottom-0">'+data+"</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})},$scope.checkData=function(){var speed=$scope.assign.transactionSchedule,re=/^[0-9]*[1-9][0-9]*$/;if($scope.transactionScheduleFlag){if(!re.test(speed))return $scope.notifyMsg("事务进度输入不合法,最小为1,最大100"),$scope.assign.transactionSchedule=1,!1;if(parseInt($scope.assign.transactionSchedule)>100)return $scope.notifyMsg("事务进度填写不合理,最大为100%!"),$scope.assign.transactionSchedule=100,!1;if(parseInt($scope.transactionSchedule)>parseInt($scope.assign.transactionSchedule))return $scope.notifyMsg("事务进度不能小于当前事务进度！当前进度："+parseInt($scope.transactionSchedule)+"%"),!1}if(!$scope.assign.instructions)return $scope.notifyMsg("反馈内容不能为空!"),!1;if($scope.assign&&$scope.assign.fsAnnexIDs){$scope.assign.uploadVoList=[];var upList=$scope.assign.fsAnnexIDs.split(",");angular.forEach(upList,function(u){u&&$scope.assign.uploadVoList.push(u)})}var dataInfo={instructionsStarus:2,affairsassignedUserId:$scope.assign.affairsassignedUserId,instructions:$scope.assign.instructions,transactionSchedule:$scope.assign.transactionSchedule,uploadVoList:$scope.assign.uploadVoList};$http.post(basePath+"/third/affairsassigned/saveJSTXRelatedOperation?",dataInfo).success(function(data){if("0"==data.status)$location.path("/view_affair").search({id:$scope.dataId});else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})}})},$scope.min=0,$scope.checkText=function(text){$scope.min=text.length},$scope.changeSpeed=function(item){if(1==item){if($scope.assign.transactionSchedule||($scope.assign.transactionSchedule=0),$scope.assign.transactionSchedule=parseInt($scope.assign.transactionSchedule)+5,parseInt($scope.assign.transactionSchedule)>100)return $scope.notifyMsg("事务进度最大为100%!"),$scope.assign.transactionSchedule=100,!1}else{if($scope.assign.transactionSchedule||($scope.assign.transactionSchedule=0),$scope.assign.transactionSchedule=parseInt($scope.assign.transactionSchedule)-5,parseInt($scope.assign.transactionSchedule)<$scope.transactionSchedule)return $scope.notifyMsg("事务进度不能不能小于当前进度!"),$scope.assign.transactionSchedule=$scope.transactionSchedule,!1;if(parseInt($scope.assign.transactionSchedule)<0)return $scope.notifyMsg("事务进度不能为负!"),$scope.assign.transactionSchedule=0,!1}},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("affairRetroactionController",affairRetroactionController),affairRetroactionController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout"]}(),function(){"use strict";function viewAffairController($scope,$ionicPopup,$http,$filter,$ionicLoading,$ionicScrollDelegate,$location,$timeout,$ionicModal,Attachment){$scope.dataId=$location.search().id,$scope.pageType=$location.search().pageType,$scope.showIsTab=$location.search().showIsTab,$http.post(basePath+"/third/affairsassigned/checkInstructionsStarus?assignedId="+$scope.dataId).success(function(data){$scope.isTab=data,$scope.showIsTab&&($scope.isTab=$scope.showIsTab),1!=data?($scope.getAppovalData(1),$scope.getAppovalData(2)):$scope.loadData()}),$scope.showfeedBack=!1,$scope.showapproval=!1,$scope.showMoreButton=!1,$scope.showSubmit=!1,$scope.showEdit=!1,$scope.showDel=!1,$scope.getInintData=function(){$http.post(basePath+"/third/affairsassigned/findBaseInfoByAssignedIdToApp?assignedId="+$scope.dataId).success(function(data){"0"==data.status&&($scope.assign=data.result,$http.post(basePath+"/third/affairsassigned/findAssignedStatus?assignedId="+$scope.dataId).success(function(data){"0"==data.status&&($scope.flagList=data.result,3==$scope.pageType||4==$scope.pageType||angular.forEach($scope.flagList,function(item){1==item.feed&&($scope.showfeedBack=!0),1==item.sub&&($scope.showapproval=!0),1==item.more&&($scope.showMoreButton=!0),1==item.mit&&100==parseInt($scope.assign.transactionSchedule)&&($scope.showSubmit=!0),1==item.edit&&($scope.showEdit=!0),1==item.del&&parseInt($scope.assign.transactionSchedule)<=100&&($scope.showDel=!0),$scope.showSubmit||$scope.showEdit||$scope.showDel||($scope.showMoreButton=!1)}))}))})},$scope.getInintData(),$scope.loadData=function(){$ionicScrollDelegate.resize(),$scope.upload.show=!1,$scope.show=!1,$scope.isTab=1,$http.post(basePath+"/third/affairsassigned/findXTBGAffairsAssignedByAssignedIdToApp?assignedId="+$scope.dataId).success(function(data){"0"==data.status&&($scope.baseInfo=data.result,$scope.showdata="",$scope.baseInfo.instructionShow=$scope.getTitle($scope.baseInfo.instruction),$scope.baseInfo.isImportant?$scope.showdata="重要,":$scope.showdata="不重要,",$scope.baseInfo.isUrgent?$scope.showdata+="紧急":$scope.showdata+="不紧急")})},$scope.viewFileFun=function(fsIds){fsIds&&fsIds.length>0&&Attachment.show(fsIds.toString())},$scope.appovalData=[],$scope.submitList=[],$scope.getAppoval=function(item){$ionicScrollDelegate.resize(),$scope.upload.show=!1,$scope.show=!1,1==item?$scope.isTab=2:$scope.isTab=3,$http.post(basePath+"/third/affairsassigned/getXTBGRelatedOperationListToApp?assignedId="+$scope.dataId+"&type="+item).success(function(data){"0"==data.status&&(1==item?($scope.appovalData=data.result,$scope.appovalData.length>0&&angular.forEach($scope.appovalData,function(item){item.instructionShow=$scope.getTitle(item.instructions)})):($scope.submitList=data.result,$scope.submitList.length>0&&angular.forEach($scope.submitList,function(item){item.instructionShow=$scope.getTitle(item.instructions),1==item.auditStatus&&($scope.assign.auditStatus=1)})))})},$scope.back=function(){$location.path("/affair_assign").search({pageType:$scope.pageType})},$scope.submit=function(){$scope.sub=angular.copy($scope.assign);$ionicPopup.show({title:"审核",template:'<textarea type="input" rows="5" class="form-control"  placeholder="输入审核意见" maxlength="1000" ng-model="sub.instructions"></textarea>',scope:$scope,buttons:[{text:"取消",type:"button-local button-outline button-theme button-min-width"},{text:"不通过",type:"button-local button-theme",onTap:function(e){$scope.sub.instructionsStarus=1,$scope.subFunction(2)}},{text:"通过",type:"button-local button-theme button-min-width",onTap:function(e){$scope.sub.instructionsStarus=1,$scope.subFunction(1)}}]})},$scope.edit=function(){$location.path("/add_assign").search({id:$scope.dataId,showIsTab:$scope.isTab})},$scope.del=function(){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">删除后将无法恢复,确定要删除吗?',buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){$http.post(basePath+"/third/affairsassigned/deleteJSTXAffairsAssignedList?assignedId="+$scope.dataId).success(function(data){if(data.successCount>0)$location.path("/affair_assign");else{$ionicPopup.alert({title:"删除失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确定",type:"button-theme button-local"}]})}})}}]})},$scope.feedBack=function(){$location.path("/affair_retroaction").search({id:$scope.dataId})},$scope.approval=function(){$scope.appr=angular.copy($scope.assign);$ionicPopup.show({title:"批示",template:'<textarea rows="5" class="form-control"  placeholder="请输入批示内容" maxlength="1000" ng-model="appr.instructions"></textarea>',scope:$scope,buttons:[{text:"取消",type:"button-theme button-local button-outline"},{text:"确认",type:"button-theme button-local",onTap:function(e){if($scope.appr.instructions){var dataInfo={instructionsStarus:3,affairsassignedUserId:$scope.appr.instructionsId,instructions:$scope.appr.instructions};$http.post(basePath+"/third/affairsassigned/saveJSTXRelatedOperation?",dataInfo).success(function(data){"0"==data.status?$scope.getAppoval(1):$scope.notifyMsg(data.message)})}else $scope.notifyMsg("批示内容不能为空!"),e.preventDefault()}}]})},$scope.moreButton=function(){$scope.show=!$scope.show},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.error=function(data){$ionicPopup.alert({title:"提示",template:'<h5 class="margin-bottom-0">'+data+"</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})},$scope.subFunction=function(item){var dataInfo={instructionsStarus:1,affairsassignedUserId:$scope.sub.toExamineId,instructions:$scope.sub.instructions,auditStatus:item};$http.post(basePath+"/third/affairsassigned/saveJSTXRelatedOperation?",dataInfo).success(function(data){if("0"==data.status)$scope.getInintData(),1==item&&($scope.showfeedBack=!1,$scope.showMoreButton=!1,$scope.showSubmit=!1,$scope.showEdit=!1,$scope.showDel=!1),$scope.getAppoval(2);else{$ionicPopup.alert({title:"提交失败",template:'<h5 class="margin-bottom-0">'+data.message+"</h5>",buttons:[{text:"确认",type:"button-theme button-local"}]})}})},$scope.upload={show:!1},$scope.showUpload=function(item){$scope.appovalData=[];var newDataList=[];$scope.upload.show?(angular.forEach(item,function(newData){null!=newData.uploadVoList&&newData.uploadVoList.length>0&&newDataList.push(newData)}),$scope.appovalData=newDataList):($scope.appovalData=[],$scope.getAppoval(1))},$scope.timedesc=!0,$scope.timeDesc=function(){$scope.timedesc=!$scope.timedesc},$scope.getTitle=function(data){var title="";return null!=data&&data.length>50?($scope.showTitle=!0,title=data.substring(0,50)+"..."):title=data,title},$scope.showMore=function(item,type){item.instructionShow.length>53?2==type?item.instructionShow=$scope.getTitle(item.instructions):item.instructionShow=$scope.getTitle(item.instruction):2==type?item.instructionShow=item.instructions:item.instructionShow=item.instruction},$scope.appovalData=[],$scope.submitList=[],$scope.getAppovalData=function(item){$http.post(basePath+"/third/affairsassigned/getXTBGRelatedOperationListToApp?assignedId="+$scope.dataId+"&type="+item).success(function(data){"0"==data.status&&(1==item?($scope.appovalData=data.result,$scope.appovalData.length>0&&angular.forEach($scope.appovalData,function(item){item.instructionShow=$scope.getTitle(item.instructions)})):($scope.submitList=data.result,$scope.submitList.length>0&&angular.forEach($scope.submitList,function(item){item.instructionShow=$scope.getTitle(item.instructions),1==item.auditStatus&&($scope.assign.auditStatus=1)})))})}}angular.module("myApp").controller("viewAffairController",viewAffairController),viewAffairController.$inject=["$scope","$ionicPopup","$http","$filter","$ionicLoading","$ionicScrollDelegate","$location","$timeout","$ionicModal","Attachment"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("view_month_salary",{homePage:!0,url:"/view_month_salary",templateUrl:"views/month_salary/view_month_salary.html",controller:"monthSalaryController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function monthSalaryController($scope,$http,$ionicLoading){function getMonthList(month){return $ionicLoading.show({template:"<h4>正在获取...</h4>",scope:$scope}),$http.get(basePath+"/third/monthsalary/getMonthList",{params:{showDate:month}}).then(function(response){return $ionicLoading.hide(),$scope.pageData.monthList=response.data,response})}function formatShowDate(date){if(date){var chars=date.split("-");return chars[0]+"年"+chars[1]+"月"}return""}function findSalaryByMonth(month){return $http.get(basePath+"/third/monthsalary/findJSTXMonthSalaryDTOByMonth",{params:{month:month}}).then(function(response){return $scope.pageData.salary=response.data,null!==$scope.pageData.salary.incomeItemNames&&0===$scope.pageData.salary.incomeItemNames.length&&null!==$scope.pageData.salary.deductItemNames&&0===$scope.pageData.salary.deductItemNames.length&&null!==$scope.pageData.salary.salaryTableNames&&$scope.pageData.salary.salaryTableNames.length>0&&null!==$scope.pageData.salary.gzglBonusPaywayDTOS&&0===$scope.pageData.salary.gzglBonusPaywayDTOS.length?($scope.pageData.onlyImport=!0,$scope.changeTab(3)):$scope.changeTab(1),response})}function changeMonth(month){return null===month?!1:void $scope.getMonthList(month).then(function(){$scope.findSalaryByMonth($scope.pageData.monthList[1])})}function changeTab(number){switch($scope.pageData.tabNumber=number,$scope.pageData.tabNumber){case 1:$scope.pageData.noData=null===$scope.pageData.salary.incomeItemNames||0===$scope.pageData.salary.incomeItemNames.length;break;case 2:$scope.pageData.noData=null===$scope.pageData.salary.deductItemNames||0===$scope.pageData.salary.deductItemNames.length;break;case 3:$scope.pageData.noData=null===$scope.pageData.salary.salaryTableNames||0===$scope.pageData.salary.salaryTableNames.length;break;case 4:$scope.pageData.noData=null===$scope.pageData.salary.gzglBonusPaywayDTOS||0===$scope.pageData.salary.gzglBonusPaywayDTOS.length;break;default:$scope.pageData.noData=!1}}$scope.pageData={tabNumber:1,onlyImport:!1,noData:!1,monthList:[],salary:{}},$scope.getMonthList=getMonthList,$scope.formatShowDate=formatShowDate,$scope.findSalaryByMonth=findSalaryByMonth,$scope.changeMonth=changeMonth,$scope.changeTab=changeTab,$scope.getMonthList().then(function(){$scope.findSalaryByMonth($scope.pageData.monthList[1])}),$scope.getSocialSecurityShow=function(o1,o2){var str="";return o1&&(str+="公积金"),o1&&o2?str+="和社保":o2&&(str+="社保"),str},$scope.getLeavelAbsenteeismShow=function(o1,o2){var str="";return o1&&(str+="请假"),o1&&o2?str+="和旷工":o2&&(str+="旷工"),str}}angular.module("myApp").controller("monthSalaryController",monthSalaryController),monthSalaryController.$inject=["$scope","$http","$ionicLoading"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("salary",{homePage:!0,url:"/salary",templateUrl:"views/salary/salary.html"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("job_performance",{homePage:!0,url:"/job_performance",templateUrl:"views/job_performance/job_performance.html",controller:"jobPerformanceCtrl"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function jobPerformanceCtrl($scope,$ionicModal,$http,$timeout){$ionicModal.fromTemplateUrl("check-detail.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalOne=modal}),$ionicModal.fromTemplateUrl("save-success.html",{scope:$scope}).then(function(modal){$scope.modalTwo=modal}),$scope.$on("performanceGroup",function(){for(var performanceList=angular.element(".performance-list"),perforListHeightArray=[],i=0;i<performanceList.length;i++)perforListHeightArray.push(performanceList[i].clientHeight);var max=perforListHeightArray[0],maxHeight=function(){for(var j=0;j<perforListHeightArray.length;j++)perforListHeightArray[j]>max&&(max=perforListHeightArray[j]);return max};performanceList.css({height:maxHeight()+"px"})});var url=basePath+"/third/jobPerformance";$scope.search=function(){$scope.showError=!1,$http.get(url+"/getJSTXJobPerformanceByConditions").success(function(data){if($scope.conditions=data.result,"0"==data.status)for(var i=0;i<$scope.conditions.length;i++)$scope.conditions[i].workCofficient?i==$scope.conditions.length-1?$scope.conditions[i].workStatus=0:($scope.conditions[i].workValue=($scope.conditions[i].workCofficient-$scope.conditions[i+1].workCofficient).toFixed(2),$scope.conditions[i].workValue>0&&($scope.conditions[i].workStatus=1),$scope.conditions[i].workValue<0&&($scope.conditions[i].workStatus=2),0==$scope.conditions[i].workValue&&($scope.conditions[i].workStatus=3)):$scope.conditions[i].workStatus=0,$scope.conditions[i].assessmentCofficient?i==$scope.conditions.length-1?$scope.conditions[i].assessmentStatus=0:($scope.conditions[i].assessmentValue=($scope.conditions[i].assessmentCofficient-$scope.conditions[i+1].assessmentCofficient).toFixed(2),$scope.conditions[i].assessmentValue>0&&($scope.conditions[i].assessmentStatus=1),$scope.conditions[i].assessmentValue<0&&($scope.conditions[i].assessmentStatus=2),0==$scope.conditions[i].assessmentValue&&($scope.conditions[i].assessmentStatus=3)):$scope.conditions[i].assessmentStatus=0;else $scope.showError=!0})},$scope.search(),$scope.getCodeName=function(item){var resData="";return item&&angular.forEach($scope.postPerformanceIndexList,function(val){item==val.userDictCode&&(resData=val.dictName)}),resData},$http.get(url+"/findPostPerformanceIndexCodeTable").success(function(data){$scope.postPerformanceIndexList=data}),$scope.openModalOne=function(item,status){var id=status?item.workId:item.assessmentId;$http.get(url+"/getJXGLPerformanInterviewById?id="+id).success(function(data){$scope.item=item,$scope.searchCondition=data.result,status&&angular.forEach($scope.searchCondition.jxglWorkAchievementsDTOList,function(value){-1!=value.jxglLevelContentDTO.leveldescription.indexOf("：")&&(value.jxglLevelContentDTO.leveldescription=value.jxglLevelContentDTO.postPerformIndexCode)})}),$scope.modalOne.show()},$scope.save=function(){var newData={id:$scope.searchCondition.id,interviewStatus:3};$http.post(url+"/updateJXGLPerformanInterviewByState",newData).success(function(data){"0"==data.status&&($scope.modalTwo.show(),$timeout(function(){$scope.modalTwo.hide(),$scope.modalOne.hide(),$scope.search()},3e3))})},$scope.closeModalOne=function(){$scope.modalOne.hide()},$scope.$on("$destroy",function(){$scope.modalOne.remove()})}angular.module("myApp").controller("jobPerformanceCtrl",jobPerformanceCtrl),jobPerformanceCtrl.$inject=["$scope","$ionicModal","$http","$timeout"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("business_trip_apply",{homePage:!0,url:"/business_trip_apply",templateUrl:"views/business_trip_apply/business_trip_apply.html",controller:"businessTripApplyCtrl"}).state("business_trip_add",{firstPage:!0,url:"/business_trip_add",templateUrl:"views/business_trip_apply/business_trip_Add.html",controller:"businessTripAddController"}).state("business_trip_view",{firstPage:!0,url:"/business_trip_view",templateUrl:"views/business_trip_apply/business_trip_view.html",controller:"businessTripViewController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function businessTripApplyCtrl($scope,$ionicModal,$http,$ionicPopup,$rootScope,$ionicLoading,$filter,$timeout){$ionicModal.fromTemplateUrl("business-trip-content.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalOne=modal}),$scope.openModalOne=function(){$scope.modalOne.show()},$scope.closeModalOne=function(){$scope.modalOne.hide()},$scope.$on("$destroy",function(){$scope.modalOne.remove()}),$ionicModal.fromTemplateUrl("business-trip-add.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalTwo=modal}),$scope.openModalTwo=function(e){$scope.modalTwo.show(),e.stopPropagation()},$scope.closeModalTwo=function(){$scope.modalTwo.hide()},$scope.$on("$destroy",function(){$scope.modalTwo.remove()});var entityToShowDataFun=function(dataList){angular.forEach(dataList,function(data){if(-1!=data.beginTime.indexOf(" ")){var applyTimeArr=data.beginTime.split(" "),applyDate=[];applyTimeArr[0]&&applyTimeArr[0].indexOf(!0)&&(applyDate=applyTimeArr[0].split("-"),3==applyDate.length&&(data.beginShowTime=applyDate[1]+"月"+applyDate[2]+"日"))}-1!=data.beginTime.indexOf("-")&&(data.beginTimeStr=data.beginTime.replace(/-/g,"/")),-1!=data.endTime.indexOf("-")&&(data.endTimeStr=data.endTime.replace(/-/g,"/"))})};$scope.processScheduleList=["保存草稿","审批通过","返回修改","审批中"],$scope.addSecurityFlag=!1;var initFun=function(){$scope.pageNumber=0,$scope.showInfo=!1,$scope.dataList=[],$scope.editBusiness={}};initFun(),$http.post(basePath+"/third/leaveapply/checkAddSecurity?name=出差申请").success(function(data){$scope.addSecurityFlag=data}),$scope.loadData=function(){$http.post(basePath+"/third/businessjournal/findXTBGMissionManageByJSTXConditions?pageSize=10&pageNumber="+$scope.pageNumber).success(function(data){if("0"==data.status){if(entityToShowDataFun(data.result),$scope.dataList=$scope.dataList.concat(data.result),0==data.result.length)return $scope.showInfo=!0,!1;$scope.pageNumber+=1,$scope.$broadcast("scroll.infiniteScrollComplete")}})},$scope.initActive=function(index){0==index&&($scope.flowKey={actKey:"YNBusinessTravel",Id:""},$http.post(basePath+"/third/leaveapply/getXTBGActivityByActKeyForProcessDefinition?actKey="+$scope.flowKey.actKey).success(function(data){0==data.status&&($scope.editBusiness.processDefinitionId=data.result.id)}),$http.post(basePath+"/third/businessjournal/getXTBGMissionManageApplyNumber").success(function(data){$scope.editBusiness.applyNumber=data.result})),1==index&&null!=$scope.editBusiness.actExecutionProcinstId&&$http.post(basePath+"/third/businessjournal/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.editBusiness.actExecutionProcinstId).success(function(data){0==data.status&&($scope.editBusiness.currentTaskId=data.result)})},$scope.clientShowInstructFun=function(item){$scope.showInstruction=item.instruction},$scope.addBusinessTripFun=function(){$scope.editBusiness={isAdvanceCost:!1,beginTime:$filter("date")(new Date,"yyyy-MM-dd HH:mm")},$scope.initActive(0)},$scope.editBusinessTripFun=function(item){$scope.editBusiness=item,$scope.initActive(1)},$scope.checkNumber=function(cost,editBusiness){return!/^\d*\.?\d{0,2}$/.test(cost)&&cost?(editBusiness.cost="",$scope.notifyMsg("金额格式不正确！")):void 0};var AddDays=function(date,days){var nd=new Date(date);nd=nd.valueOf(),nd+=24*days*60*60*1e3,nd=new Date(nd);var y=nd.getFullYear(),m=nd.getMonth()+1,d=nd.getDate();9>=m&&(m="0"+m),9>=d&&(d="0"+d);var cdate=y+"-"+m+"-"+d;return cdate};$scope.timeSelect=function(time,status){$timeout(function(){status?$scope.beginTime={minDate:new Date(time)}:$scope.endTime={minDate:new Date(time)}})},$scope.addOneDay=function(){var startDate=$scope.editBusiness.beginTime,str=AddDays(startDate.replace("-","/").replace("-","/"),1);str=str+" "+$scope.editBusiness.beginTime.split(" ")[1],$scope.editBusiness.endTime=str},$scope.selectUser=function(item){$scope.editBusiness.nextTaskUserId=item.id,$scope.editBusiness.approvalName=item.name},$scope.cancelTipsFun=function(){$ionicPopup.show({title:"取消提示",template:"<h5> 返回后，当前编辑内容将丢失，确定要返回吗？</h5>",buttons:[{text:"继续编辑",type:"button-outline button-positive button-local"},{text:"确定返回",type:"button-positive button-local",onTap:function(){$scope.editBusiness={},$scope.closeModalTwo()}}]})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},800)};var num=0;$scope.submit=function(){if(!$scope.editBusiness.instruction)return void $scope.notifyMsg("出差事由不能为空！");if(!$scope.editBusiness.beginTime)return void $scope.notifyMsg("出差时间(开始)不能为空！");if(!$scope.editBusiness.endTime)return void $scope.notifyMsg("出差时间(结束)不能为空！");if($scope.editBusiness.beginTime>$scope.editBusiness.endTime)return void $scope.notifyMsg("请假开始时间不能大于结束时间！");if($scope.editBusiness.cost&&($scope.editBusiness.isAdvanceCost=!0),!$scope.editBusiness.nextTaskUserId)return void $scope.notifyMsg("审批人不能为空！");var url="updateXTBGMissionManageBySubmitProcess";2!=$scope.editBusiness.processScheduleStates&&(url="saveOrUpdateXTBGMissionManageByDraftboxTurnProcess"),num++,1>=num&&$http.post(basePath+"/third/businessjournal/"+url,$scope.editBusiness).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),initFun(),setTimeout(function(){$scope.closeModalTwo(),$scope.loadData(),num=0},500)):$scope.notifyMsg(data.message)})}}angular.module("myApp").controller("businessTripApplyCtrl",businessTripApplyCtrl),businessTripApplyCtrl.$inject=["$scope","$ionicModal","$http","$ionicPopup","$rootScope","$ionicLoading","$filter","$timeout"]}(),function(){"use strict";function businessTripAddController($scope,$ionicModal,$http,$ionicPopup,$rootScope,$ionicLoading,$filter,$timeout,$location){$scope.id=$location.search().id,$scope.processScheduleStates=$location.search().processScheduleStates,$scope.actExecutionProcinstId=$location.search().actExecutionProcinstId,$scope.applyId=$location.search().applyId,$scope.currentTaskId=$location.search().currentTaskId;$scope.processScheduleList=["保存草稿","审批通过","返回修改","审批中"],$scope.addSecurityFlag=!1,$http.post(basePath+"/third/leaveapply/checkAddSecurity?name=出差申请").success(function(data){$scope.addSecurityFlag=data}),$scope.initActive=function(index){0==index&&($scope.flowKey={actKey:"YNBusinessTravel",Id:""},$http.post(basePath+"/third/leaveapply/getXTBGActivityByActKeyForProcessDefinition?actKey="+$scope.flowKey.actKey).success(function(data){0==data.status&&($scope.editBusiness.processDefinitionId=data.result.id)}),$http.post(basePath+"/third/businessjournal/getXTBGMissionManageApplyNumber").success(function(data){$scope.editBusiness.applyNumber=data.result}))},$scope.id?($http.get(basePath+"/third/workflowmanage/findJSTXMissionMangeById?id="+$scope.id).success(function(data){"0"==data.status&&($scope.editBusiness=data.result,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+$scope.actExecutionProcinstId).success(function(data){0==data.status&&($scope.editBusiness.currentTaskId=data.result)}))}),$scope.initActive(1)):($scope.editBusiness={isAdvanceCost:!1,beginTime:$filter("date")(new Date,"yyyy-MM-dd HH:mm")},$scope.initActive(0)),$scope.checkNumber=function(cost,editBusiness){return!/^\d*\.?\d{0,2}$/.test(cost)&&cost?(editBusiness.cost="",$scope.notifyMsg("金额格式不正确！")):void 0};var AddDays=function(date,days){var nd=new Date(date);nd=nd.valueOf(),nd+=24*days*60*60*1e3,nd=new Date(nd);var y=nd.getFullYear(),m=nd.getMonth()+1,d=nd.getDate();9>=m&&(m="0"+m),9>=d&&(d="0"+d);var cdate=y+"-"+m+"-"+d;return cdate};$scope.timeSelect=function(time,status){$timeout(function(){status?$scope.beginTime={minDate:new Date(time)}:$scope.endTime={minDate:new Date(time)}})},$scope.addOneDay=function(){var startDate=$scope.editBusiness.beginTime,str=AddDays(startDate.replace("-","/").replace("-","/"),1);str=str+" "+$scope.editBusiness.beginTime.split(" ")[1],$scope.editBusiness.endTime=str},$scope.selectUser=function(item){$scope.editBusiness.nextTaskUserId=item.id,$scope.editBusiness.approvalName=item.name},$scope.cancelTipsFun=function(){$ionicPopup.show({title:"取消提示",template:"<h5> 返回后，当前编辑内容将丢失，确定要返回吗？</h5>",buttons:[{text:"继续编辑",type:"button-outline button-positive button-local"},{text:"确定返回",type:"button-positive button-local",onTap:function(){$scope.backHome()}}]})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.nodeData={};var flag=!0;$scope.submit=function(){if(flag){if(!$scope.editBusiness.instruction)return void $scope.notifyMsg("出差事由不能为空！");if(!$scope.editBusiness.beginTime)return void $scope.notifyMsg("出差时间(开始)不能为空！");if(!$scope.editBusiness.endTime)return void $scope.notifyMsg("出差时间(结束)不能为空！");if($scope.editBusiness.beginTime>$scope.editBusiness.endTime)return void $scope.notifyMsg("请假开始时间不能大于结束时间！");if($scope.editBusiness.cost&&($scope.editBusiness.isAdvanceCost=!0),$scope.nodeData.hasNode){if(!$scope.nodeData.nextUserTaskActId)return void $scope.notifyMsg("请选择下一节点！");$scope.editBusiness.nextUserTaskActId=$scope.nodeData.nextUserTaskActId}$scope.nodeData.hasUser&&$scope.nodeData.nextTaskUserId&&($scope.editBusiness.nextTaskUserId=$scope.nodeData.nextTaskUserId);var url="updateXTBGMissionManageBySubmitProcess";2!=$scope.editBusiness.processScheduleStates&&(url="saveOrUpdateXTBGMissionManageByDraftboxTurnProcess"),flag=!1,$http.post(basePath+"/third/businessjournal/"+url,$scope.editBusiness).success(function(data){flag=!0,0==data.status?($scope.notifyMsg("提交成功"),$scope.backHome()):($scope.notifyMsg(data.message),$timeout(function(){$scope.backHome()},500))})}},$scope.deleteflow=function(){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/workflowmanage/deleteJSTXMissionManageById?id="+$scope.id+"&processInstanceId="+$scope.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.backHome(),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)})}}]})},$scope.nodeOptions={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNBusinessTravel",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,routingStatusType:"YNBusinessTravel",userTypeApp:1},$scope.options={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNBusinessTravel",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.submit,assign:$scope.choiceUser,urge:!0,reject:$scope.returnApply,rejectPreNode:$scope.returnLastStep,startProcess:$scope.submit,saveDraft:$scope.save,repeal:$scope.revert,deleteDraft:$scope["delete"],deleteProcess:$scope.deleteflow,chart:$scope.chart,approveHistory:$scope.approve}},$scope.backHome=function(){$location.path("/flow_apply").search({id:null})}}angular.module("myApp").controller("businessTripAddController",businessTripAddController),businessTripAddController.$inject=["$scope","$ionicModal","$http","$ionicPopup","$rootScope","$ionicLoading","$filter","$timeout","$location"]}(),function(){"use strict";function businessTripViewController($scope,$ionicModal,$http,$ionicPopup,$rootScope,$ionicLoading,$filter,$timeout,$location){$scope.isTab=$location.search().isTab,$scope.id=$location.search().id,$scope.type=$location.search().type,$scope.actExecutionProcinstId=$location.search().actExecutionProcinstId,$scope.processScheduleStates=$location.search().processScheduleStates,$scope.applyId=$location.search().applyId,$http.get(basePath+"/third/workflowmanage/findJSTXMissionMangeById?id="+$scope.id).success(function(data){"0"==data.status&&($scope.businessData=data.result,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+$scope.actExecutionProcinstId).success(function(data){0==data.status&&($scope.businessData.currentTaskId=data.result)}))}),$scope.backHome=function(){window.history.back()?window.history.back():window.close()},$scope.editData=function(){$location.path("/business_trip_add").search({id:$scope.id,actExecutionProcinstId:$scope.actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates,applyId:$scope.businessData.userId})},$scope["delete"]=function(item){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{
text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/workflowmanage/deleteJSTXMissionManageById?id="+$scope.id+"&processInstanceId="+$scope.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.revertData=function(item){$scope.saveData={id:$scope.id};$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要撤销吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定撤销",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/workflowmanage/backJSTXMissionManageByRevert",$scope.saveData).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.urgeData=function(item){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:$scope.businessData.currentTaskId}}).success(function(data){$scope.notifyMsg(data.message)})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.options={actExecutionProcinstId:$scope.actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates},$scope.agree=function(params){$scope.businessData.message=params.message,$scope.businessData.nextTaskUserId=params.nextTaskUserId,$scope.businessData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/businesstrip/updateJSTXMissionManageBySubmitProcess",$scope.businessData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},2e3)):$scope.notifyMsg(data.message)})},$scope.assigned=function(params){$scope.businessData.message=params.message,$scope.businessData.assignedUserId=params.nextTaskUserId,$scope.businessData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/businesstrip/updateJSTXMissionManageByTransferAssignee",$scope.businessData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.returnApply=function(params){$scope.businessData.message=params.message,$scope.businessData.nextTaskUserId=params.nextTaskUserId,$scope.businessData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/businesstrip/backJSTXMissionManageByStartUser",$scope.businessData).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.returnLastStep=function(params){$scope.businessData.message=params.message,$scope.businessData.nextTaskUserId=params.nextTaskUserId,$scope.businessData.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/businesstrip/backJSTXMissionManageByPreNode",$scope.businessData).success(function(data){0==data.status?($scope.notifyMsg(data.message),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.flowOptions={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNBusinessTravel",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.agree,assign:$scope.assigned,urge:!0,reject:$scope.returnApply,rejectPreNode:$scope.returnLastStep,startProcess:$scope.submit,saveDraft:$scope.save,repeal:$scope.revert,deleteDraft:$scope["delete"],deleteProcess:$scope.deleteflow},routingStatusType:"YNBusinessTravel",nextNodeApprover:5,assignedPerson:6}}angular.module("myApp").controller("businessTripViewController",businessTripViewController),businessTripViewController.$inject=["$scope","$ionicModal","$http","$ionicPopup","$rootScope","$ionicLoading","$filter","$timeout","$location"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("outwork_apply",{homePage:!0,url:"/outwork_apply",templateUrl:"views/outwork_apply/outwork_apply.html",controller:"outworkApplyController"}).state("outwork_apply_add",{url:"/outwork_apply_add",templateUrl:"views/outwork_apply/outwork_apply_add.html",controller:"outworkApplyAddController"}).state("outwork_apply_view",{url:"/outwork_apply_view",templateUrl:"views/outwork_apply/outwork_apply_view.html",controller:"outworkApplyViewController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function outworkApplyController($scope,$http,$location,$ionicModal){$scope.platformSysUserId=$location.search().platformSysUserId,$scope.access_token=$location.search().access_token,$scope.list=[],$scope.errorFlag=!1,$scope.addSecurityFlag=!1,$scope.moreData=!0,$scope.pageNumber=0,$http.post(basePath+"/third/jstxOutSideManageResource/getXTBGOutSideManageListById?pageNumber="+$scope.pageNumber+"&pageSize=10").success(function(data){0==data.status&&(null!=data.result?$scope.list=data.result.content:$scope.errorFlag=!0)}),$scope.edit=function(item){$location.path("/outwork_apply_add").search({id:item.id})},$scope.add=function(){$location.path("/outwork_apply_add").search()};var viewTemplate='<ion-modal-view class="modal-opacity" ng-click="closeViewModal()"> <div class="modal-screen-full"><div class="screen-center padding">{{instruction}}</div></div></ion-modal-view>';$scope.modal=$ionicModal.fromTemplate(viewTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.viewModal=function(data){$scope.instruction=data,$scope.modal.show()},$scope.goTo={isGoTo:!0,gotoFun:function(data,type){this.isGoTo&&(1==type?(this.isGoTo=!this.isGoTo,$scope.viewModal(data)):2==type&&(this.isGoTo=!this.isGoTo,$scope.edit(data)),setTimeout(function(){$scope.goTo.isGoTo=!0},100))}},$http.get(basePath+"/third/jstxOutSideManageResource/checkAddSecurity?name=外勤申请").success(function(data){$scope.addSecurityFlag=data}).error(function(){$scope.addSecurityFlag=!1}),$scope.loadData=function(){$scope.pageNumber++,$http.post(basePath+"/third/jstxOutSideManageResource/getXTBGOutSideManageListById?pageNumber="+$scope.pageNumber+"&pageSize=10").success(function(data){null!=data.result&&($scope.list=$scope.list.concat(data.result.content),0!=data.result.content.length?$scope.$broadcast("scroll.infiniteScrollComplete"):$scope.moreData=!1)})},$scope.doRefresh=function(){$http.post(basePath+"/third/jstxOutSideManageResource/getXTBGOutSideManageListById?pageNumber=0&&pageSize="+10*($scope.pageNumber+1)).success(function(data){null!=data.result&&($scope.list=data.result.content,$scope.$broadcast("scroll.refreshComplete"))})},$scope.closeViewModal=function(){$scope.modal.hide()}}angular.module("myApp").controller("outworkApplyController",outworkApplyController),outworkApplyController.$inject=["$scope","$http","$location","$ionicModal"]}(),function(){"use strict";function outworkApplyAddController($scope,$http,$ionicLoading,$location,$ionicPopup,$timeout,$rootScope,$filter){$scope.update={},$scope.nodeData={},$scope.processScheduleStates=$location.search().processScheduleStates,$scope.actExecutionProcinstId=$location.search().actExecutionProcinstId,$scope.applyId=$location.search().applyId,$location.search().id?$http.get(basePath+"/third/jstxOutSideManageResource/findXTBGOutSideManageById?id="+$location.search().id).success(function(data){$scope.update=data.result}):$scope.update.beginTime=$filter("date")(new Date,"yyyy-MM-dd HH:mm"),$location.search().id&&($scope.goBackTime=function(time){$timeout(function(){return new Date(time)})}),$scope.initActive=function(){$scope.flowKey={actKey:"YNFieldPersonnel",Id:""},$http.post(basePath+"/third/leaveapply/getXTBGActivityByActKeyForProcessDefinition?actKey="+$scope.flowKey.actKey).success(function(data){0==data.status&&($scope.update.processDefinitionId=data.result.id)})},$scope.cancelTips=function(){$ionicPopup.show({title:"取消提示",template:"<h5> 返回后，当前编辑内容将丢失，确定要返回吗？</h5>",buttons:[{text:"继续编辑",type:"button-outline button-positive button-local"},{text:"确定返回",type:"button-positive button-local",onTap:function(){$scope.backHome()}}]})};var num=0;$scope.assign=function(){if($scope.update.beginTime>$scope.update.endTime)return void $scope.notifyMsg("开始时间不能大于结束时间！");if(!$scope.update.instruction)return void $scope.notifyMsg("外勤事由不能为空！");if(!$scope.update.beginTime)return void $scope.notifyMsg("开始时间不能为空！");if(!$scope.update.endTime)return void $scope.notifyMsg("结束时间不能为空！");if($scope.nodeData.hasNode){if(!$scope.nodeData.nextUserTaskActId)return void $scope.notifyMsg("请选择下一节点！");$scope.update.nextUserTaskActId=$scope.nodeData.nextUserTaskActId}$scope.nodeData.hasUser&&$scope.nodeData.nextTaskUserId&&($scope.update.nextTaskUserId=$scope.nodeData.nextTaskUserId),delete $scope.update.$$hashKey,delete $scope.update.platformSysUserId,delete $scope.update.access_token;var url="";url=2==$scope.update.processScheduleStates?"agree":"saveOrUpdateXTBGOutSideManageByDraftboxTurnProcess",num++,1>=num?$http.post(basePath+"/third/jstxOutSideManageResource/"+url,$scope.update).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),num=0,$timeout(function(){$scope.backHome()},500)):($scope.notifyMsg(data.message),$timeout(function(){$scope.backHome(),num=0},500),num--)}):num--},$scope.deleteflow=function(){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/jstxOutSideManageResource/deleteXTBGOutSideManageByIdAndProcessInstanceId?id="+$location.search().id+"&processInstanceId="+$scope.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.selectUser=function(item){$scope.update.nextTaskUserId=item.id,$scope.update.approvalName=item.name},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.initActive(),$scope.nodeOptions={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNFieldPersonnel",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,routingStatusType:"YNFieldPersonnel",userTypeApp:1},$scope.options={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNFieldPersonnel",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.assign,assign:$scope.choiceUser,urge:!0,reject:$scope.returnApply,rejectPreNode:$scope.returnLastStep,startProcess:$scope.assign,saveDraft:$scope.save,repeal:$scope.revert,deleteDraft:$scope["delete"],deleteProcess:$scope.deleteflow,chart:$scope.chart,approveHistory:$scope.approve}},$scope.backHome=function(){$location.path("/flow_apply").search({id:null})}}angular.module("myApp").controller("outworkApplyAddController",outworkApplyAddController),outworkApplyAddController.$inject=["$scope","$http","$ionicLoading","$location","$ionicPopup","$timeout","$rootScope","$filter"]}(),function(){"use strict";function outworkApplyViewController($scope,$http,$ionicLoading,$location,$ionicPopup,$timeout,$rootScope){var actExecutionProcinstId=$location.search().actExecutionProcinstId;$scope.processScheduleStates=$location.search().processScheduleStates;var id=$location.search().id;$scope.applyId=$location.search().applyId,$scope.type=$location.search().type,$scope.currentTaskId={},$http.get(basePath+"/third/jstxOutSideManageResource/findXTBGOutSideManageById?id="+id).success(function(data){$scope.update=data.result,$http.post(basePath+"/third/xtbgactivity/getXTBGActivityByProcessInstanceIdByEveryOneForCurrentTask?processInstanceId="+actExecutionProcinstId).success(function(data){0==data.status&&($scope.currentTaskId=data.result,$scope.update.currentTaskId=data.result)})}),$scope.backHome=function(){window.history.back()?window.history.back():window.close()},$scope.editData=function(){$location.path("/outwork_apply_add").search({id:id,actExecutionProcinstId:actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates,applyId:$scope.applyId})},$scope["delete"]=function(item){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/jstxOutSideManageResource/deleteXTBGOutSideManageByIdAndProcessInstanceId?id="+id+"&processInstanceId="+actExecutionProcinstId).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.revertData=function(item){$scope.saveData={id:id};$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要撤销吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定撤销",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/jstxOutSideManageResource/backXTBGOutSideManageByRevert",$scope.saveData).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.backHome()):$scope.notifyMsg(data.message)})}}]})},$scope.urgeData=function(item){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:$scope.currentTaskId}}).success(function(data){$scope.notifyMsg(data.message)})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.options={actExecutionProcinstId:actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates},$scope.agree=function(params){$scope.update.message=params.message,$scope.update.nextTaskUserId=params.nextTaskUserId,$scope.update.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/jstxOutSideManageResource/updateXTBGOutSideManageBySubmitProcess",$scope.update).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.assigned=function(params){$scope.update.message=params.message,$scope.update.assignedUserId=params.nextTaskUserId,$scope.update.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/jstxOutSideManageResource/updateXTBGOutSideManageByTransferAssignee",$scope.update).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.returnApply=function(params){$scope.update.message=params.message,$scope.update.nextTaskUserId=params.nextTaskUserId,$scope.update.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/jstxOutSideManageResource/backXTBGOutSideManageByStartUser",$scope.update).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.returnLastStep=function(params){$scope.update.message=params.message,$scope.update.nextTaskUserId=params.nextTaskUserId,$scope.update.nextUserTaskActId=params.nextUserTaskActId,$http.post(basePath+"/third/jstxOutSideManageResource/backXTBGOutSideManageByPreNode",$scope.update).success(function(data){0==data.status?($scope.notifyMsg("提交成功"),$timeout(function(){$scope.backHome()},500)):$scope.notifyMsg(data.message)})},$scope.flowOptions={instanceId:actExecutionProcinstId,definitionKey:"YNFieldPersonnel",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.agree,assign:$scope.assigned,urge:!0,reject:$scope.returnApply,rejectPreNode:$scope.returnLastStep,startProcess:$scope.submit,saveDraft:$scope.save,repeal:$scope.revert,deleteDraft:$scope["delete"],deleteProcess:$scope.deleteflow},routingStatusType:"YNFieldPersonnel",nextNodeApprover:5,assignedPerson:6}}angular.module("myApp").controller("outworkApplyViewController",outworkApplyViewController),outworkApplyViewController.$inject=["$scope","$http","$ionicLoading","$location","$ionicPopup","$timeout","$rootScope"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("outwork_sign",{homePage:!0,url:"/outwork_sign",templateUrl:"views/outwork_sign/outwork_sign.html",controller:"outworkSignCtrl"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function outworkSignCtrl($scope,$ionicModal,$timeout,$http,$filter,$ionicLoading,$ionicPlatform,stringsConstant,$cordovaFileTransfer,$cordovaFile,$ionicPopup){function gpsError(){$scope.cityCode="",setTimeout(function(){$scope.item.gpsAddress=$scope.address=stringsConstant.gps.error,$scope.addressFlag=3,$scope.$digest()},500)}function onDeviceReady(){function takeSuccess(data){var photo={uri:data,path:data.substr(0,data.lastIndexOf("/")+1),name:data.substr(data.lastIndexOf("/")+1),fsId:"",status:0,progress:0};$scope.photos.push(photo),$scope.buildFillPhotos(),$scope.upload(photo)}function takeError(data){console.error("拍照失败"),console.error(JSON.stringify(data))}console.log("deviceready"),$scope.photos=[],$scope.fillPhotos=[],$scope.buildFillPhotos=function(){$scope.fillPhotos=[];for(var i=0;i<5-$scope.photos.length;i++)$scope.fillPhotos.push(i)},$scope.buildFillPhotos(),$scope.getFsIds=function(){for(var photosFsIds=[],i=0;i<$scope.photos.length;i++)$scope.photos[i].fsId&&photosFsIds.push($scope.photos[i].fsId);$scope.item.photoList=photosFsIds,console.log(JSON.stringify($scope.item.photoList))},$scope.takePhoto=function(){if(!$scope.item.currTime||0==$scope.item.currTime.length)return void $scope.notifyMsg("打卡时间无效，请刷新时间");if(5==$scope.photos.length)return void $ionicPopup.alert({title:"拍照提示",template:"最多只能拍摄5张照片"});var customcamera=yn.plugin.customcamera,opts=[{name:$scope.item.userName,address:$scope.address,time:$filter("date")($scope.serverTime,"yyyy/MM/dd 星期"+["日","一","二","三","四","五","六"][$scope.serverTime.getDay()]+" HH:mm:ss")}];customcamera.startCamera(opts,takeSuccess,takeError)},$scope.deletePhoto=function(photo){$ionicPopup.confirm({title:"删除确认",template:"确认要删除当前照片吗?",cancelText:"取消",okText:"删除"}).then(function(res){res&&(photo.fsId?$http({method:"GET",url:stringsConstant.file.deleteServer()+photo.fsId}).success(function(deletePhotoRes){deletePhotoRes.result&&"success"==deletePhotoRes.result&&$scope.deleteLocalPhoto(photo)}).error(function(deletePhotoErr){console.error("从文件服务器删除文件失败"),console.error(JSON.stringify(deletePhotoErr))}):$scope.deleteLocalPhoto(photo))})},$scope.deleteLocalPhoto=function(photo){$cordovaFile.removeFile(photo.path,photo.name).then(function(removeFileSuccess){for(var i=0;i<$scope.photos.length;i++)$scope.photos[i].uri==photo.uri&&($scope.photos.splice(i,1),$scope.buildFillPhotos(),$scope.getFsIds())},function(removeFileError){console.error("从本地删除文件失败"),console.error(JSON.stringify(removeFileError))})},$scope.previewPhoto=function(photo){function cordovaFileOpenSuccess(){}function cordovaFileOpenError(code){1===code?$ionicPopup.alert({title:"文件预览提示",template:"未能在手机已安装APP中找到可预览此文件的程序"}):$ionicPopup.alert({title:"文件预览提示",template:"预览时发生了未知错误 #"+code})}var cordovaFileOpen=cordova.plugins.disusered.open;cordovaFileOpen(photo.uri,cordovaFileOpenSuccess,cordovaFileOpenError)},$scope.retry=function(photo){console.log("失败文件重试: "+photo.uri),"-1"==photo.status&&$scope.upload(photo)},$scope.upload=function(photo){photo.status="0";var mac=stringsConstant.utils.uuid(),platformSysUserId=JSON.parse(window.localStorage.getItem("authentication")).platformSysUserId,options=new FileUploadOptions;options.params={name:photo.name,platformSysUserId:platformSysUserId,mac:mac},options.headers={authorization:JSON.parse(window.localStorage.getItem("authentication")).access_token},$cordovaFileTransfer.upload(stringsConstant.file.uploadServer(),photo.uri,options).then(function(uploadSuccess){var data={name:photo.name,uploadToFDFS:"uploadToFDFS",platformSysUserId:platformSysUserId,mac:mac};$http({method:"POST",url:stringsConstant.file.mergeServer(),data:data}).success(function(mergeRes){photo.fsId=mergeRes.result,photo.status="1",$scope.getFsIds()}).error(function(mergeErr){console.error("文件合并失败"),console.error(JSON.stringify(mergeErr)),photo.status="-1"})},function(uploadError){console.error("上传失败"),console.error(JSON.stringify(uploadError)),photo.status="-1"},function(progress){$timeout(function(){photo.progress=parseInt(progress.loaded/progress.total*100)+"%",console.log("上传进度: "+photo.progress)})})}}$ionicModal.fromTemplateUrl("sign-success.html",{scope:$scope}).then(function(modal){$scope.modalOne=modal}),$scope.showLoading=function(){$ionicLoading.show({template:"<ion-spinner class='spinner-theme'></ion-spinner><h4 class='text-theme'>加载中</h4>"})},$scope.hideLoading=function(){$ionicLoading.hide()},$scope.openModalOne=function(){$scope.modalOne.show(),$timeout(function(){$scope.modalOne.hide()},3e3)},$scope.closeModalOne=function(){$scope.modalOne.hide()},$scope.$on("$destroy",function(){$scope.modalOne.remove()}),$scope.record="record",$scope.signIn="signIn",$scope.pageContent=[],$scope.item={},($scope.changeTab=function(type){$scope.type=type,type==$scope.signIn?$("#main").removeClass("outwork-sign-history"):$("#main").addClass("outwork-sign-history")})($scope.signIn);var httpVisit=function(url,params,data,fun,errFun){console.log(JSON.stringify(data)),params=params||angular.noop,data=data||angular.noop,fun=fun||angular.noop,errFun=errFun||angular.noop;var config={url:basePath+"/third/fieldSignin/"+url,method:"post",params:params,data:data};$http(config).success(function(resultData){fun&&fun(resultData)}).error(function(resultData){$scope.isError=!0,errFun&&errFun(resultData)})},successFun=function(resultData){$scope.pageData=resultData.result,$scope.pageContent=$scope.pageContent.concat(resultData.result.content),$scope.isLoadData=!1,$timeout(function(){$scope.$broadcast("scroll.infiniteScrollComplete")},1e3)},errorFun=function(resultData){$scope.errorFlag=!0,$scope.page.pageNumber>0&&$scope.page.pageNumber--};$scope.page={pageSize:20,pageNumber:0},($scope.loadData=function(){$scope.errorFlag=!1,httpVisit("findFieldSigninRecord",$scope.page,{},successFun,errorFun)})(),$scope.saveSignIn=function(){if(!$scope.item.currTime||0==$scope.item.currTime.length)return void $scope.notifyMsg("打卡时间无效，请刷新时间");if(1==$scope.addressFlag)return void $scope.notifyMsg(stringsConstant.gps.progress);if($scope.showLoading(),console.log(JSON.stringify($scope.gpsData)),$scope.gpsData){var serverAddress=JSON.parse(window.localStorage.getItem("authentication")).originUrl;$http.get(serverAddress+"/third/version/getCurVersion.htm").success(function(serverInfoData){$http.post(serverInfoData.result.cloudHostAndPost+"/sfjc/rydwformsg/collectLocation.htm?"+$scope.gpsData).success(function(resultData){console.log(JSON.stringify(resultData))}).error(function(errorData){console.log(JSON.stringify(errorData))})}).error(function(serverInfoError){console.log(JSON.stringify(serverInfoError))})}httpVisit("signIn",null,$scope.item,function(data){0==data.status&&($scope.hideLoading(),setTimeout(function(){$scope.openModalOne(),$scope.pageContent.unshift(data.result),$scope.pageData.totalElements=parseInt($scope.pageData.totalElements)+1,$scope.item={userId:$scope.item.userId,userName:$scope.item.userName,gpsAddress:$scope.address},$scope.changeTab($scope.record),$scope.photos=[],$scope.buildFillPhotos(),$scope.getFsIds(),$scope.$apply()},200))},function(data){$scope.notifyMsg("打卡失败，服务器异常"),console.log(JSON.stringify(data))})};var intervalId;($scope.getCurrTime=function(){$scope.item.currTime=null;var base=1e3;intervalId&&clearInterval(intervalId),httpVisit("getCurrTimeAndUser",{},{},function(data){var currTime=new Date(data.result.signinTime);$scope.serverTime=currTime,$scope.item.userName=data.result.userName,$scope.item.userId=data.result.userId,intervalId=window.setInterval(function(){currTime.setTime(currTime.getTime()+1e3),$scope.item.currTime=$filter("date")(currTime,"HH:mm:ss"),$scope.$apply()},base)})})(),$scope.imgUrl=function(fsId){return stringsConstant.file.downloadServer()+fsId},$scope.loadDataMore={flag:!0,loadMore:function(){$scope.isLoadData=!0,$scope.pageData&&$scope.pageContent.length!=$scope.pageData.totalElements&&($scope.page.pageNumber++,$scope.loadData())}},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},800)},$scope.loadGPSAddress=function(){$scope.cityCode="",$scope.addressFlag=1,$scope.address=stringsConstant.gps.progress,navigator.geolocation.getCurrentPosition(function(position){console.log("定位成功geolocation："+JSON.stringify(position)),position.timestamp?$http.jsonp("http://api.map.baidu.com/geocoder/v2/?ak=kdGPrRp7Ufrv5thTKbSCDEnkSiNFkRg8&callback=JSON_CALLBACK&output=json",{params:{location:position.coords.latitude+","+position.coords.longitude}}).success(function(data){var addressComponent=data.result.addressComponent;$scope.cityCode=addressComponent.adcode,$scope.item.gpsAddress=$scope.address=data.result.formatted_address+data.result.sematic_description,$scope.distance=addressComponent.distance,$scope.addressFlag=2;var userId=JSON.parse(window.localStorage.getItem("authentication")).platformSysUserId;$scope.gpsData="errorRange="+position.coords.accuracy+"&address="+$scope.address+"&lastCollectTime="+$filter("date")(new Date(position.timestamp),"yyyy-MM-dd HH:mm:ss")+"&longAndLat="+position.coords.longitude+","+position.coords.latitude+"&gpsIsOpen=0&rsglSysUserId="+userId}).error(function(geocoderError){console.error("定位失败geocoder: "+JSON.stringify(geocoderError)),gpsError()}):(console.error("定位失败: timestamp is null"),gpsError())},function(getCurrentPositionError){console.error("定位失败geolocation:"+JSON.stringify(getCurrentPositionError)),gpsError()})},$ionicPlatform.ready(function(){$scope.loadGPSAddress()}),document.addEventListener("deviceready",onDeviceReady,!1)}angular.module("myApp").controller("outworkSignCtrl",outworkSignCtrl),outworkSignCtrl.$inject=["$scope","$ionicModal","$timeout","$http","$filter","$ionicLoading","$ionicPlatform","stringsConstant","$cordovaFileTransfer","$cordovaFile","$ionicPopup"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("inform_index",{firstPage:!0,url:"/inform_index",templateUrl:"views/inform_index/inform_index.html",controller:"inform_indexController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function inform_indexController($scope,$http,$location,$cordovaFileTransfer,$cordovaFile,$ionicPopup){document.addEventListener("deviceready",function(){function formatSize(bytes){if(0===bytes)return"0 B";var k=1024,sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(bytes)/Math.log(k));return(bytes/Math.pow(k,i)).toPrecision(3)+" "+sizes[i]}var downloadServer=basePath+"/outuploader/downloadStream?fastDFSId=",downLoadPath=cordova.file.documentsDirectory+"Data/Downloads/";ionic.Platform.isAndroid()&&(downLoadPath=cordova.file.externalDataDirectory+"Downloads/");var id=$location.search().id;$location.search().platformSysUserId;$http.get(basePath+"/third/businessjournal/findByNoticeId?id="+id).success(function(data){$scope.sysNoticeDTO=data.result,$scope.sysNoticeDTO.szglFileAttachmentDTOList.length&&angular.forEach($scope.sysNoticeDTO.szglFileAttachmentDTOList,function(value,key){$scope.sysNoticeDTO.szglFileAttachmentDTOList[key].size=formatSize(value.size),$cordovaFile.checkFile(downLoadPath,value.attachmentName).then(function(success){console.log(value.attachmentName+" is downloaded!"),$scope.sysNoticeDTO.szglFileAttachmentDTOList[key].download="打开"},function(error){console.log(JSON.stringify(error)),$scope.sysNoticeDTO.szglFileAttachmentDTOList[key].download="下载"})})}),$scope.downloadFile=function(file){var options={};$cordovaFile.checkFile(downLoadPath,file.attachmentName).then(function(success){console.log(file.attachmentName+" is downloaded!"),$scope.openFile(file),file.download="打开"},function(error){console.log(JSON.stringify(error)),file.download="下载中",$cordovaFileTransfer.download(downloadServer+file.attachmentId,encodeURI(downLoadPath+file.attachmentName),options,!0).then(function(result){console.log(JSON.stringify(result)),$scope.openFile(file)},function(err){console.error(JSON.stringify(err)),$ionicPopup.alert({title:"文件下载提示",template:"文件下载失败 #"+err.code})},function(progress){$timeout(function(){file.downloadProgress=progress.loaded/progress.total*100})})})},$scope.openFile=function(file){function cordovaFileOpenSuccess(){console.log("Open success! "+downLoadPath+file.attachmentName)}function cordovaFileOpenError(code){1===code?$ionicPopup.alert({title:"文件预览提示",template:"未能在手机已安装APP中找到可预览此文件的程序"}):$ionicPopup.alert({title:"文件预览提示",template:"预览时发生了未知错误 #0"})}var cordovaFileOpen=cordova.plugins.disusered.open;cordovaFileOpen(downLoadPath+file.attachmentName,cordovaFileOpenSuccess,cordovaFileOpenError),file.download="打开"}})}angular.module("myApp").controller("inform_indexController",inform_indexController),inform_indexController.$inject=["$scope","$http","$location","$cordovaFileTransfer","$cordovaFile","$ionicPopup"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("flow_approve",{homePage:!0,url:"/flow_approve",templateUrl:"views/approve/approve.html",controller:"approveController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function approveController($scope,$ionicLoading,$ionicModal,$ionicPopup,$http,$timeout,$location,$ionicScrollDelegate){$scope.moreButton=!1,$scope.isTab=!1,1==$location.search().isTab?$scope.isTab=!0:$scope.isTab=!1,$scope.showNoData=!1,$scope.isNoMoreData=!1,$scope.isNoMoreAlreadyData=!1,$scope.areadyData=!1,$scope.approveData=!0,$scope.loadData=function(type){$scope.dataList=[],$scope.alreadyDataList=[],$scope.showNoData=!1,$scope.showNoAlreadyData=!1,$scope.isTab=type,$scope.page=0,$scope.isMoreData=!0,1==type?($scope.alreadyApproveData=!0,$scope.doAlreadyRefresh()):($scope.approveData=!0,$scope.doRefresh($scope.isTab))},$scope.showMoreButton=function(){$scope.moreButton=!$scope.moreButton},$scope.page=0,$scope.dataList=[],$scope.showError=!1,$scope.doRefresh=function(type){$http.post(basePath+"/third/xtbgactivity/findJSTXActivityByCondtionForUndertakeProcess?pageNumber=0&&pageSize=20&isHandled=false",$scope.conditions).success(function(data){"0"==data.status?($scope.dataList=data.result,data.result.length<20&&($scope.isNoMoreData=!0,$scope.approveData=!1),0==$scope.dataList.length?($scope.showNoData=!0,$scope.isNoMoreData=!0):$scope.$broadcast("scroll.refreshComplete"),$ionicScrollDelegate.resize()):$scope.showError=!0})},$scope.alreadyDataList=[],$scope.doAlreadyRefresh=function(){$http.post(basePath+"/third/xtbgactivity/findJSTXActivityByCondtionForUndertakeProcess?pageNumber=0&&pageSize=20&isHandled=true",$scope.conditions).success(function(data){"0"==data.status?($scope.alreadyDataList=data.result,data.result.length<20&&($scope.isNoMoreAlreadyData=!0,$scope.alreadyApproveData=!1),0==$scope.alreadyDataList.length?($scope.isNoMoreAlreadyData=!0,$scope.showNoData=!0):$scope.$broadcast("scroll.refreshComplete"),$ionicScrollDelegate.resize()):$scope.showError=!0})},$scope.loadAlreadyMore=function(){$http.post(basePath+"/third/xtbgactivity/findJSTXActivityByCondtionForUndertakeProcess?pageNumber="+$scope.page+"&pageSize=20&isHandled=true",$scope.conditions).success(function(data){"0"==data.status?($scope.page++,$scope.alreadyDataList=$scope.alreadyDataList.concat(data.result),0==$scope.alreadyDataList.length&&($scope.showNoAlreadyData=!0,$scope.isNoMoreAlreadyData=!0),data.result.length<20&&($scope.alreadyApproveData=!1,$scope.isNoMoreAlreadyData=!0),0!=data.result.length?($scope.alreadyApproveData=!0,$scope.$broadcast("scroll.infiniteScrollComplete")):$scope.alreadyApproveData=!1):$scope.showError=!0})},$scope.loadMore=function(){$http.post(basePath+"/third/xtbgactivity/findJSTXActivityByCondtionForUndertakeProcess?pageNumber="+$scope.page+"&pageSize=20&isHandled=false",$scope.conditions).success(function(data){
"0"==data.status?($scope.page++,$scope.dataList=$scope.dataList.concat(data.result),0==$scope.dataList.length&&($scope.approveData=!0,$scope.isNoMoreData=!0),data.result.length<20&&($scope.approveData=!1,$scope.isNoMoreData=!0),0!=data.result.length?($scope.approveData=!0,$scope.$broadcast("scroll.infiniteScrollComplete")):$scope.approveData=!1):$scope.showError=!0})},$scope.$on("stateChangeSuccess",function(){$scope.isTab?($scope.alreadyApproveData=!0,$scope.loadAlreadyMore()):($scope.approveData=!0,$scope.loadMore())}),$scope.showApproveModal=function(item){$scope.isTab?$scope.showDetail(item):item.isPcOrApp?("YNLeave"==item.actKey&&$location.path("/leave_apply_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"approve",isTab:2}),"YNBusinessTravel"==item.actKey&&$location.path("/business_trip_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"approve",isTab:2}),"YNFieldPersonnel"==item.actKey&&$location.path("/outwork_apply_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"approve",currentTaskId:item.currentTaskId,isTab:2}),"YNExcessivCost"==item.actKey&&$location.path("/excessiv_cost_apply").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"approve",isTab:2}),"YNCostApply"==item.actKey&&$location.path("/cost_apply_view").search({id:item.bussinessId,pageType:"approve"})):$scope.showWarning()},$scope.showDetail=function(item){item.isPcOrApp?("YNLeave"==item.actKey&&$location.path("/leave_apply_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"already",isTab:1}),"YNBusinessTravel"==item.actKey&&$location.path("/business_trip_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"already",isTab:1}),"YNExcessivCost"==item.actKey&&$location.path("/excessiv_cost_apply").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"already",isTab:1}),"YNFieldPersonnel"==item.actKey&&$location.path("/outwork_apply_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,type:"already",currentTaskId:item.currentTaskId,isTab:1}),"YNCostApply"==item.actKey&&$location.path("/cost_apply_view").search({id:item.bussinessId,pageType:"approve"})):$scope.showWarning()},$scope.showInfo=!0,$scope.closeInfo=function(){$scope.showInfo=!1},$scope.showWarning=function(){$ionicLoading.show({template:"此申请只能在电脑上进行审批"}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.showHandleIdea=function(){var myPopup=$ionicPopup.show({template:'<textarea class="form-control" placeholder="输入处理意见，最多X个字"></textarea>',title:"处理意见(非必填)",scope:$scope,buttons:[{text:"取消",type:"button-local button-theme button-outline"},{text:"确定",type:"button-local button-theme"}]});$timeout(function(){myPopup.close()},3e3)}}angular.module("myApp").controller("approveController",approveController),approveController.$inject=["$scope","$ionicLoading","$ionicModal","$ionicPopup","$http","$timeout","$location","$ionicScrollDelegate"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("flow_apply",{homePage:!0,url:"/flow_apply",templateUrl:"views/apply/apply.html",controller:"applyController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function applyController($scope,$ionicModal,$http,$timeout,$location,$ionicPopup,$ionicLoading,$ionicScrollDelegate){$scope.conditions={},$http.post(basePath+"/third/xtbgactivity/findworkFlowTypeToMoblie").success(function(data){0==data.status&&($scope.flowTypeList=data.result)}),$http.post(basePath+"/third/xtbgactivity/getworkFlowTypeList").success(function(data){0==data.status&&($scope.workFlowList=data.result)}),$scope.approveTypeList=[{code:"",name:"全部",isClick:!0},{code:"1",name:"进行中",isClick:!1},{code:"2",name:"已结束",isClick:!1}],$scope.showNoData=!1,$scope.isMoreData=!0,$scope.page=0,$scope.dataList=[],$scope.showError=!1,$scope.clickType=function(type,item){$scope.isMoreData=!1,$scope.showNoData=!1,1==type?($scope.page=0,$scope.conditions.actKey=item.flowKey,$scope.doRefresh(),item.isClick=!item.isClick,angular.forEach($scope.flowTypeList,function(val){item.flowName!=val.flowName?val.isClick=!1:item.isClick=!0})):($scope.conditions.flowStates=item.code,$scope.page=0,$scope.doRefresh(),item.isClick=!item.isClick,angular.forEach($scope.approveTypeList,function(val){item.name!=val.name?val.isClick=!1:item.isClick=!0}))},$scope.doRefresh=function(){$http.post(basePath+"/third/xtbgactivity/findMyStartworkFolwByConditions?pageNumber=0&&pageSize=20",$scope.conditions).success(function(data){"0"==data.status?($ionicScrollDelegate.resize(),$scope.dataList=data.result,0==$scope.dataList.length&&($scope.showNoData=!0),$scope.dataList.length<20&&($scope.isMoreData=!1),$scope.$broadcast("scroll.refreshComplete")):$scope.showError=!0})},$scope.loadMore=function(type){type?$scope.page=0:type="",$http.post(basePath+"/third/xtbgactivity/findMyStartworkFolwByConditions?pageNumber="+$scope.page+"&pageSize=20",$scope.conditions).success(function(data){"0"==data.status?($scope.page++,type&&1==type?($scope.dataList=[],$scope.dataList=$scope.dataList.concat(data.result)):$scope.dataList=$scope.dataList.concat(data.result),0==$scope.dataList.length&&($scope.showNoData=!0),type&&1==type&&0==data.result.length&&($scope.dataList=[]),0!=data.result.length?$scope.$broadcast("scroll.infiniteScrollComplete"):$scope.isMoreData=!1):$scope.showError=!0})},$scope.$on("stateChangeSuccess",function(){$scope.loadMore()}),$scope.deleteData=function(item){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){"YNLeave"==item.actKey&&$http.post(basePath+"/third/workflowmanage/deleteJSTXLeaveManageById?id="+item.bussinessId+"&processInstanceId="+item.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.notifyMsg(data.message),$scope.loadMore(1)):$scope.notifyMsg(data.message)}),"YNBusinessTravel"==item.actKey&&$http.post(basePath+"/third/workflowmanage/deleteJSTXMissionManageById?id="+item.bussinessId+"&processInstanceId="+item.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)}),"YNFieldPersonnel"==item.actKey&&$http.post(basePath+"/third/workflowmanage/deleteJSTXOutSideManageById?id="+item.bussinessId+"&processInstanceId="+item.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)}),"YNExcessivCost"==item.actKey&&$http.post(basePath+"/third/excessivCostApply/deleteXTBGStandardCostApplyByIdAndProcessInstanceId?id="+item.bussinessId+"&processInstanceId="+item.actExecutionProcinstId).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)}),"YNCostApply"==item.actKey&&$http.post(basePath+"/third/feeCostApply/deleteFeeCostApplyById?id="+item.bussinessId).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg("操作成功")):$scope.notifyMsg(data.message)})}}]})},$scope.revertData=function(item){$scope.saveData={id:item.bussinessId,processState:7};$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要撤销吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定撤销",type:" button-theme button-local",onTap:function(e){"YNLeave"==item.actKey&&$http.post(basePath+"/third/workflowmanage/backJSTXLeaveManageByRevert",$scope.saveData).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)}),"YNBusinessTravel"==item.actKey&&$http.post(basePath+"/third/workflowmanage/backJSTXMissionManageByRevert",$scope.saveData).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)}),"YNFieldPersonnel"==item.actKey&&$http.post(basePath+"/third/workflowmanage/backJSTXOutSideManageByRevert",$scope.saveData).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)}),"YNExcessivCost"==item.actKey&&$http.post(basePath+"/third/excessivCostApply/backXTBGStandardCostApplyByStartUser",$scope.saveData).success(function(data){"0"==data.status?($scope.loadMore(1),$scope.notifyMsg(data.message)):$scope.notifyMsg(data.message)})}}]})},$scope.editData=function(item){"YNLeave"==item.actKey&&$location.path("/add_apply").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,currentTaskId:item.currentTaskId}),"YNBusinessTravel"==item.actKey&&$location.path("/business_trip_add").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,currentTaskId:item.currentTaskId}),"YNFieldPersonnel"==item.actKey&&$location.path("/outwork_apply_add").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,currentTaskId:item.currentTaskId}),"YNExcessivCost"==item.actKey&&$location.path("/excessiv_cost_apply").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId,currentTaskId:item.currentTaskId,type:"edit"}),"YNCostApply"==item.actKey&&$location.path("/cost_apply").search({id:item.bussinessId})},$scope.urgeData=function(item){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:item.currentTaskId}}).success(function(data){$scope.notifyMsg(data.message)})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)},$scope.applyFlow=function(item){var actKeyApply={YNLeave:"/add_apply",YNBusinessTravel:"/business_trip_add",YNFieldPersonnel:"/outwork_apply_add",YNExcessivCost:"/excessiv_cost_apply",YNWorkOverTime:""};actKeyApply[item.flowKey]&&$location.path(actKeyApply[item.flowKey]).search({id:null,actExecutionProcinstId:item.actExecutionProcinstId,processDefinitionId:item.processDefinitionId}),"YNCostApply"==item.flowKey&&$location.path("/cost_apply").search({id:null})},$ionicModal.fromTemplateUrl("apply-style.html",{scope:$scope}).then(function(modal){$scope.modalOne=modal}),$scope.chooseApplyStyle=function(){$scope.modalOne.show()},$scope.closeApplyStyle=function(){$scope.modalOne.hide()},$scope.$on("$destroy",function(){$scope.modalOne.remove()}),$scope.showApplyDetail=function(item){"YNLeave"==item.actKey&&$location.path("/leave_apply_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId}),"YNBusinessTravel"==item.actKey&&$location.path("/business_trip_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId}),"YNFieldPersonnel"==item.actKey&&$location.path("/outwork_apply_view").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId}),"YNExcessivCost"==item.actKey&&$location.path("/excessiv_cost_apply").search({id:item.bussinessId,actExecutionProcinstId:item.actExecutionProcinstId,processScheduleStates:item.processScheduleStates,applyId:item.applyUserId}),"YNCostApply"==item.actKey&&$location.path("/cost_apply_view").search({id:item.bussinessId})}}angular.module("myApp").controller("applyController",applyController),applyController.$inject=["$scope","$ionicModal","$http","$timeout","$location","$ionicPopup","$ionicLoading","$ionicScrollDelegate"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("excessiv_cost_apply",{firstPage:!0,url:"/excessiv_cost_apply",templateUrl:"views/excessiv_cost_apply/excessiv_cost_apply.html",controller:"excessivCostApplyCtrl"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function excessivCostApplyCtrl($scope,$ionicModal,$http,$location,$ionicPopup,$rootScope,$ionicLoading,$filter,$timeout,$ionicPlatform){Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},$scope.excessivCost={costRsglSysUser:{},approvalName:"",costOccurDate:(new Date).Format("yyyy-MM-dd"),excessiveAmount:"",overproofReason:""},$scope.nodeData={},$scope.showModel,$scope.id=$location.search().id,$scope.processScheduleStates=$location.search().processScheduleStates;var type=$location.search().type;"edit"!=type&&($scope.type=type),$scope.actExecutionProcinstId=$location.search().actExecutionProcinstId,$scope.excessivCost.processDefinitionId=$location.search().processDefinitionId,$scope.applyId=$location.search().applyId,$scope.actExecutionProcinstId&&$http.post(basePath+"/third/businessjournal/getXTBGActivityByProInstdForCurTask?processInstanceId="+$scope.actExecutionProcinstId).success(function(data){0==data.status&&($scope.excessivCost.currentTaskId=data.result)});var showHtml=function(type){var html="view"==type?"excessiv-view.html":"excessiv-apply.html";$ionicModal.fromTemplateUrl(html,{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.showModel=modal,$scope.showModel.show()})};$ionicPlatform.onHardwareBackButton(function(){$scope.backHome()}),$scope.editData=function(){$scope.showModel.remove(),showHtml("apply")},$scope.checkNumber=function(cost,index){return/^\d{1,13}\.?\d{0,2}$/.test(cost[index])?void 0:(cost[index]="",$scope.notifyMsg("金额格式不正确，且最多只能输入两位小数！"))},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg,duration:2e3})},$scope.backHome=function(){$scope.showModel.remove(),$location.path($scope.type?"/flow_approve":"/flow_apply").search({id:null})},$scope.htmlMessage=function(data){$scope.notifyMsg(data.message),0==data.status?$timeout(function(){$scope.backHome()},2e3):$timeout(function(){$scope.backHome()},500)},$scope.selectUser=function(data){$scope.excessivCost.costRsglSysUser=data,$scope.excessivCost.approvalName=data.name,$scope.excessivCost.approvalNameAndJobNumber=data.name+"("+(data.orgName||data.mainOrganizatName)+")",$scope.excessivCost.costRsglSysUserDTOId=data.id};var checkDataFun=function(data){return data.overproofReason?data.excessiveAmount?data.approvalName?data.costOccurDate?!0:($scope.notifyMsg("费用发生日期不能为空！"),!1):($scope.notifyMsg("费用发生人不能为空！"),!1):($scope.notifyMsg("超标金额不能为空！"),!1):($scope.notifyMsg("超标原因不能为空！"),!1)};$scope.urgeData=function(item){$http.get(basePath+"/third/xtbgactivity/sendActivityRemindersMessage",{params:{taskId:item.currentTaskId}}).success(function(data){$scope.notifyMsg(data.message)})},$scope.assign=function(data){if(!checkDataFun($scope.excessivCost))return!1;if($scope.type&&"approve"==$scope.type)$scope.excessivCost.nextUserTaskActId=data.nextUserTaskActId,$scope.excessivCost.nextTaskUserId=data.nextTaskUserId,$scope.excessivCost.message=data.message;else if($scope.excessivCost.nextTaskUserId=$scope.nodeData.nextTaskUserId,$scope.nodeData.hasNode){if(!$scope.nodeData.nextUserTaskActId)return $scope.notifyMsg("请选择下一级节点！"),!1;$scope.excessivCost.nextUserTaskActId=$scope.nodeData.nextUserTaskActId}httpVisit("saveXTBGStandardCostApplyByDraftboxTurnProcess",null,$scope.excessivCost,function(val){$scope.htmlMessage(val)})},$scope.choiceUser=function(data){$scope.excessivCost.assignedUserId=data.nextTaskUserId,$scope.excessivCost.nextUserTaskActId=data.nextUserTaskActId,$scope.excessivCost.message=data.message,httpVisit("updateXTBGStandardCostApplyByTransferAssignee",null,$scope.excessivCost,function(val){$scope.htmlMessage(val)})},$scope.returnApply=function(data){$scope.excessivCost.processState=4,$scope.excessivCost.assignedUserId=data.nextTaskUserId,$scope.excessivCost.nextUserTaskActId=data.nextUserTaskActId,$scope.excessivCost.message=data.message,httpVisit("backXTBGStandardCostApplyByStartUser",null,$scope.excessivCost,function(val){$scope.htmlMessage(val)})},$scope.returnLastStep=function(data){$scope.excessivCost.assignedUserId=data.nextTaskUserId,$scope.excessivCost.nextUserTaskActId=data.nextUserTaskActId,$scope.excessivCost.message=data.message,httpVisit("backXTBGStandardCostApplyByPreNode",null,$scope.excessivCost,function(val){$scope.htmlMessage(val)})};var revertOrdeleteFun=function(mess,mes,fun){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">'+mess+"</h5>",buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:mes,type:" button-theme button-local",onTap:function(e){fun&&fun()}}]})};$scope.revert=function(data){$scope.excessivCost.processState=7,revertOrdeleteFun("确定要撤销吗？","确定撤销",function(){httpVisit("backXTBGStandardCostApplyByStartUser",null,$scope.excessivCost,function(val){$scope.htmlMessage(val)})})},$scope.deleteflow=function(data){revertOrdeleteFun("确定要删除吗？","确定删除",function(){httpVisit("deleteXTBGStandardCostApplyByIdAndProcessInstanceId",{id:$scope.excessivCost.id,processInstanceId:$scope.actExecutionProcinstId},null,function(val){$scope.htmlMessage(val)})})},$scope.nodeOptions={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNExcessivCost",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,routingStatusType:"YNExcessivCost",userTypeApp:1},$scope.optionsView={actExecutionProcinstId:$scope.actExecutionProcinstId,processScheduleStates:$scope.processScheduleStates},$scope.options={instanceId:$scope.actExecutionProcinstId,definitionKey:"YNExcessivCost",applyId:$scope.applyId,processStatus:$scope.processScheduleStates,button:{agree:$scope.assign||angular.noop,assign:$scope.choiceUser||angular.noop,urge:!0,reject:$scope.returnApply||angular.noop,rejectPreNode:$scope.returnLastStep||angular.noop,startProcess:$scope.assign||angular.noop,saveDraft:$scope.save||angular.noop,repeal:$scope.revert||angular.noop,deleteDraft:$scope["delete"]||angular.noop,deleteProcess:$scope.deleteflow||angular.noop,chart:$scope.chart,approveHistory:$scope.approve,cancel:function(){$scope.backHome()}},routingStatusType:"YNExcessivCost",nextNodeApprover:5,assignedPerson:6};var httpVisit=function(url,params,data,fun,errFun){params=params||angular.noop,data=data||angular.noop,fun=fun||angular.noop,errFun=errFun||angular.noop;var config={url:basePath+"/third/excessivCostApply/"+url,method:"post",params:params,data:data};$http(config).success(function(resultData){fun&&fun(resultData)}).error(function(resultData){$scope.isError=!0,errFun&&errFun(resultData)})};$scope.id?(showHtml("edit"==type?"apply":"view"),httpVisit("findXTBGStandardCostApplyById","",$scope.id,function(data){$scope.excessivCost=angular.copy(data),$scope.selectUser(data.costRsglSysUserDTO)})):(showHtml("apply"),httpVisit("getApplyNumber","","",function(data){$scope.excessivCost.applyNumber=data.applyNumber,$scope.excessivCost.costOccurDate=data.costOccurDate;var userDTO=data.costRsglSysUserDTO;$scope.excessivCost.costRsglSysUser=userDTO,$scope.excessivCost.approvalName=userDTO.name,$scope.excessivCost.approvalNameAndJobNumber=userDTO.name+"("+userDTO.mainOrganizatName+")",$scope.excessivCost.costRsglSysUserDTOId=userDTO.id}))}angular.module("myApp").controller("excessivCostApplyCtrl",excessivCostApplyCtrl),excessivCostApplyCtrl.$inject=["$scope","$ionicModal","$http","$location","$ionicPopup","$rootScope","$ionicLoading","$filter","$timeout","$ionicPlatform"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("cost_apply",{homePage:!0,url:"/cost_apply",templateUrl:"views/cost_apply/cost_apply.html",controller:"costApplyCtrl"}).state("cost_apply_view",{url:"/cost_apply_view",templateUrl:"views/cost_apply/cost_apply_view.html",controller:"costApplyViewController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function costApplyCtrl($scope,$http,$filter,$ionicLoading,$location,$ionicPopup,$timeout,$rootScope,$ionicModal){$scope.id=$location.search().id,$scope.applyData={jyhsMyExpensesInfoDTOList:[]},$scope.detail={},$scope.index=0,$scope.showMore=!1,$scope.showDataList=!0,$scope.detailList=[],$scope.countMoney=0,$scope.getLeader=function(){$http.post(basePath+"/third/feeCostApply/findUserLeader").success(function(data){"0"==data.status&&($scope.applyData.approvalUserId=data.result.id,$scope.applyData.approvalUserName=data.result.name,null==$scope.applyData.approvalUserName&&($scope.applyData.approvalUserName="无"))})},$scope.showIsDel=!1,$scope.id?$http.post(basePath+"/third/feeCostApply/findFeeCostApplyDataById?id="+$scope.id).success(function(data){if("0"==data.status){$scope.applyData=data.result,$scope.applyData.feeTypeName=$scope.applyData.feeTypeName,$scope.getLeader(),angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){$scope.countMoney+=parseFloat(newData.applyMoney?newData.applyMoney:0)});var length=$scope.applyData.jyhsMyExpensesInfoDTOList.length,newList=angular.copy($scope.applyData.jyhsMyExpensesInfoDTOList);length>3?($scope.showMore=!0,$scope.detailList=newList.splice(length-3,length)):$scope.detailList=$scope.applyData.jyhsMyExpensesInfoDTOList}}):$http.post(basePath+"/third/feeCostApply/findUserInfoData").success(function(data){"0"==data.status&&($scope.applyData.applicationUserName=data.result.applicationUserName,$scope.applyData.applyDate=data.result.applyDate,$scope.applyData.applicationUserId=data.result.applicationUserId,$scope.applyData.platformSysOrganizationId=data.result.platformSysOrganizationId,$scope.getLeader())}),$http.post(basePath+"/third/feeCostApply/findFeeTypeListByKey").success(function(data){$scope.feeTypeList=data;var newList=[];angular.forEach($scope.feeTypeList,function(newData){"02"!=newData.dictCode&&newList.push(newData)}),$scope.feeTypeList=newList}),$ionicModal.fromTemplateUrl("select-cost-apply.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modalOne=modal}),$scope.showCostApply=function(){$scope.modalOne.show()},$scope.closeCostApply=function(){$scope.modalOne.hide()},$ionicModal.fromTemplateUrl("add-cost.html",{scope:$scope,animation:"slide-in-left"}).then(function(modal){$scope.modalOne1=modal}),$scope.showAddCost=function(){$scope.detail={},$scope.index=$scope.getMaxNumber(),$scope.modalOne1.show()},$scope.closeAddCost=function(){$scope.modalOne1.hide()},$ionicModal.fromTemplateUrl("edit-cost.html",{scope:$scope,animation:"slide-in-left"}).then(function(modal){$scope.modalEdit=modal}),$scope.showEditCost=function(){$scope.modalEdit.show()},$scope.closeEditCost=function(){$scope.modalEdit.hide()},$scope.showCostWarning=function(){$ionicPopup.confirm({title:"帮助",template:'<p class="text-left">例如填写费用类别：差旅交通费、投标履约保证金、客户招待费等；若是采购资产或是领用礼品等，可直接填入资产名称或礼品名称</p>',buttons:[{text:"确定",type:" button-theme button-local",onTap:function(e){}}]})},$scope.showCostMsgWarning=function(){$ionicPopup.confirm({title:"帮助",template:'<p class="text-left">如投标费用说明转账方式转账要求；资产采购说明采购数量、型号；领取礼品写明礼品赠送客户的单位、接受人；客户接待写明来访客户单位名称、最高领导；出差写明出差地点及事由等等</p>',buttons:[{text:"确定",type:" button-theme button-local",onTap:function(e){}}]})},$scope.editDetail=function(item){var re=/^[0-9]+.?[0-9]{0,2}$/;return re.test(item.applyMoney)?($scope.countMoney=0,angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){newData.index==item.index&&(newData.applyMoney=item.applyMoney,newData.column=item.column,newData.describe=item.describe),$scope.countMoney+=parseFloat(newData.applyMoney?newData.applyMoney:0)}),angular.forEach($scope.detailList,function(newData){newData.index==item.index&&(newData.applyMoney=item.applyMoney,newData.column=item.column,newData.describe=item.describe)}),void $scope.closeEditCost()):($scope.notifyMsg("申请金额必须为数字，且最多两位小数!"),!1)},$scope.getNewText=function(item){var text="";return text=item&&item.length>10?item.substr(0,10)+"...":item},$scope.onSelect=function(item){$scope.applyData.feeTypeName=item.dictName,$scope.applyData.feeTypeCode=item.dictCode,$scope.closeCostApply()},$scope.applyUser=function(item){$scope.applyData.applicationUserName=item.name+"("+item.jobNumber+")",$scope.applyData.applicationUserId=item.id},$scope.showHelp=function(){$ionicPopup.confirm({title:"帮助",template:'<p class="text-left">1、根据学校制度规定，申请人可通过“提交审批”提交到下一级审批人审批。</p><p class="text-left">2、审批结束后费用方可发生，执行时费用应控制在“核准金额”范围内，避免超支。</p>',buttons:[{text:"确定",type:" button-theme button-local",onTap:function(e){}}]})},$scope.back=function(){$location.path("/flow_apply").search({})},$scope.sureDetail=function(){if(!$scope.detail.column)return $scope.notifyMsg("费用项名称不能为空!"),!1;if(null==$scope.detail.applyMoney)return $scope.notifyMsg("申请金额不能为空!"),!1;var re=/^[0-9]+.?[0-9]{0,2}$/;if(!re.test($scope.detail.applyMoney))return $scope.notifyMsg("申请金额必须为数字，且最多两位小数!"),!1;$scope.countMoney=0,$scope.index=$scope.getMaxNumber(),$scope.detail.index=$scope.index;var flag=!0;if(null!=$scope.applyData.jyhsMyExpensesInfoDTOList&&$scope.applyData.jyhsMyExpensesInfoDTOList.length>0&&angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){newData.column==$scope.detail.column&&(flag=!1)}),!flag)return $scope.notifyMsg("费用项名称已经存在!"),!1;$scope.applyData.jyhsMyExpensesInfoDTOList.push($scope.detail);var newList=angular.copy($scope.applyData.jyhsMyExpensesInfoDTOList);if($scope.index>3){$scope.showMore=!0;var length=newList.length;$scope.detailList=newList.splice(length-3,length)}else $scope.detailList=angular.copy(newList);angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){$scope.countMoney+=parseFloat(newData.applyMoney)}),$scope.closeAddCost()},$scope.clickMore=function(){$scope.showMoreData=!0,$scope.showMore=!1,$scope.showDataList=!1},$scope.setDetail=function(item,type){type&&($scope.showIsDel=!0),$scope.showEditCost(),$scope.detail=angular.copy(item),$scope.index=item.index},$scope.delDetail=function(item){var newList=[];if(null!=$scope.applyData.jyhsMyExpensesInfoDTOList&&1==$scope.applyData.jyhsMyExpensesInfoDTOList.length)return void $scope.notifyMsg("一条费用项不允许删除!");var index=1;angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){newData.index!=item.index&&(newData.index=index,newList.push(newData),index++)}),$scope.countMoney=0,$scope.applyData.jyhsMyExpensesInfoDTOList=[],$scope.applyData.jyhsMyExpensesInfoDTOList=newList,newList.length<=3&&($scope.showMore=!1),$scope.detailList=newList,angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){$scope.countMoney+=parseFloat(newData.applyMoney?newData.applyMoney:0)}),$scope.closeEditCost()},$scope.approve=function(){return null!=$scope.applyData.jyhsMyExpensesInfoDTOList&&0==$scope.applyData.jyhsMyExpensesInfoDTOList.length?void $scope.notifyMsg("请至少添加一条费用项!"):$scope.applyData.feeTypeCode?$scope.applyData.applyDate?$scope.applyData.expensesUse?null!=$scope.applyData.expendTimeStart&&null!=$scope.applyData.expendTimeEnd&&$scope.applyData.expendTimeStart>$scope.applyData.expendTimeEnd?($scope.notifyMsg("预计支出开始时间不能大于结束时间！"),!1):void $scope.approveModal.show():void $scope.notifyMsg("费用用途不能为空!"):void $scope.notifyMsg("费用申请时间不能为空!"):void $scope.notifyMsg("费用类别不能为空!")},$scope.approveDataOk=function(){return $scope.applyData.approvalUserId?($scope.closeApproveModal(),void $http.post(basePath+"/third/feeCostApply/saveOrUpdateFeeCostData",$scope.applyData).success(function(data){0==data.status?($scope.notifyMsg("提交成功!"),$timeout(function(){$scope.back()},500)):($scope.notifyMsg(data.message),$timeout(function(){$scope.back()},500))})):void $scope.notifyMsg("请选择审批人!")};var approveTemplate=' <ion-modal-view class="auto bar-up-shadow"><div class="bottom-50"><div class="padding"><div class="approve-flow-wrap flow-title"> <div class="title more">请选择审批人</div><div class="pos-right-text"><input type="text" placeholder="请选择" class="text-left" user-selector onclick="approveUser" inServiceStates = "1" title="审批人" routingStatusType="YNCostApply" userTypeApp="1" ng-model="applyData.approvalUserName"  on-select="selectUser(item)"  readonly><a class="text-right right-text" href="" style="text-decoration:none" ng-if="applyData.approvalUserName" ng-click="reSelectUser(item)">修改<a><a class="text-right right-text" href="" style="text-decoration:none" ng-if="!applyData.approvalUserName" ng-click="reSelectUser(item)">选择<a></div></div></div><ion-footer-bar><div class="row"><div class="col text-center btn-group-wrap"><button class="button button-theme button-local button-outline" ng-click="closeApproveModal()">取消</button><button class="button button-theme button-local" ng-click="approveDataOk()">确定</button></div></div></ion-footer-bar></ion-modal-view>';$scope.approveModal=$ionicModal.fromTemplate(approveTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.closeApproveModal=function(){$scope.approveModal.hide()},$scope.selectUser=function(item){$scope.applyData.approvalUserName=item.name,$scope.applyData.approvalUserId=item.id},$scope.reSelectUser=function(item){$scope.$broadcast("approveUser",item),item&&($scope.feeApplyData.approvalUserName=item.name,$scope.feeApplyData.approvalUserId=item.id)},$scope.getMaxNumber=function(){var max=0;return null!=$scope.applyData.jyhsMyExpensesInfoDTOList&&$scope.applyData.jyhsMyExpensesInfoDTOList.length>0?(angular.forEach($scope.applyData.jyhsMyExpensesInfoDTOList,function(newData){parseInt(newData.index)>=parseInt(max)&&(max=parseInt(newData.index)+1)}),max):1},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("costApplyCtrl",costApplyCtrl),costApplyCtrl.$inject=["$scope","$http","$filter","$ionicLoading","$location","$ionicPopup","$timeout","$rootScope","$ionicModal"]}(),function(){"use strict";function costApplyViewController($scope,$http,$filter,$ionicLoading,$location,$ionicPopup,$timeout,$rootScope,$ionicModal){$scope.id=$location.search().id,$scope.pageType=$location.search().pageType,$scope.countApplyMoney=0,$scope.countApproveMoney=0,$scope.feeApplyData={},$http.post(basePath+"/third/feeCostApply/findFeeCostApplyDataById?id="+$scope.id).success(function(data){"0"==data.status?($scope.feeApplyData=data.result,$scope.approveUserName=data.result.approvalUserName,$scope.approveMoney(),$http.post(basePath+"/third/feeCostApply/findUserLeader").success(function(data){"0"==data.status&&($scope.feeApplyData.approvalUserName=data.result.name,$scope.feeApplyData.approvalUserId=data.result.id,null==$scope.feeApplyData.approvalUserName&&($scope.feeApplyData.approvalUserName="无"))})):$scope.notifyMsg("获取数据失败!")}),$scope.back=function(){window.history.back()?window.history.back():window.close()},
$scope.edit=function(item){$location.path("/cost_apply").search({id:item.id})},$scope.approveMoney=function(){$scope.countApplyMoney=0,$scope.countApproveMoney=0,angular.forEach($scope.feeApplyData.jyhsMyExpensesInfoDTOList,function(newData){$scope.countApproveMoney+=newData.approvalMoney,$scope.countApplyMoney+=newData.applyMoney})},$scope["delete"]=function(item){$ionicPopup.confirm({title:"提示",template:'<h5 class="margin-bottom-0">确定要删除吗？</h5>',buttons:[{text:"取消",type:"button-outline button-theme button-local"},{text:"确定删除",type:" button-theme button-local",onTap:function(e){$http.post(basePath+"/third/feeCostApply/deleteFeeCostApplyById?id="+item.id).success(function(data){"0"==data.status?($scope.notifyMsg("操作成功"),$scope.back()):$scope.notifyMsg(data.message)})}}]})},$scope.showMore=!1,$scope.showMoreButton=function(){$scope.showMore=!$scope.showMore},$scope.pageData={},$scope.showMessage=function(){$scope.show={};$ionicPopup.show({template:'<textarea type="input" rows="5" class="form-control"  placeholder="输入处理意见，最多50个字"  maxlength="50" ng-model="pageData.message"></textarea>',title:"处理意见(非必填)",scope:$scope,buttons:[{text:"取消",type:"button-local button-theme button-outline",onTap:function(e){$scope.pageData.message=""}},{text:"确定",type:"button-local button-theme",onTap:function(e){}}]})},$scope.approvePass=function(type){1==type?$scope.feeApplyData.isPass=!1:$scope.feeApplyData.type="APPROVALED",$scope.feeApplyData.checkOpinion=$scope.pageData.message,$http.post(basePath+"/third/feeCostApply/approveCostApplyData",$scope.feeApplyData).success(function(data){0==data.status?($scope.notifyMsg("审批成功!"),$timeout(function(){$scope.back()},2e3)):($scope.notifyMsg(data.message),$timeout(function(){$scope.back()},2e3))})},$scope.passOthrer=function(){$scope.approveModal.show()};var approveTemplate=' <ion-modal-view class="auto bar-up-shadow"><div class="bottom-50"><div class="padding"><div class="approve-flow-wrap flow-title"> <div class="title more">请选择审批人</div><div class="pos-right-text"><input type="text" class="text-left" placeholder="请选择" user-selector inServiceStates = "1" title="审批人" onclick="approveUser" routingStatusType="YNCostApply" userTypeApp="1" ng-model="feeApplyData.approvalUserName"  on-select="selectUser(item)"  readonly/><a class="text-right right-text" href="" style="text-decoration:none" ng-if="feeApplyData.approvalUserName" ng-click="reSelectUser(item)">修改<a><a class="text-right right-text" href="" style="text-decoration:none" ng-if="!feeApplyData.approvalUserName" ng-click="reSelectUser(item)">选择<a></div></div></div><ion-footer-bar><div class="row"><div class="col text-center btn-group-wrap"><button class="button button-theme button-local button-outline" ng-click="closeApproveModal()">取消</button><button class="button button-theme button-local" ng-click="approveDataOk()">确定</button></div></div></ion-footer-bar></ion-modal-view>';$scope.approveModal=$ionicModal.fromTemplate(approveTemplate,{scope:$scope,animation:"slide-in-up"}),$scope.closeApproveModal=function(){$scope.approveModal.hide()},$scope.selectUser=function(item){$scope.feeApplyData.approvalUserName=item.name,$scope.feeApplyData.approvalUserId=item.id},$scope.reSelectUser=function(item){$scope.$broadcast("approveUser",item),item&&($scope.feeApplyData.approvalUserName=item.name,$scope.feeApplyData.approvalUserId=item.id)},$scope.approveDataOk=function(){$scope.feeApplyData.isPass=!0,$scope.feeApplyData.checkOpinion=$scope.pageData.message,$http.post(basePath+"/third/feeCostApply/approveCostApplyData",$scope.feeApplyData).success(function(data){0==data.status?($scope.notifyMsg("审批成功!"),$scope.closeApproveModal(),$timeout(function(){$scope.back()},2e3)):($scope.notifyMsg(data.message),$timeout(function(){$scope.back()},2e3))})},$scope.notifyMsg=function(msg){$ionicLoading.show({template:msg}),setTimeout(function(){$ionicLoading.hide()},2e3)}}angular.module("myApp").controller("costApplyViewController",costApplyViewController),costApplyViewController.$inject=["$scope","$http","$filter","$ionicLoading","$location","$ionicPopup","$timeout","$rootScope","$ionicModal"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("pdca",{homePage:!0,url:"/pdca",templateUrl:"views/pdca/pdca.html",controller:"pdcaController"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function pdcaController($scope,$ionicModal,$ionicPopup,$location,$http,$timeout){$ionicModal.fromTemplateUrl("add-task.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalOne=modal}),$scope.openModalOne=function(){$scope.modalOne.show()},$scope.closeModalOne=function(){$scope.modalOne.hide()},$scope.$on("$destroy",function(){$scope.modalOne.remove()}),$ionicModal.fromTemplateUrl("add-task-modal.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalTwo=modal}),$scope.openModalTwo=function(){$scope.modalTwo.show()},$scope.closeModalTwo=function(){$scope.modalTwo.hide()},$scope.$on("$destroy",function(){$scope.modalTwo.remove()}),$ionicModal.fromTemplateUrl("task-conclusion.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalThree=modal}),$scope.openModalThree=function(){$scope.modalThree.show()},$scope.closeModalThree=function(){$scope.modalThree.hide()},$scope.$on("$destroy",function(){$scope.modalThree.remove()})}angular.module("myApp").controller("pdcaController",pdcaController),pdcaController.$inject=["$scope","$ionicModal","$ionicPopup","$location","$http","$timeout"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("performance_review",{homePage:!0,url:"/performance_review",templateUrl:"views/performance_review/performance-review.html",controller:"performanceReviewCtrl"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function performanceReviewCtrl($scope,$ionicPopup,$http,$timeout,$ionicLoading,$ionicModal,$filter){$scope.conditions={interviewMonth:"",name:""};var dealMonth=function(month,type){1==type?($scope.conditions.interviewMonth=$scope.mainSearchYear+"-",$scope.mainPageYear=angular.copy($scope.mainSearchYear),$scope.mainSearchMonth=angular.copy(month),1==month.toString().length?$scope.conditions.interviewMonth+="0"+month:$scope.conditions.interviewMonth+=month,$scope.notInterviewSearchFun(),$scope.interviewSearchFun()):2==type&&($scope.childConditions.interviewMonth=$scope.childSearchYear+"-",$scope.childPageYear=angular.copy($scope.childSearchYear),$scope.childSearchMonth=angular.copy(month),1==month.toString().length?$scope.childConditions.interviewMonth+="0"+month:$scope.childConditions.interviewMonth+=month,""!=$scope.childConditions.name&&$scope.searchChildPageFun())},nowDate=$filter("date")(new Date,"yyyy-MM");$scope.nowYear=angular.copy(nowDate.toString().split("-")[0]),$scope.nowMonth=angular.copy(nowDate.toString().split("-")[1]),$scope.mainPageMonth=angular.copy(nowDate.toString().split("-")[1]);var initYearMonth=function(type){1==type?($scope.mainSearchYear=angular.copy(nowDate.toString().split("-")[0]),$scope.mainSearchMonth=angular.copy(nowDate.toString().split("-")[1])):2==type&&($scope.childSearchYear=angular.copy(nowDate.toString().split("-")[0]),$scope.childSearchMonth=angular.copy(nowDate.toString().split("-")[1]))};$http.post(basePath+"/third/jxglPerformInterview/currentJXGLPlanByStatus").success(function(data){if("0"==data.status){var sendDate=data.result;$scope.mainSearchYear=angular.copy(sendDate.toString().split("-")[0]),$scope.mainSearchMonth=angular.copy(sendDate.toString().split("-")[1]),$scope.mainPageYear=angular.copy(sendDate.toString().split("-")[0]);var initMonth=angular.copy(sendDate.toString().split("-")[1]);"0"==initMonth.toString().substring(0,1)?$scope.mainPageMonth=initMonth.toString().substring(1,2):$scope.mainPageMonth=initMonth.toString()}dealMonth($scope.mainPageMonth,1)}),$scope.nowPage=1,$scope.oneTypeErrorFlag=!1,$scope.oneTypeNoResultFlag=!1,$scope.twoTypeErrorFlag=!1,$scope.twoTypeNoResultFlag=!1,$scope.threeTypeErrorFlag=!1,$scope.threeTypeNoResultFlag=!1,$scope.onePageNumber=0,$scope.twoPageNumber=0,$scope.threePageNumber=0,$scope.onePageMoreData=!1,$scope.twoPageMoreData=!1,$scope.threePageSize=0;var refreshFlag=!0;$scope.initSearchYear=function(){$scope.mainSearchYear=angular.copy($scope.mainPageYear)},$scope.currentYear=function(type){1==type?(initYearMonth(1),$scope.mainPageMonth=$scope.nowMonth,dealMonth(nowDate.toString().split("-")[1],type)):2==type&&(initYearMonth(2),$scope.childPageMonth=$scope.nowMonth,dealMonth(nowDate.toString().split("-")[1],type))},$scope.lastYear=function(type){1==type?($scope.mainSearchYear=1*$scope.mainSearchYear-1,$scope.mainSearchMonth=0):2==type&&($scope.childSearchYear=1*$scope.childSearchYear-1,$scope.childSearchMonth=0)},$scope.nextYear=function(type){1==type?($scope.mainSearchYear=1*$scope.mainSearchYear+1,$scope.mainSearchMonth=0):2==type&&($scope.childSearchYear=1*$scope.childSearchYear+1,$scope.childSearchMonth=0)},$scope.chooseMonth=function(month,type){refreshFlag=!0,1==type?($scope.mainPageMonth=month,$scope.mainSearchMonth=month,dealMonth($scope.mainPageMonth,type)):2==type&&($scope.childPageMonth=month,$scope.childSearchMonth=month,dealMonth($scope.childPageMonth,type))},$scope.notInterviewSearchFun=function(){var url="";refreshFlag?($scope.notInterviewItems=[],url=basePath+"/third/jxglPerformInterview/findPerformanInterviewByStatusEqOne?pageNumber=0&pageSize="+50*($scope.onePageNumber+1)):url=basePath+"/third/jxglPerformInterview/findPerformanInterviewByStatusEqOne?pageNumber="+$scope.onePageNumber+"&pageSize=50",$scope.oneTypeNoResultFlag=!1,$http.post(url,$scope.conditions).success(function(data){0==data.status?null!=data.result&&data.result.content.length>0?(refreshFlag?($scope.notInterviewItems=data.result,$scope.onePageSize=data.result.totalElements,$scope.$broadcast("scroll.refreshComplete")):$scope.notInterviewItems.content=$scope.notInterviewItems.content.concat(data.result.content),data.result.content.length>=data.result.size?($scope.onePageMoreData=!0,$scope.$broadcast("scroll.infiniteScrollComplete")):$scope.onePageMoreData=!1):($scope.notInterviewItems&&$scope.notInterviewItems.content&&0!=!$scope.notInterviewItems.content.length||($scope.oneTypeNoResultFlag=!0,$scope.onePageSize=0),$scope.$broadcast("scroll.refreshComplete")):($scope.onePageSize=0,$scope.oneTypeErrorFlag=!0)})},$scope.interviewSearchFun=function(){var url="";refreshFlag?($scope.interviewItems=[],url=basePath+"/third/jxglPerformInterview/findPerformanInterviewByStatusNotEqOne?pageNumber=0&pageSize="+50*($scope.twoPageNumber+1)):url=basePath+"/third/jxglPerformInterview/findPerformanInterviewByStatusNotEqOne?pageNumber="+$scope.twoPageNumber+"&pageSize=50",$scope.twoTypeNoResultFlag=!1,$http.post(url,$scope.conditions).success(function(data){0==data.status?null!=data.result&&data.result.content.length>0?(refreshFlag?($scope.interviewItems=data.result,$scope.twoPageSize=data.result.totalElements,$scope.$broadcast("scroll.refreshComplete")):$scope.interviewItems.content=$scope.interviewItems.content.concat(data.result.content),data.result.content.length>=data.result.size?($scope.twoPageMoreData=!0,$scope.$broadcast("scroll.infiniteScrollComplete")):$scope.twoPageMoreData=!1):($scope.interviewItems&&$scope.interviewItems.content&&0!=$scope.interviewItems.content.length||($scope.twoTypeNoResultFlag=!0,$scope.twoPageSize=0),$scope.$broadcast("scroll.refreshComplete")):($scope.twoPageSize=0,$scope.twoTypeErrorFlag=!0)})},$scope.childConditions={interviewMonth:$scope.conditions.interviewMonth,name:""},$scope.searchChildPageFun=function(){return $scope.loadFlag=!0,$scope.threePageMoreData=!1,$scope.threeTypeErrorFlag=!1,$scope.threeTypeNoResultFlag=!1,$scope.childConditions.name?void $http.post(basePath+"/third/jxglPerformInterview/findPerformanInterviewByName?pageNumber="+$scope.threePageNumber+"&pageSize=9999",$scope.childConditions).success(function(data){0==data.status?($scope.loadFlag=!1,null!=data.result&&data.result.content.length>0?(refreshFlag?($scope.modalItems=data.result,$scope.threePageSize=data.result.content.length,$scope.$broadcast("scroll.refreshComplete")):($scope.modalItems.content=$scope.modalItems.content.concat(data.result.content),$scope.threePageSize+=data.result.totalElements),data.result.content.length>=data.result.size&&($scope.threePageMoreData=!0,$scope.$broadcast("scroll.infiniteScrollComplete"))):(data.result&&data.result.content&&0==data.result.content.length&&($scope.modalItems=null,$scope.threePageSize=0,$scope.threeTypeNoResultFlag=!0),$scope.$broadcast("scroll.refreshComplete"))):($scope.threePageSize=0,$scope.threeTypeErrorFlag=!0)}):($scope.modalItems=null,void($scope.threePageSize=0))},$scope.changePageType=function(type){$scope.nowPage=type,$scope.conditions.interviewType=type},$scope.doRefresh=function(type){refreshFlag=!0,1==type?$scope.notInterviewSearchFun():2==type?$scope.interviewSearchFun():3==type&&$scope.searchChildPageFun()},$scope.loadData=function(type){refreshFlag=!1,1==type?($scope.onePageNumber++,$scope.notInterviewSearchFun()):2==type?($scope.twoPageNumber++,$scope.interviewSearchFun()):3==type&&$scope.searchChildPageFun()},$scope.openModal=function(){$ionicModal.fromTemplateUrl("search.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modal=modal,$scope.modalItems=null,$scope.modalFlag=!0,$scope.threePageSize=0,$scope.childPageYear=$scope.mainPageYear,$scope.childPageMonth=$scope.mainPageMonth,$scope.childSearchYear=$scope.mainPageYear,$scope.childSearchMonth=$scope.mainPageMonth,$scope.childConditions.interviewMonth=$scope.conditions.interviewMonth,$scope.childConditions.name="",$scope.modal.show()})},$scope.closeModal=function(){$scope.modalItems=null,$scope.threePageSize=0,$scope.threeTypeNoResultFlag=!1,$scope.threeTypeErrorFlag=!1,$scope.modal.remove()},$scope.$on("$destroy",function(){$scope.modal.remove()}),$scope.openModalOne=function(item){getInterview(item)},$scope.clearSearchInput=function(){$scope.childConditions.name=""},$scope.closeModalOne=function(){$scope.modalOne.remove()},$scope.$on("$destroy",function(){$scope.modalOne.remove()}),$scope.showMiddleModal=function(data,type){$ionicModal.fromTemplateUrl("middle-modal.html",{scope:$scope}).then(function(modal){$scope.modalTwo2=modal,$scope.modalTwo2.show(),$scope.dialogData=data,$scope.dialogData.type=type})},$scope.closeMiddleModal=function(){$scope.modalTwo2.remove(),checkData()},$scope.$on("$destroy",function(){$scope.modalTwo2.remove()}),$scope.showClassDialog=function(){$ionicModal.fromTemplateUrl("showClassDialog.html",{scope:$scope}).then(function(modal){$scope.classDialog=modal,$scope.classDialog.show()})},$scope.closeClassDialog=function(){$scope.classDialog.remove()},$scope.$on("$destroy",function(){$scope.classDialog.remove()}),$scope.openModalTwo=function(){$ionicModal.fromTemplateUrl("check.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalTwo=modal,$scope.modalTwo.show()})},$scope.closeModalTwo=function(){$scope.modalTwo.remove()},$scope.$on("$destroy",function(){$scope.modalTwo.remove()}),$scope.changePage=function(type){$scope.showStep=type},$scope.performFlag=!0,$scope.workFlag=!0,$scope.checkFlagFun=function(type){1==type?$scope.performFlag=!$scope.performFlag:2==type&&($scope.workFlag=!$scope.workFlag)},$scope.closeViewModal=function(){$scope.viewModal.remove()},$scope.$on("$destroy",function(){$scope.viewModal.remove()});var getMessage_new_fun=function(title,mess_1,mess_2,buttons){$ionicPopup.show({title:title,template:"<h5> "+mess_1+'</h5><p class="text-gray">'+mess_2+"</p>",buttons:buttons||[]})},info=function(){var buttons=[{text:"我要填",type:" button-outline button-theme button-local",onTap:function(){$scope.showStep=2}},{text:"继续提交",type:" button-theme button-local",onTap:function(){$scope.save()}}];getMessage_new_fun("提示","还没有填写面谈记录","确定不需要填写吗？",buttons)};$scope.backInfo=function(){var buttons=[{text:"继续面谈",type:" button-outline button-theme button-local"},{text:"确定返回",type:" button-theme button-local",onTap:function(){$scope.closeModalOne()}}];getMessage_new_fun("提示","返回后，当前面谈内容将丢失","确定要返回吗？",buttons)};var getInterview=function(item){$http.post(basePath+"/third/jxglPerformInterview/findPostEvaluateSet",item).success(function(data){$scope.item=data.result,$scope.item.planId=item.planId,$scope.item.userId=item.userId,checkData(),3!=data.result.interviewStatus?$ionicModal.fromTemplateUrl("interview.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalOne=modal,$scope.modalOne.show()}):$ionicModal.fromTemplateUrl("view.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.viewModal=modal,$scope.viewModal.show()}),$scope.showStep=1})};$scope.changeType=function(type){$scope.showStep=type};var checkData=function(){if($scope.allDetailNum=0,$scope.checkStatus=!1,$scope.item.jxglPerformInterviewDTOList)if($scope.item.jxglPerformInterviewDTOList.length>0){var performNums=$scope.item.jxglPerformInterviewDTOList.filter(function(data){return data.indexPoints||0==data.indexPoints});$scope.allDetailNum+=performNums.length,performNums.length!=$scope.item.jxglPerformInterviewDTOList.length&&($scope.checkStatus=!0),performNums.length>0&&($scope.item.preformPoints=0,angular.forEach(performNums,function(value){$scope.item.preformPoints+=parseFloat(value.indexPoints)*value.weight/100}),$scope.item.preformPoints=$scope.item.preformPoints.toFixed(2))}else $scope.item.preformPoints="未评";if($scope.item.jxglWorkInterviewDTOList)if($scope.item.jxglWorkInterviewDTOList.length>0){var workNums=$scope.item.jxglWorkInterviewDTOList.filter(function(data){return data.indexConefficient||0==data.indexConefficient});$scope.allDetailNum+=workNums.length,workNums.length!=$scope.item.jxglWorkInterviewDTOList.length&&($scope.checkStatus=!0),workNums.length>0&&($scope.item.workPoints=1,angular.forEach(workNums,function(value,index){index==$scope.item.jxglWorkInterviewDTOList.length-1?$scope.item.workPoints+=parseFloat(value.indexConefficient):$scope.item.workPoints=$scope.item.workPoints*parseFloat(value.indexConefficient)}),$scope.item.workPoints=$scope.item.workPoints.toFixed(2))}else $scope.item.workPoints="未评"};$scope.$on("$destroy",function(){$scope.notifyModel.remove()}),$scope.submit=function(){return checkData(),$scope.checkStatus?($scope.showErorr=!0,$ionicModal.fromTemplateUrl("notify-info.html",{scope:$scope}).then(function(modal){$scope.notifyModel=modal,$scope.notifyModel.show()}),void $timeout(function(){$scope.notifyModel.remove()},3e3)):$scope.item.currentMonthWorkingPoint||$scope.item.currentMonthWorkingQuestion||$scope.item.nextMonthPoint?void $scope.save():void info()},$scope.save=function(){$http.post(basePath+"/third/jxglPerformInterview/savePerformanInterview",$scope.item).success(function(data){$scope.showErorr=!1,$ionicModal.fromTemplateUrl("notify-info.html",{scope:$scope}).then(function(modal){$scope.notifyModel=modal,$scope.showErorr=!1,$scope.notifyModel.show(),$scope.notInterviewSearchFun(),$scope.interviewSearchFun(),$scope.searchChildPageFun()}),$timeout(function(){$scope.notifyModel.remove(),$scope.closeModalOne()},3e3)})}}angular.module("myApp").controller("performanceReviewCtrl",performanceReviewCtrl),performanceReviewCtrl.$inject=["$scope","$ionicPopup","$http","$timeout","$ionicLoading","$ionicModal","$filter"]}(),function(){"use strict";function stateConfig($stateProvider){$stateProvider.state("my_month_performance",{homePage:!0,url:"/my_month_performance",templateUrl:"views/my_month_performance/my_month_performance.html",controller:"myMonthPerformanceCtrl"})}angular.module("myApp").config(stateConfig),stateConfig.$inject=["$stateProvider"]}(),function(){"use strict";function performanceReviewCtrl($scope,$ionicPopup,$http,$timeout,$ionicLoading,$ionicModal,$filter){$scope.noResultFlag=!1,$scope.errorFlag=!1,$scope.nowPage=1,$scope.indexFlag=!1,($scope.mainSearchFun=function(){$scope.noResultFlag=!1,$scope.errorFlag=!1,$http.post(basePath+"/third/jxglPerformInterview/findMyPerformanInterview?pageNumber=0&pageSize=12").success(function(data){0==data.status?null!=data.result&&data.result.content.length>0?($scope.items=data.result,$scope.$broadcast("scroll.refreshComplete")):$scope.noResultFlag=!0:$scope.errorFlag=!0})})(),$scope.changePage=function(type){$scope.nowPage=type},$scope.performFlag=!0,$scope.workFlag=!0,$scope.checkFlagFun=function(type){1==type?$scope.performFlag=!$scope.performFlag:2==type&&($scope.workFlag=!$scope.workFlag)},$scope.$on("$destroy",function(){$scope.modal.remove()});var getDetail=function(item){null!=item&&($scope.planId=item.planId,$scope.userId=item.userId,$http.post(basePath+"/third/jxglPerformInterview/findMyPerformanInterviewDetail",item).success(function(data){"0"==data.status&&($scope.detailData=data.result)}))};$ionicModal.fromTemplateUrl("view.html",{scope:$scope,animation:"slide-in-right"}).then(function(modal){$scope.modalOne=modal}),$scope.goDetail=function(item){1!=item.interviewStatus&&($scope.nowPage=1,$scope.modalOne.show(),getDetail(item))},$scope.closeModalOne=function(){$scope.modalOne.hide()},$scope.$on("$destroy",function(){$scope.modalOne.remove()}),$ionicModal.fromTemplateUrl("notify-info.html",{scope:$scope}).then(function(modal){$scope.notifyModel=modal}),$scope.$on("$destroy",function(){$scope.notifyModel.remove()}),$scope.save=function(item){item.planId=$scope.planId,item.userId=$scope.userId,$http.post(basePath+"/third/jxglPerformInterview/saveMyPerformanInterview",item).success(function(data){"0"==data.status?($scope.errorFlag=!1,$scope.notifyModel.show(),$timeout(function(){$scope.notifyModel.hide(),$scope.closeModalOne(),$scope.mainSearchFun()},3e3)):$scope.errorFlag=!0})}}angular.module("myApp").controller("myMonthPerformanceCtrl",performanceReviewCtrl),performanceReviewCtrl.$inject=["$scope","$ionicPopup","$http","$timeout","$ionicLoading","$ionicModal","$filter"]}();